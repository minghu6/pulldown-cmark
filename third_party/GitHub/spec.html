<!DOCTYPE html><html><head>
      <title>spec</title>
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      
      <link rel="stylesheet" href="file:////home/minghu6/.vscode/extensions/shd101wyy.markdown-preview-enhanced-0.6.3/node_modules/@shd101wyy/mume/dependencies/katex/katex.min.css">
      
      
      
      
      
      
      
      
      
      <style>
      /**
 * prism.js Github theme based on GitHub's theme.
 * @author Sam Clarke
 */
code[class*="language-"],
pre[class*="language-"] {
  color: #333;
  background: none;
  font-family: Consolas, "Liberation Mono", Menlo, Courier, monospace;
  text-align: left;
  white-space: pre;
  word-spacing: normal;
  word-break: normal;
  word-wrap: normal;
  line-height: 1.4;

  -moz-tab-size: 8;
  -o-tab-size: 8;
  tab-size: 8;

  -webkit-hyphens: none;
  -moz-hyphens: none;
  -ms-hyphens: none;
  hyphens: none;
}

/* Code blocks */
pre[class*="language-"] {
  padding: .8em;
  overflow: auto;
  /* border: 1px solid #ddd; */
  border-radius: 3px;
  /* background: #fff; */
  background: #f5f5f5;
}

/* Inline code */
:not(pre) > code[class*="language-"] {
  padding: .1em;
  border-radius: .3em;
  white-space: normal;
  background: #f5f5f5;
}

.token.comment,
.token.blockquote {
  color: #969896;
}

.token.cdata {
  color: #183691;
}

.token.doctype,
.token.punctuation,
.token.variable,
.token.macro.property {
  color: #333;
}

.token.operator,
.token.important,
.token.keyword,
.token.rule,
.token.builtin {
  color: #a71d5d;
}

.token.string,
.token.url,
.token.regex,
.token.attr-value {
  color: #183691;
}

.token.property,
.token.number,
.token.boolean,
.token.entity,
.token.atrule,
.token.constant,
.token.symbol,
.token.command,
.token.code {
  color: #0086b3;
}

.token.tag,
.token.selector,
.token.prolog {
  color: #63a35c;
}

.token.function,
.token.namespace,
.token.pseudo-element,
.token.class,
.token.class-name,
.token.pseudo-class,
.token.id,
.token.url-reference .token.variable,
.token.attr-name {
  color: #795da3;
}

.token.entity {
  cursor: help;
}

.token.title,
.token.title .token.punctuation {
  font-weight: bold;
  color: #1d3e81;
}

.token.list {
  color: #ed6a43;
}

.token.inserted {
  background-color: #eaffea;
  color: #55a532;
}

.token.deleted {
  background-color: #ffecec;
  color: #bd2c00;
}

.token.bold {
  font-weight: bold;
}

.token.italic {
  font-style: italic;
}


/* JSON */
.language-json .token.property {
  color: #183691;
}

.language-markup .token.tag .token.punctuation {
  color: #333;
}

/* CSS */
code.language-css,
.language-css .token.function {
  color: #0086b3;
}

/* YAML */
.language-yaml .token.atrule {
  color: #63a35c;
}

code.language-yaml {
  color: #183691;
}

/* Ruby */
.language-ruby .token.function {
  color: #333;
}

/* Markdown */
.language-markdown .token.url {
  color: #795da3;
}

/* Makefile */
.language-makefile .token.symbol {
  color: #795da3;
}

.language-makefile .token.variable {
  color: #183691;
}

.language-makefile .token.builtin {
  color: #0086b3;
}

/* Bash */
.language-bash .token.keyword {
  color: #0086b3;
}

/* highlight */
pre[data-line] {
  position: relative;
  padding: 1em 0 1em 3em;
}
pre[data-line] .line-highlight-wrapper {
  position: absolute;
  top: 0;
  left: 0;
  background-color: transparent;
  display: block;
  width: 100%;
}

pre[data-line] .line-highlight {
  position: absolute;
  left: 0;
  right: 0;
  padding: inherit 0;
  margin-top: 1em;
  background: hsla(24, 20%, 50%,.08);
  background: linear-gradient(to right, hsla(24, 20%, 50%,.1) 70%, hsla(24, 20%, 50%,0));
  pointer-events: none;
  line-height: inherit;
  white-space: pre;
}

pre[data-line] .line-highlight:before, 
pre[data-line] .line-highlight[data-end]:after {
  content: attr(data-start);
  position: absolute;
  top: .4em;
  left: .6em;
  min-width: 1em;
  padding: 0 .5em;
  background-color: hsla(24, 20%, 50%,.4);
  color: hsl(24, 20%, 95%);
  font: bold 65%/1.5 sans-serif;
  text-align: center;
  vertical-align: .3em;
  border-radius: 999px;
  text-shadow: none;
  box-shadow: 0 1px white;
}

pre[data-line] .line-highlight[data-end]:after {
  content: attr(data-end);
  top: auto;
  bottom: .4em;
}html body{font-family:"Helvetica Neue",Helvetica,"Segoe UI",Arial,freesans,sans-serif;font-size:16px;line-height:1.6;color:#333;background-color:#fff;overflow:initial;box-sizing:border-box;word-wrap:break-word}html body>:first-child{margin-top:0}html body h1,html body h2,html body h3,html body h4,html body h5,html body h6{line-height:1.2;margin-top:1em;margin-bottom:16px;color:#000}html body h1{font-size:2.25em;font-weight:300;padding-bottom:.3em}html body h2{font-size:1.75em;font-weight:400;padding-bottom:.3em}html body h3{font-size:1.5em;font-weight:500}html body h4{font-size:1.25em;font-weight:600}html body h5{font-size:1.1em;font-weight:600}html body h6{font-size:1em;font-weight:600}html body h1,html body h2,html body h3,html body h4,html body h5{font-weight:600}html body h5{font-size:1em}html body h6{color:#5c5c5c}html body strong{color:#000}html body del{color:#5c5c5c}html body a:not([href]){color:inherit;text-decoration:none}html body a{color:#08c;text-decoration:none}html body a:hover{color:#00a3f5;text-decoration:none}html body img{max-width:100%}html body>p{margin-top:0;margin-bottom:16px;word-wrap:break-word}html body>ul,html body>ol{margin-bottom:16px}html body ul,html body ol{padding-left:2em}html body ul.no-list,html body ol.no-list{padding:0;list-style-type:none}html body ul ul,html body ul ol,html body ol ol,html body ol ul{margin-top:0;margin-bottom:0}html body li{margin-bottom:0}html body li.task-list-item{list-style:none}html body li>p{margin-top:0;margin-bottom:0}html body .task-list-item-checkbox{margin:0 .2em .25em -1.8em;vertical-align:middle}html body .task-list-item-checkbox:hover{cursor:pointer}html body blockquote{margin:16px 0;font-size:inherit;padding:0 15px;color:#5c5c5c;background-color:#f0f0f0;border-left:4px solid #d6d6d6}html body blockquote>:first-child{margin-top:0}html body blockquote>:last-child{margin-bottom:0}html body hr{height:4px;margin:32px 0;background-color:#d6d6d6;border:0 none}html body table{margin:10px 0 15px 0;border-collapse:collapse;border-spacing:0;display:block;width:100%;overflow:auto;word-break:normal;word-break:keep-all}html body table th{font-weight:bold;color:#000}html body table td,html body table th{border:1px solid #d6d6d6;padding:6px 13px}html body dl{padding:0}html body dl dt{padding:0;margin-top:16px;font-size:1em;font-style:italic;font-weight:bold}html body dl dd{padding:0 16px;margin-bottom:16px}html body code{font-family:Menlo,Monaco,Consolas,'Courier New',monospace;font-size:.85em !important;color:#000;background-color:#f0f0f0;border-radius:3px;padding:.2em 0}html body code::before,html body code::after{letter-spacing:-0.2em;content:"\00a0"}html body pre>code{padding:0;margin:0;font-size:.85em !important;word-break:normal;white-space:pre;background:transparent;border:0}html body .highlight{margin-bottom:16px}html body .highlight pre,html body pre{padding:1em;overflow:auto;font-size:.85em !important;line-height:1.45;border:#d6d6d6;border-radius:3px}html body .highlight pre{margin-bottom:0;word-break:normal}html body pre code,html body pre tt{display:inline;max-width:initial;padding:0;margin:0;overflow:initial;line-height:inherit;word-wrap:normal;background-color:transparent;border:0}html body pre code:before,html body pre tt:before,html body pre code:after,html body pre tt:after{content:normal}html body p,html body blockquote,html body ul,html body ol,html body dl,html body pre{margin-top:0;margin-bottom:16px}html body kbd{color:#000;border:1px solid #d6d6d6;border-bottom:2px solid #c7c7c7;padding:2px 4px;background-color:#f0f0f0;border-radius:3px}@media print{html body{background-color:#fff}html body h1,html body h2,html body h3,html body h4,html body h5,html body h6{color:#000;page-break-after:avoid}html body blockquote{color:#5c5c5c}html body pre{page-break-inside:avoid}html body table{display:table}html body img{display:block;max-width:100%;max-height:100%}html body pre,html body code{word-wrap:break-word;white-space:pre}}.markdown-preview{width:100%;height:100%;box-sizing:border-box}.markdown-preview .pagebreak,.markdown-preview .newpage{page-break-before:always}.markdown-preview pre.line-numbers{position:relative;padding-left:3.8em;counter-reset:linenumber}.markdown-preview pre.line-numbers>code{position:relative}.markdown-preview pre.line-numbers .line-numbers-rows{position:absolute;pointer-events:none;top:1em;font-size:100%;left:0;width:3em;letter-spacing:-1px;border-right:1px solid #999;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.markdown-preview pre.line-numbers .line-numbers-rows>span{pointer-events:none;display:block;counter-increment:linenumber}.markdown-preview pre.line-numbers .line-numbers-rows>span:before{content:counter(linenumber);color:#999;display:block;padding-right:.8em;text-align:right}.markdown-preview .mathjax-exps .MathJax_Display{text-align:center !important}.markdown-preview:not([for="preview"]) .code-chunk .btn-group{display:none}.markdown-preview:not([for="preview"]) .code-chunk .status{display:none}.markdown-preview:not([for="preview"]) .code-chunk .output-div{margin-bottom:16px}.scrollbar-style::-webkit-scrollbar{width:8px}.scrollbar-style::-webkit-scrollbar-track{border-radius:10px;background-color:transparent}.scrollbar-style::-webkit-scrollbar-thumb{border-radius:5px;background-color:rgba(150,150,150,0.66);border:4px solid rgba(150,150,150,0.66);background-clip:content-box}html body[for="html-export"]:not([data-presentation-mode]){position:relative;width:100%;height:100%;top:0;left:0;margin:0;padding:0;overflow:auto}html body[for="html-export"]:not([data-presentation-mode]) .markdown-preview{position:relative;top:0}@media screen and (min-width:914px){html body[for="html-export"]:not([data-presentation-mode]) .markdown-preview{padding:2em calc(50% - 457px + 2em)}}@media screen and (max-width:914px){html body[for="html-export"]:not([data-presentation-mode]) .markdown-preview{padding:2em}}@media screen and (max-width:450px){html body[for="html-export"]:not([data-presentation-mode]) .markdown-preview{font-size:14px !important;padding:1em}}@media print{html body[for="html-export"]:not([data-presentation-mode]) #sidebar-toc-btn{display:none}}html body[for="html-export"]:not([data-presentation-mode]) #sidebar-toc-btn{position:fixed;bottom:8px;left:8px;font-size:28px;cursor:pointer;color:inherit;z-index:99;width:32px;text-align:center;opacity:.4}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] #sidebar-toc-btn{opacity:1}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc{position:fixed;top:0;left:0;width:300px;height:100%;padding:32px 0 48px 0;font-size:14px;box-shadow:0 0 4px rgba(150,150,150,0.33);box-sizing:border-box;overflow:auto;background-color:inherit}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc::-webkit-scrollbar{width:8px}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc::-webkit-scrollbar-track{border-radius:10px;background-color:transparent}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc::-webkit-scrollbar-thumb{border-radius:5px;background-color:rgba(150,150,150,0.66);border:4px solid rgba(150,150,150,0.66);background-clip:content-box}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc a{text-decoration:none}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc ul{padding:0 1.6em;margin-top:.8em}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc li{margin-bottom:.8em}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc ul{list-style-type:none}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .markdown-preview{left:300px;width:calc(100% -  300px);padding:2em calc(50% - 457px -  150px);margin:0;box-sizing:border-box}@media screen and (max-width:1274px){html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .markdown-preview{padding:2em}}@media screen and (max-width:450px){html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .markdown-preview{width:100%}}html body[for="html-export"]:not([data-presentation-mode]):not([html-show-sidebar-toc]) .markdown-preview{left:50%;transform:translateX(-50%)}html body[for="html-export"]:not([data-presentation-mode]):not([html-show-sidebar-toc]) .md-sidebar-toc{display:none}
/* Please visit the URL below for more information: */
/*   https://shd101wyy.github.io/markdown-preview-enhanced/#/customize-css */

      </style>
    </head>
    <body for="html-export">
      <div class="mume markdown-preview  ">
      <hr>
<p>.</p>
<hr>
<hr>
<hr>
````````````````````````````````
<p>Wrong characters:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>+++
.
&lt;p&gt;+++&lt;/p&gt;
</code></pre><pre data-role="codeBlock" data-info="example" class="language-example"><code>===
.
&lt;p&gt;===&lt;/p&gt;
</code></pre><p>Not enough characters:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>--
**
__
.
&lt;p&gt;--
**
__&lt;/p&gt;
</code></pre><p>One to three spaces indent are allowed:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code> ***
  ***
   ***
.
&lt;hr /&gt;
&lt;hr /&gt;
&lt;hr /&gt;
</code></pre><p>Four spaces is too many:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>    ***
.
&lt;pre&gt;&lt;code&gt;***
&lt;/code&gt;&lt;/pre&gt;
</code></pre><pre data-role="codeBlock" data-info="example" class="language-example"><code>Foo
    ***
.
&lt;p&gt;Foo
***&lt;/p&gt;
</code></pre><p>More than three characters may be used:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>_____________________________________
.
&lt;hr /&gt;
</code></pre><p>Spaces are allowed between the characters:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code> - - -
.
&lt;hr /&gt;
</code></pre><pre data-role="codeBlock" data-info="example" class="language-example"><code> **  * ** * ** * **
.
&lt;hr /&gt;
</code></pre><pre data-role="codeBlock" data-info="example" class="language-example"><code>-     -      -      -
.
&lt;hr /&gt;
</code></pre><p>Spaces are allowed at the end:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>- - - -    
.
&lt;hr /&gt;
</code></pre><p>However, no other characters may occur in the line:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>_ _ _ _ a

a------

---a---
.
&lt;p&gt;_ _ _ _ a&lt;/p&gt;
&lt;p&gt;a------&lt;/p&gt;
&lt;p&gt;---a---&lt;/p&gt;
</code></pre><p>It is required that all of the [non-whitespace characters] be the same.<br>
So, this is not a thematic break:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code> *-*
.
&lt;p&gt;&lt;em&gt;-&lt;/em&gt;&lt;/p&gt;
</code></pre><p>Thematic breaks do not need blank lines before or after:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>- foo
***
- bar
.
&lt;ul&gt;
&lt;li&gt;foo&lt;/li&gt;
&lt;/ul&gt;
&lt;hr /&gt;
&lt;ul&gt;
&lt;li&gt;bar&lt;/li&gt;
&lt;/ul&gt;
</code></pre><p>Thematic breaks can interrupt a paragraph:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>Foo
***
bar
.
&lt;p&gt;Foo&lt;/p&gt;
&lt;hr /&gt;
&lt;p&gt;bar&lt;/p&gt;
</code></pre><p>If a line of dashes that meets the above conditions for being a<br>
thematic break could also be interpreted as the underline of a [setext<br>
heading], the interpretation as a<br>
[setext heading] takes precedence. Thus, for example,<br>
this is a setext heading, not a paragraph followed by a thematic break:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>Foo
---
bar
.
&lt;h2&gt;Foo&lt;/h2&gt;
&lt;p&gt;bar&lt;/p&gt;
</code></pre><p>When both a thematic break and a list item are possible<br>
interpretations of a line, the thematic break takes precedence:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>* Foo
* * *
* Bar
.
&lt;ul&gt;
&lt;li&gt;Foo&lt;/li&gt;
&lt;/ul&gt;
&lt;hr /&gt;
&lt;ul&gt;
&lt;li&gt;Bar&lt;/li&gt;
&lt;/ul&gt;
</code></pre><p>If you want a thematic break in a list item, use a different bullet:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>- Foo
- * * *
.
&lt;ul&gt;
&lt;li&gt;Foo&lt;/li&gt;
&lt;li&gt;
&lt;hr /&gt;
&lt;/li&gt;
&lt;/ul&gt;
</code></pre><h2>ATX headings</h2>
<p>An <a href="@">ATX heading</a><br>
consists of a string of characters, parsed as inline content, between an<br>
opening sequence of 1--6 unescaped <code>#</code> characters and an optional<br>
closing sequence of any number of unescaped <code>#</code> characters.<br>
The opening sequence of <code>#</code> characters must be followed by a<br>
[space] or by the end of line. The optional closing sequence of <code>#</code>s must be<br>
preceded by a [space] and may be followed by spaces only.  The opening<br>
<code>#</code> character may be indented 0-3 spaces.  The raw contents of the<br>
heading are stripped of leading and trailing spaces before being parsed<br>
as inline content.  The heading level is equal to the number of <code>#</code><br>
characters in the opening sequence.</p>
<p>Simple headings:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>#  foo
&lt;p class=&quot;mume-header &quot; id=&quot;foo&quot;&gt;&lt;/p&gt;

##  foo
&lt;p class=&quot;mume-header &quot; id=&quot;foo-1&quot;&gt;&lt;/p&gt;

###  foo
&lt;p class=&quot;mume-header &quot; id=&quot;foo-2&quot;&gt;&lt;/p&gt;

####  foo
&lt;p class=&quot;mume-header &quot; id=&quot;foo-3&quot;&gt;&lt;/p&gt;

#####  foo
&lt;p class=&quot;mume-header &quot; id=&quot;foo-4&quot;&gt;&lt;/p&gt;

######  foo
&lt;p class=&quot;mume-header &quot; id=&quot;foo-5&quot;&gt;&lt;/p&gt;

.
&lt;h1&gt;foo&lt;/h1&gt;
&lt;h2&gt;foo&lt;/h2&gt;
&lt;h3&gt;foo&lt;/h3&gt;
&lt;h4&gt;foo&lt;/h4&gt;
&lt;h5&gt;foo&lt;/h5&gt;
&lt;h6&gt;foo&lt;/h6&gt;
</code></pre><p>More than six <code>#</code> characters is not a heading:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>#######  foo
&lt;p class=&quot;mume-header &quot; id=&quot;foo-6&quot;&gt;&lt;/p&gt;

.
&lt;p&gt;####### foo&lt;/p&gt;
</code></pre><p>At least one space is required between the <code>#</code> characters and the<br>
heading&apos;s contents, unless the heading is empty.  Note that many<br>
implementations currently do not require the space.  However, the<br>
space was required by the<br>
<a href="http://www.aaronsw.com/2002/atx/atx.py">original ATX implementation</a>,<br>
and it helps prevent things like the following from being parsed as<br>
headings:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code># 5 bolt
&lt;p class=&quot;mume-header &quot; id=&quot;5-bolt&quot;&gt;&lt;/p&gt;


# hashtag
&lt;p class=&quot;mume-header &quot; id=&quot;hashtag&quot;&gt;&lt;/p&gt;

.
&lt;p&gt;#5 bolt&lt;/p&gt;
&lt;p&gt;#hashtag&lt;/p&gt;
</code></pre><p>This is not a heading, because the first <code>#</code> is escaped:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>\## foo
.
&lt;p&gt;## foo&lt;/p&gt;
</code></pre><p>Contents are parsed as inlines:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>#  foo *bar* \*baz\*
&lt;p class=&quot;mume-header &quot; id=&quot;foo-bar-baz&quot;&gt;&lt;/p&gt;

.
&lt;h1&gt;foo &lt;em&gt;bar&lt;/em&gt; *baz*&lt;/h1&gt;
</code></pre><p>Leading and trailing blanks are ignored in parsing inline content:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>#                   foo                     
&lt;p class=&quot;mume-header &quot; id=&quot;foo-7&quot;&gt;&lt;/p&gt;

.
&lt;h1&gt;foo&lt;/h1&gt;
</code></pre><p>One to three spaces indentation are allowed:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code> ### foo
  ## foo
   # foo
.
&lt;h3&gt;foo&lt;/h3&gt;
&lt;h2&gt;foo&lt;/h2&gt;
&lt;h1&gt;foo&lt;/h1&gt;
</code></pre><p>Four spaces are too much:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>    # foo
.
&lt;pre&gt;&lt;code&gt;# foo
&lt;/code&gt;&lt;/pre&gt;
</code></pre><pre data-role="codeBlock" data-info="example" class="language-example"><code>foo
    # bar
.
&lt;p&gt;foo
# bar&lt;/p&gt;
</code></pre><p>A closing sequence of <code>#</code> characters is optional:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>##  foo ##
&lt;p class=&quot;mume-header &quot; id=&quot;foo-8&quot;&gt;&lt;/p&gt;

  ###   bar    ###
.
&lt;h2&gt;foo&lt;/h2&gt;
&lt;h3&gt;bar&lt;/h3&gt;
</code></pre><p>It need not be the same length as the opening sequence:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>#  foo ##################################
&lt;p class=&quot;mume-header &quot; id=&quot;foo-9&quot;&gt;&lt;/p&gt;

#####  foo ##
&lt;p class=&quot;mume-header &quot; id=&quot;foo-10&quot;&gt;&lt;/p&gt;

.
&lt;h1&gt;foo&lt;/h1&gt;
&lt;h5&gt;foo&lt;/h5&gt;
</code></pre><p>Spaces are allowed after the closing sequence:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>###  foo ###     
&lt;p class=&quot;mume-header &quot; id=&quot;foo-11&quot;&gt;&lt;/p&gt;

.
&lt;h3&gt;foo&lt;/h3&gt;
</code></pre><p>A sequence of <code>#</code> characters with anything but [spaces] following it<br>
is not a closing sequence, but counts as part of the contents of the<br>
heading:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>###  foo ### b
&lt;p class=&quot;mume-header &quot; id=&quot;foo-b&quot;&gt;&lt;/p&gt;

.
&lt;h3&gt;foo ### b&lt;/h3&gt;
</code></pre><p>The closing sequence must be preceded by a space:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>#  foo#
&lt;p class=&quot;mume-header &quot; id=&quot;foo-12&quot;&gt;&lt;/p&gt;

.
&lt;h1&gt;foo#&lt;/h1&gt;
</code></pre><p>Backslash-escaped <code>#</code> characters do not count as part<br>
of the closing sequence:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>###  foo \###
&lt;p class=&quot;mume-header &quot; id=&quot;foo-13&quot;&gt;&lt;/p&gt;

##  foo #\##
&lt;p class=&quot;mume-header &quot; id=&quot;foo-14&quot;&gt;&lt;/p&gt;

#  foo \#
&lt;p class=&quot;mume-header &quot; id=&quot;foo-15&quot;&gt;&lt;/p&gt;

.
&lt;h3&gt;foo ###&lt;/h3&gt;
&lt;h2&gt;foo ###&lt;/h2&gt;
&lt;h1&gt;foo #&lt;/h1&gt;
</code></pre><p>ATX headings need not be separated from surrounding content by blank<br>
lines, and they can interrupt paragraphs:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>****
##  foo
&lt;p class=&quot;mume-header &quot; id=&quot;foo-16&quot;&gt;&lt;/p&gt;

****
.
&lt;hr /&gt;
&lt;h2&gt;foo&lt;/h2&gt;
&lt;hr /&gt;
</code></pre><pre data-role="codeBlock" data-info="example" class="language-example"><code>Foo bar
#  baz
&lt;p class=&quot;mume-header &quot; id=&quot;baz&quot;&gt;&lt;/p&gt;

Bar foo
.
&lt;p&gt;Foo bar&lt;/p&gt;
&lt;h1&gt;baz&lt;/h1&gt;
&lt;p&gt;Bar foo&lt;/p&gt;
</code></pre><p>ATX headings can be empty:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>##  
&lt;p class=&quot;mume-header &quot; id=&quot;&quot;&gt;&lt;/p&gt;

# 
&lt;p class=&quot;mume-header &quot; id=&quot;-1&quot;&gt;&lt;/p&gt;

###  ###
&lt;p class=&quot;mume-header &quot; id=&quot;-2&quot;&gt;&lt;/p&gt;

.
&lt;h2&gt;&lt;/h2&gt;
&lt;h1&gt;&lt;/h1&gt;
&lt;h3&gt;&lt;/h3&gt;
</code></pre><h2>Setext headings</h2>
<p>A <a href="@">setext heading</a> consists of one or more<br>
lines of text, each containing at least one [non-whitespace<br>
character], with no more than 3 spaces indentation, followed by<br>
a [setext heading underline].  The lines of text must be such<br>
that, were they not followed by the setext heading underline,<br>
they would be interpreted as a paragraph:  they cannot be<br>
interpretable as a [code fence], [ATX heading][ATX headings],<br>
[block quote][block quotes], [thematic break][thematic breaks],<br>
[list item][list items], or [HTML block][HTML blocks].</p>
<p>A <a href="@">setext heading underline</a> is a sequence of<br>
<code>=</code> characters or a sequence of <code>-</code> characters, with no more than 3<br>
spaces indentation and any number of trailing spaces.  If a line<br>
containing a single <code>-</code> can be interpreted as an<br>
empty [list items], it should be interpreted this way<br>
and not as a [setext heading underline].</p>
<p>The heading is a level 1 heading if <code>=</code> characters are used in<br>
the [setext heading underline], and a level 2 heading if <code>-</code><br>
characters are used.  The contents of the heading are the result<br>
of parsing the preceding lines of text as CommonMark inline<br>
content.</p>
<p>In general, a setext heading need not be preceded or followed by a<br>
blank line.  However, it cannot interrupt a paragraph, so when a<br>
setext heading comes after a paragraph, a blank line is needed between<br>
them.</p>
<p>Simple examples:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>Foo *bar*
=========

Foo *bar*
---------
.
&lt;h1&gt;Foo &lt;em&gt;bar&lt;/em&gt;&lt;/h1&gt;
&lt;h2&gt;Foo &lt;em&gt;bar&lt;/em&gt;&lt;/h2&gt;
</code></pre><p>The content of the header may span more than one line:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>Foo *bar
baz*
====
.
&lt;h1&gt;Foo &lt;em&gt;bar
baz&lt;/em&gt;&lt;/h1&gt;
</code></pre><p>The underlining can be any length:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>Foo
-------------------------

Foo
=
.
&lt;h2&gt;Foo&lt;/h2&gt;
&lt;h1&gt;Foo&lt;/h1&gt;
</code></pre><p>The heading content can be indented up to three spaces, and need<br>
not line up with the underlining:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>   Foo
---

  Foo
-----

  Foo
  ===
.
&lt;h2&gt;Foo&lt;/h2&gt;
&lt;h2&gt;Foo&lt;/h2&gt;
&lt;h1&gt;Foo&lt;/h1&gt;
</code></pre><p>Four spaces indent is too much:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>    Foo
    ---

    Foo
---
.
&lt;pre&gt;&lt;code&gt;Foo
---

Foo
&lt;/code&gt;&lt;/pre&gt;
&lt;hr /&gt;
</code></pre><p>The setext heading underline can be indented up to three spaces, and<br>
may have trailing spaces:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>Foo
   ----      
.
&lt;h2&gt;Foo&lt;/h2&gt;
</code></pre><p>Four spaces is too much:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>Foo
    ---
.
&lt;p&gt;Foo
---&lt;/p&gt;
</code></pre><p>The setext heading underline cannot contain internal spaces:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>Foo
= =

Foo
--- -
.
&lt;p&gt;Foo
= =&lt;/p&gt;
&lt;p&gt;Foo&lt;/p&gt;
&lt;hr /&gt;
</code></pre><p>Trailing spaces in the content line do not cause a line break:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>Foo  
-----
.
&lt;h2&gt;Foo&lt;/h2&gt;
</code></pre><p>Nor does a backslash at the end:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>Foo\
----
.
&lt;h2&gt;Foo\&lt;/h2&gt;
</code></pre><p>Since indicators of block structure take precedence over<br>
indicators of inline structure, the following are setext headings:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>`Foo
----
`

&lt;a title=&quot;a lot
---
of dashes&quot;/&gt;
.
&lt;h2&gt;`Foo&lt;/h2&gt;
&lt;p&gt;`&lt;/p&gt;
&lt;h2&gt;&amp;lt;a title=&amp;quot;a lot&lt;/h2&gt;
&lt;p&gt;of dashes&amp;quot;/&amp;gt;&lt;/p&gt;
</code></pre><p>The setext heading underline cannot be a [lazy continuation<br>
line] in a list item or block quote:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>&gt; Foo
---
.
&lt;blockquote&gt;
&lt;p&gt;Foo&lt;/p&gt;
&lt;/blockquote&gt;
&lt;hr /&gt;
</code></pre><pre data-role="codeBlock" data-info="example" class="language-example"><code>&gt; foo
bar
===
.
&lt;blockquote&gt;
&lt;p&gt;foo
bar
===&lt;/p&gt;
&lt;/blockquote&gt;
</code></pre><pre data-role="codeBlock" data-info="example" class="language-example"><code>- Foo
---
.
&lt;ul&gt;
&lt;li&gt;Foo&lt;/li&gt;
&lt;/ul&gt;
&lt;hr /&gt;
</code></pre><p>A blank line is needed between a paragraph and a following<br>
setext heading, since otherwise the paragraph becomes part<br>
of the heading&apos;s content:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>Foo
Bar
---
.
&lt;h2&gt;Foo
Bar&lt;/h2&gt;
</code></pre><p>But in general a blank line is not required before or after<br>
setext headings:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>---
Foo
---
Bar
---
Baz
.
&lt;hr /&gt;
&lt;h2&gt;Foo&lt;/h2&gt;
&lt;h2&gt;Bar&lt;/h2&gt;
&lt;p&gt;Baz&lt;/p&gt;
</code></pre><p>Setext headings cannot be empty:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>====
.
&lt;p&gt;====&lt;/p&gt;
</code></pre><p>Setext heading text lines must not be interpretable as block<br>
constructs other than paragraphs.  So, the line of dashes<br>
in these examples gets interpreted as a thematic break:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>---
---
.
&lt;hr /&gt;
&lt;hr /&gt;
</code></pre><pre data-role="codeBlock" data-info="example" class="language-example"><code>- foo
-----
.
&lt;ul&gt;
&lt;li&gt;foo&lt;/li&gt;
&lt;/ul&gt;
&lt;hr /&gt;
</code></pre><pre data-role="codeBlock" data-info="example" class="language-example"><code>    foo
---
.
&lt;pre&gt;&lt;code&gt;foo
&lt;/code&gt;&lt;/pre&gt;
&lt;hr /&gt;
</code></pre><pre data-role="codeBlock" data-info="example" class="language-example"><code>&gt; foo
-----
.
&lt;blockquote&gt;
&lt;p&gt;foo&lt;/p&gt;
&lt;/blockquote&gt;
&lt;hr /&gt;
</code></pre><p>If you want a heading with <code>&gt; foo</code> as its literal text, you can<br>
use backslash escapes:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>\&gt; foo
------
.
&lt;h2&gt;&amp;gt; foo&lt;/h2&gt;
</code></pre><p><strong>Compatibility note:</strong>  Most existing Markdown implementations<br>
do not allow the text of setext headings to span multiple lines.<br>
But there is no consensus about how to interpret</p>
<pre data-role="codeBlock" data-info="markdown" class="language-markdown">Foo
<span class="token title important">bar
<span class="token punctuation">---</span></span>
baz
</pre><p>One can find four different interpretations:</p>
<ol>
<li>paragraph &quot;Foo&quot;, heading &quot;bar&quot;, paragraph &quot;baz&quot;</li>
<li>paragraph &quot;Foo bar&quot;, thematic break, paragraph &quot;baz&quot;</li>
<li>paragraph &quot;Foo bar --- baz&quot;</li>
<li>heading &quot;Foo bar&quot;, paragraph &quot;baz&quot;</li>
</ol>
<p>We find interpretation 4 most natural, and interpretation 4<br>
increases the expressive power of CommonMark, by allowing<br>
multiline headings.  Authors who want interpretation 1 can<br>
put a blank line after the first paragraph:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>Foo

bar
---
baz
.
&lt;p&gt;Foo&lt;/p&gt;
&lt;h2&gt;bar&lt;/h2&gt;
&lt;p&gt;baz&lt;/p&gt;
</code></pre><p>Authors who want interpretation 2 can put blank lines around<br>
the thematic break,</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>Foo
bar

---

baz
.
&lt;p&gt;Foo
bar&lt;/p&gt;
&lt;hr /&gt;
&lt;p&gt;baz&lt;/p&gt;
</code></pre><p>or use a thematic break that cannot count as a [setext heading<br>
underline], such as</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>Foo
bar
* * *
baz
.
&lt;p&gt;Foo
bar&lt;/p&gt;
&lt;hr /&gt;
&lt;p&gt;baz&lt;/p&gt;
</code></pre><p>Authors who want interpretation 3 can use backslash escapes:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>Foo
bar
\---
baz
.
&lt;p&gt;Foo
bar
---
baz&lt;/p&gt;
</code></pre><h2>Indented code blocks</h2>
<p>An <a href="@">indented code block</a> is composed of one or more<br>
[indented chunks] separated by blank lines.<br>
An <a href="@">indented chunk</a> is a sequence of non-blank lines,<br>
each indented four or more spaces. The contents of the code block are<br>
the literal contents of the lines, including trailing<br>
[line endings], minus four spaces of indentation.<br>
An indented code block has no [info string].</p>
<p>An indented code block cannot interrupt a paragraph, so there must be<br>
a blank line between a paragraph and a following indented code block.<br>
(A blank line is not needed, however, between a code block and a following<br>
paragraph.)</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>    a simple
      indented code block
.
&lt;pre&gt;&lt;code&gt;a simple
  indented code block
&lt;/code&gt;&lt;/pre&gt;
</code></pre><p>If there is any ambiguity between an interpretation of indentation<br>
as a code block and as indicating that material belongs to a [list<br>
item][list items], the list item interpretation takes precedence:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>  - foo

    bar
.
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;foo&lt;/p&gt;
&lt;p&gt;bar&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
</code></pre><pre data-role="codeBlock" data-info="example" class="language-example"><code>1.  foo

    - bar
.
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;foo&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;bar&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
</code></pre><p>The contents of a code block are literal text, and do not get parsed<br>
as Markdown:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>    &lt;a/&gt;
    *hi*

    - one
.
&lt;pre&gt;&lt;code&gt;&amp;lt;a/&amp;gt;
*hi*

- one
&lt;/code&gt;&lt;/pre&gt;
</code></pre><p>Here we have three chunks separated by blank lines:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>    chunk1

    chunk2
  
 
 
    chunk3
.
&lt;pre&gt;&lt;code&gt;chunk1

chunk2



chunk3
&lt;/code&gt;&lt;/pre&gt;
</code></pre><p>Any initial spaces beyond four will be included in the content, even<br>
in interior blank lines:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>    chunk1
      
      chunk2
.
&lt;pre&gt;&lt;code&gt;chunk1
  
  chunk2
&lt;/code&gt;&lt;/pre&gt;
</code></pre><p>An indented code block cannot interrupt a paragraph.  (This<br>
allows hanging indents and the like.)</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>Foo
    bar

.
&lt;p&gt;Foo
bar&lt;/p&gt;
</code></pre><p>However, any non-blank line with fewer than four leading spaces ends<br>
the code block immediately.  So a paragraph may occur immediately<br>
after indented code:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>    foo
bar
.
&lt;pre&gt;&lt;code&gt;foo
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;bar&lt;/p&gt;
</code></pre><p>And indented code can occur immediately before and after other kinds of<br>
blocks:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>#  Heading
&lt;p class=&quot;mume-header &quot; id=&quot;heading&quot;&gt;&lt;/p&gt;

    foo
Heading
------
    foo
----
.
&lt;h1&gt;Heading&lt;/h1&gt;
&lt;pre&gt;&lt;code&gt;foo
&lt;/code&gt;&lt;/pre&gt;
&lt;h2&gt;Heading&lt;/h2&gt;
&lt;pre&gt;&lt;code&gt;foo
&lt;/code&gt;&lt;/pre&gt;
&lt;hr /&gt;
</code></pre><p>The first line can be indented more than four spaces:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>        foo
    bar
.
&lt;pre&gt;&lt;code&gt;    foo
bar
&lt;/code&gt;&lt;/pre&gt;
</code></pre><p>Blank lines preceding or following an indented code block<br>
are not included in it:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>    
    foo
    

.
&lt;pre&gt;&lt;code&gt;foo
&lt;/code&gt;&lt;/pre&gt;
</code></pre><p>Trailing spaces are included in the code block&apos;s content:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>    foo  
.
&lt;pre&gt;&lt;code&gt;foo  
&lt;/code&gt;&lt;/pre&gt;
</code></pre><h2>Fenced code blocks</h2>
<p>A <a href="@">code fence</a> is a sequence<br>
of at least three consecutive backtick characters (<code>`</code>) or<br>
tildes (<code>~</code>).  (Tildes and backticks cannot be mixed.)<br>
A <a href="@">fenced code block</a><br>
begins with a code fence, indented no more than three spaces.</p>
<p>The line with the opening code fence may optionally contain some text<br>
following the code fence; this is trimmed of leading and trailing<br>
whitespace and called the <a href="@">info string</a>. If the [info string] comes<br>
after a backtick fence, it may not contain any backtick<br>
characters.  (The reason for this restriction is that otherwise<br>
some inline code would be incorrectly interpreted as the<br>
beginning of a fenced code block.)</p>
<p>The content of the code block consists of all subsequent lines, until<br>
a closing [code fence] of the same type as the code block<br>
began with (backticks or tildes), and with at least as many backticks<br>
or tildes as the opening code fence.  If the leading code fence is<br>
indented N spaces, then up to N spaces of indentation are removed from<br>
each line of the content (if present).  (If a content line is not<br>
indented, it is preserved unchanged.  If it is indented less than N<br>
spaces, all of the indentation is removed.)</p>
<p>The closing code fence may be indented up to three spaces, and may be<br>
followed only by spaces, which are ignored.  If the end of the<br>
containing block (or document) is reached and no closing code fence<br>
has been found, the code block contains all of the lines after the<br>
opening code fence until the end of the containing block (or<br>
document).  (An alternative spec would require backtracking in the<br>
event that a closing code fence is not found.  But this makes parsing<br>
much less efficient, and there seems to be no real down side to the<br>
behavior described here.)</p>
<p>A fenced code block may interrupt a paragraph, and does not require<br>
a blank line either before or after.</p>
<p>The content of a code fence is treated as literal text, not parsed<br>
as inlines.  The first word of the [info string] is typically used to<br>
specify the language of the code sample, and rendered in the <code>class</code><br>
attribute of the <code>code</code> tag.  However, this spec does not mandate any<br>
particular treatment of the [info string].</p>
<p>Here is a simple example with backticks:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>```
&lt;
 &gt;
```
.
&lt;pre&gt;&lt;code&gt;&amp;lt;
 &amp;gt;
&lt;/code&gt;&lt;/pre&gt;
</code></pre><p>With tildes:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>~~~
&lt;
 &gt;
~~~
.
&lt;pre&gt;&lt;code&gt;&amp;lt;
 &amp;gt;
&lt;/code&gt;&lt;/pre&gt;
</code></pre><p>Fewer than three backticks is not enough:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>``
foo
``
.
&lt;p&gt;&lt;code&gt;foo&lt;/code&gt;&lt;/p&gt;
</code></pre><p>The closing code fence must use the same character as the opening<br>
fence:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>```
aaa
~~~
```
.
&lt;pre&gt;&lt;code&gt;aaa
~~~
&lt;/code&gt;&lt;/pre&gt;
</code></pre><pre data-role="codeBlock" data-info="example" class="language-example"><code>~~~
aaa
```
~~~
.
&lt;pre&gt;&lt;code&gt;aaa
```
&lt;/code&gt;&lt;/pre&gt;
</code></pre><p>The closing code fence must be at least as long as the opening fence:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>````
aaa
```
``````
.
&lt;pre&gt;&lt;code&gt;aaa
```
&lt;/code&gt;&lt;/pre&gt;
</code></pre><pre data-role="codeBlock" data-info="example" class="language-example"><code>~~~~
aaa
~~~
~~~~
.
&lt;pre&gt;&lt;code&gt;aaa
~~~
&lt;/code&gt;&lt;/pre&gt;
</code></pre><p>Unclosed code blocks are closed by the end of the document<br>
(or the enclosing [block quote][block quotes] or [list item][list items]):</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>```
.
&lt;pre&gt;&lt;code&gt;&lt;/code&gt;&lt;/pre&gt;
</code></pre><pre data-role="codeBlock" data-info="example" class="language-example"><code>`````

```
aaa
.
&lt;pre&gt;&lt;code&gt;
```
aaa
&lt;/code&gt;&lt;/pre&gt;
</code></pre><pre data-role="codeBlock" data-info="example" class="language-example"><code>&gt; ```
&gt; aaa

bbb
.
&lt;blockquote&gt;
&lt;pre&gt;&lt;code&gt;aaa
&lt;/code&gt;&lt;/pre&gt;
&lt;/blockquote&gt;
&lt;p&gt;bbb&lt;/p&gt;
</code></pre><p>A code block can have all empty lines as its content:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>```

  
```
.
&lt;pre&gt;&lt;code&gt;
  
&lt;/code&gt;&lt;/pre&gt;
</code></pre><p>A code block can be empty:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>```
```
.
&lt;pre&gt;&lt;code&gt;&lt;/code&gt;&lt;/pre&gt;
</code></pre><p>Fences can be indented.  If the opening fence is indented,<br>
content lines will have equivalent opening indentation removed,<br>
if present:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code> ```
 aaa
aaa
```
.
&lt;pre&gt;&lt;code&gt;aaa
aaa
&lt;/code&gt;&lt;/pre&gt;
</code></pre><pre data-role="codeBlock" data-info="example" class="language-example"><code>  ```
aaa
  aaa
aaa
  ```
.
&lt;pre&gt;&lt;code&gt;aaa
aaa
aaa
&lt;/code&gt;&lt;/pre&gt;
</code></pre><pre data-role="codeBlock" data-info="example" class="language-example"><code>   ```
   aaa
    aaa
  aaa
   ```
.
&lt;pre&gt;&lt;code&gt;aaa
 aaa
aaa
&lt;/code&gt;&lt;/pre&gt;
</code></pre><p>Four spaces indentation produces an indented code block:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>    ```
    aaa
    ```
.
&lt;pre&gt;&lt;code&gt;```
aaa
```
&lt;/code&gt;&lt;/pre&gt;
</code></pre><p>Closing fences may be indented by 0-3 spaces, and their indentation<br>
need not match that of the opening fence:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>```
aaa
  ```
.
&lt;pre&gt;&lt;code&gt;aaa
&lt;/code&gt;&lt;/pre&gt;
</code></pre><pre data-role="codeBlock" data-info="example" class="language-example"><code>   ```
aaa
  ```
.
&lt;pre&gt;&lt;code&gt;aaa
&lt;/code&gt;&lt;/pre&gt;
</code></pre><p>This is not a closing fence, because it is indented 4 spaces:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>```
aaa
    ```
.
&lt;pre&gt;&lt;code&gt;aaa
    ```
&lt;/code&gt;&lt;/pre&gt;
</code></pre><p>Code fences (opening and closing) cannot contain internal spaces:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>``` ```
aaa
.
&lt;p&gt;&lt;code&gt;&lt;/code&gt;
aaa&lt;/p&gt;
</code></pre><pre data-role="codeBlock" data-info="example" class="language-example"><code>~~~~~~
aaa
~~~ ~~
.
&lt;pre&gt;&lt;code&gt;aaa
~~~ ~~
&lt;/code&gt;&lt;/pre&gt;
</code></pre><p>Fenced code blocks can interrupt paragraphs, and can be followed<br>
directly by paragraphs, without a blank line between:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>foo
```
bar
```
baz
.
&lt;p&gt;foo&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;bar
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;baz&lt;/p&gt;
</code></pre><p>Other blocks can also occur before and after fenced code blocks<br>
without an intervening blank line:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>foo
---
~~~
bar
~~~
# baz
.
&lt;h2&gt;foo&lt;/h2&gt;
&lt;pre&gt;&lt;code&gt;bar
&lt;/code&gt;&lt;/pre&gt;
&lt;h1&gt;baz&lt;/h1&gt;
</code></pre><p>An [info string] can be provided after the opening code fence.<br>
Opening and closing spaces will be stripped, and the first word, prefixed<br>
with <code>language-</code>, is used as the value for the <code>class</code> attribute of the<br>
<code>code</code> element within the enclosing <code>pre</code> element.</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>```ruby
def foo(x)
  return 3
end
```
.
&lt;pre&gt;&lt;code class=&quot;language-ruby&quot;&gt;def foo(x)
  return 3
end
&lt;/code&gt;&lt;/pre&gt;
</code></pre><pre data-role="codeBlock" data-info="example" class="language-example"><code>~~~~    ruby startline=3 $%@#$
def foo(x)
  return 3
end
~~~~~~~
.
&lt;pre&gt;&lt;code class=&quot;language-ruby&quot;&gt;def foo(x)
  return 3
end
&lt;/code&gt;&lt;/pre&gt;
</code></pre><pre data-role="codeBlock" data-info="example" class="language-example"><code>````;
````
.
&lt;pre&gt;&lt;code class=&quot;language-;&quot;&gt;&lt;/code&gt;&lt;/pre&gt;
</code></pre><p>[Info strings] for backtick code blocks cannot contain backticks:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>``` aa ```
foo
.
&lt;p&gt;&lt;code&gt;aa&lt;/code&gt;
foo&lt;/p&gt;
</code></pre><p>[Info strings] for tilde code blocks can contain backticks and tildes:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>~~~ aa ``` ~~~
foo
~~~
.
&lt;pre&gt;&lt;code class=&quot;language-aa&quot;&gt;foo
&lt;/code&gt;&lt;/pre&gt;
</code></pre><p>Closing code fences cannot have [info strings]:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>```
``` aaa
```
.
&lt;pre&gt;&lt;code&gt;``` aaa
&lt;/code&gt;&lt;/pre&gt;
</code></pre><h2 class="mume-header" id="html-blocks">HTML blocks</h2>

<p>An <a href="@">HTML block</a> is a group of lines that is treated<br>
as raw HTML (and will not be escaped in HTML output).</p>
<p>There are seven kinds of [HTML block], which can be defined<br>
by their start and end conditions.  The block begins with a line that<br>
meets a <a href="@">start condition</a> (after up to three spaces<br>
optional indentation).  It ends with the first subsequent line that<br>
meets a matching <a href="@">end condition</a>, or the last line of<br>
the document or other <a href="#container-blocks">container block</a>), if no<br>
line is encountered that meets the [end condition].  If the first line<br>
meets both the [start condition] and the [end condition], the block<br>
will contain just that line.</p>
<ol>
<li>
<p><strong>Start condition:</strong>  line begins with the string <code>&lt;script</code>,<br>
<code>&lt;pre</code>, or <code>&lt;style</code> (case-insensitive), followed by whitespace,<br>
the string <code>&gt;</code>, or the end of the line.<br>
<strong>End condition:</strong>  line contains an end tag<br>
<code>&lt;/script&gt;</code>, <code>&lt;/pre&gt;</code>, or <code>&lt;/style&gt;</code> (case-insensitive; it<br>
need not match the start tag).</p>
</li>
<li>
<p><strong>Start condition:</strong> line begins with the string <code>&lt;!--</code>.<br>
<strong>End condition:</strong>  line contains the string <code>--&gt;</code>.</p>
</li>
<li>
<p><strong>Start condition:</strong> line begins with the string <code>&lt;?</code>.<br>
<strong>End condition:</strong> line contains the string <code>?&gt;</code>.</p>
</li>
<li>
<p><strong>Start condition:</strong> line begins with the string <code>&lt;!</code><br>
followed by an uppercase ASCII letter.<br>
<strong>End condition:</strong> line contains the character <code>&gt;</code>.</p>
</li>
<li>
<p><strong>Start condition:</strong>  line begins with the string<br>
<code>&lt;![CDATA[</code>.<br>
<strong>End condition:</strong> line contains the string <code>]]&gt;</code>.</p>
</li>
<li>
<p><strong>Start condition:</strong> line begins the string <code>&lt;</code> or <code>&lt;/</code><br>
followed by one of the strings (case-insensitive) <code>address</code>,<br>
<code>article</code>, <code>aside</code>, <code>base</code>, <code>basefont</code>, <code>blockquote</code>, <code>body</code>,<br>
<code>caption</code>, <code>center</code>, <code>col</code>, <code>colgroup</code>, <code>dd</code>, <code>details</code>, <code>dialog</code>,<br>
<code>dir</code>, <code>div</code>, <code>dl</code>, <code>dt</code>, <code>fieldset</code>, <code>figcaption</code>, <code>figure</code>,<br>
<code>footer</code>, <code>form</code>, <code>frame</code>, <code>frameset</code>,<br>
<code>h1</code>, <code>h2</code>, <code>h3</code>, <code>h4</code>, <code>h5</code>, <code>h6</code>, <code>head</code>, <code>header</code>, <code>hr</code>,<br>
<code>html</code>, <code>iframe</code>, <code>legend</code>, <code>li</code>, <code>link</code>, <code>main</code>, <code>menu</code>, <code>menuitem</code>,<br>
<code>nav</code>, <code>noframes</code>, <code>ol</code>, <code>optgroup</code>, <code>option</code>, <code>p</code>, <code>param</code>,<br>
<code>section</code>, <code>source</code>, <code>summary</code>, <code>table</code>, <code>tbody</code>, <code>td</code>,<br>
<code>tfoot</code>, <code>th</code>, <code>thead</code>, <code>title</code>, <code>tr</code>, <code>track</code>, <code>ul</code>, followed<br>
by [whitespace], the end of the line, the string <code>&gt;</code>, or<br>
the string <code>/&gt;</code>.<br>
<strong>End condition:</strong> line is followed by a [blank line].</p>
</li>
<li>
<p><strong>Start condition:</strong>  line begins with a complete [open tag]<br>
or [closing tag] (with any [tag name] other than <code>script</code>,<br>
<code>style</code>, or <code>pre</code>) followed only by [whitespace]<br>
or the end of the line.<br>
<strong>End condition:</strong> line is followed by a [blank line].</p>
</li>
</ol>
<p>HTML blocks continue until they are closed by their appropriate<br>
[end condition], or the last line of the document or other <a href="#container-blocks">container<br>
block</a>.  This means any HTML <strong>within an HTML<br>
block</strong> that might otherwise be recognised as a start condition will<br>
be ignored by the parser and passed through as-is, without changing<br>
the parser&apos;s state.</p>
<p>For instance, <code>&lt;pre&gt;</code> within a HTML block started by <code>&lt;table&gt;</code> will not affect<br>
the parser state; as the HTML block was started in by start condition 6, it<br>
will end at any blank line. This can be surprising:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>&lt;table&gt;&lt;tr&gt;&lt;td&gt;
&lt;pre&gt;
**Hello**,

_world_.
&lt;/pre&gt;
&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
.
&lt;table&gt;&lt;tr&gt;&lt;td&gt;
&lt;pre&gt;
**Hello**,
&lt;p&gt;&lt;em&gt;world&lt;/em&gt;.
&lt;/pre&gt;&lt;/p&gt;
&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
</code></pre><p>In this case, the HTML block is terminated by the newline &#x2014; the <code>**Hello**</code><br>
text remains verbatim &#x2014; and regular parsing resumes, with a paragraph,<br>
emphasised <code>world</code> and inline and block HTML following.</p>
<p>All types of [HTML blocks] except type 7 may interrupt<br>
a paragraph.  Blocks of type 7 may not interrupt a paragraph.<br>
(This restriction is intended to prevent unwanted interpretation<br>
of long tags inside a wrapped paragraph as starting HTML blocks.)</p>
<p>Some simple examples follow.  Here are some basic HTML blocks<br>
of type 6:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>&lt;table&gt;
  &lt;tr&gt;
    &lt;td&gt;
           hi
    &lt;/td&gt;
  &lt;/tr&gt;
&lt;/table&gt;

okay.
.
&lt;table&gt;
  &lt;tr&gt;
    &lt;td&gt;
           hi
    &lt;/td&gt;
  &lt;/tr&gt;
&lt;/table&gt;
&lt;p&gt;okay.&lt;/p&gt;
</code></pre><pre data-role="codeBlock" data-info="example" class="language-example"><code> &lt;div&gt;
  *hello*
         &lt;foo&gt;&lt;a&gt;
.
 &lt;div&gt;
  *hello*
         &lt;foo&gt;&lt;a&gt;
</code></pre><p>A block can also start with a closing tag:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>&lt;/div&gt;
*foo*
.
&lt;/div&gt;
*foo*
</code></pre><p>Here we have two HTML blocks with a Markdown paragraph between them:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>&lt;DIV CLASS=&quot;foo&quot;&gt;

*Markdown*

&lt;/DIV&gt;
.
&lt;DIV CLASS=&quot;foo&quot;&gt;
&lt;p&gt;&lt;em&gt;Markdown&lt;/em&gt;&lt;/p&gt;
&lt;/DIV&gt;
</code></pre><p>The tag on the first line can be partial, as long<br>
as it is split where there would be whitespace:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>&lt;div id=&quot;foo&quot;
  class=&quot;bar&quot;&gt;
&lt;/div&gt;
.
&lt;div id=&quot;foo&quot;
  class=&quot;bar&quot;&gt;
&lt;/div&gt;
</code></pre><pre data-role="codeBlock" data-info="example" class="language-example"><code>&lt;div id=&quot;foo&quot; class=&quot;bar
  baz&quot;&gt;
&lt;/div&gt;
.
&lt;div id=&quot;foo&quot; class=&quot;bar
  baz&quot;&gt;
&lt;/div&gt;
</code></pre><p>An open tag need not be closed:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>&lt;div&gt;
*foo*

*bar*
.
&lt;div&gt;
*foo*
&lt;p&gt;&lt;em&gt;bar&lt;/em&gt;&lt;/p&gt;
</code></pre><p>A partial tag need not even be completed (garbage<br>
in, garbage out):</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>&lt;div id=&quot;foo&quot;
*hi*
.
&lt;div id=&quot;foo&quot;
*hi*
</code></pre><pre data-role="codeBlock" data-info="example" class="language-example"><code>&lt;div class
foo
.
&lt;div class
foo
</code></pre><p>The initial tag doesn&apos;t even need to be a valid<br>
tag, as long as it starts like one:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>&lt;div *???-&amp;&amp;&amp;-&lt;---
*foo*
.
&lt;div *???-&amp;&amp;&amp;-&lt;---
*foo*
</code></pre><p>In type 6 blocks, the initial tag need not be on a line by<br>
itself:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>&lt;div&gt;&lt;a href=&quot;bar&quot;&gt;*foo*&lt;/a&gt;&lt;/div&gt;
.
&lt;div&gt;&lt;a href=&quot;bar&quot;&gt;*foo*&lt;/a&gt;&lt;/div&gt;
</code></pre><pre data-role="codeBlock" data-info="example" class="language-example"><code>&lt;table&gt;&lt;tr&gt;&lt;td&gt;
foo
&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
.
&lt;table&gt;&lt;tr&gt;&lt;td&gt;
foo
&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
</code></pre><p>Everything until the next blank line or end of document<br>
gets included in the HTML block.  So, in the following<br>
example, what looks like a Markdown code block<br>
is actually part of the HTML block, which continues until a blank<br>
line or the end of the document is reached:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>&lt;div&gt;&lt;/div&gt;
``` c
int x = 33;
```
.
&lt;div&gt;&lt;/div&gt;
``` c
int x = 33;
```
</code></pre><p>To start an [HTML block] with a tag that is <em>not</em> in the<br>
list of block-level tags in (6), you must put the tag by<br>
itself on the first line (and it must be complete):</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>&lt;a href=&quot;foo&quot;&gt;
*bar*
&lt;/a&gt;
.
&lt;a href=&quot;foo&quot;&gt;
*bar*
&lt;/a&gt;
</code></pre><p>In type 7 blocks, the [tag name] can be anything:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>&lt;Warning&gt;
*bar*
&lt;/Warning&gt;
.
&lt;Warning&gt;
*bar*
&lt;/Warning&gt;
</code></pre><pre data-role="codeBlock" data-info="example" class="language-example"><code>&lt;i class=&quot;foo&quot;&gt;
*bar*
&lt;/i&gt;
.
&lt;i class=&quot;foo&quot;&gt;
*bar*
&lt;/i&gt;
</code></pre><pre data-role="codeBlock" data-info="example" class="language-example"><code>&lt;/ins&gt;
*bar*
.
&lt;/ins&gt;
*bar*
</code></pre><p>These rules are designed to allow us to work with tags that<br>
can function as either block-level or inline-level tags.<br>
The <code>&lt;del&gt;</code> tag is a nice example.  We can surround content with<br>
<code>&lt;del&gt;</code> tags in three different ways.  In this case, we get a raw<br>
HTML block, because the <code>&lt;del&gt;</code> tag is on a line by itself:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>&lt;del&gt;
*foo*
&lt;/del&gt;
.
&lt;del&gt;
*foo*
&lt;/del&gt;
</code></pre><p>In this case, we get a raw HTML block that just includes<br>
the <code>&lt;del&gt;</code> tag (because it ends with the following blank<br>
line).  So the contents get interpreted as CommonMark:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>&lt;del&gt;

*foo*

&lt;/del&gt;
.
&lt;del&gt;
&lt;p&gt;&lt;em&gt;foo&lt;/em&gt;&lt;/p&gt;
&lt;/del&gt;
</code></pre><p>Finally, in this case, the <code>&lt;del&gt;</code> tags are interpreted<br>
as [raw HTML] <em>inside</em> the CommonMark paragraph.  (Because<br>
the tag is not on a line by itself, we get inline HTML<br>
rather than an [HTML block].)</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>&lt;del&gt;*foo*&lt;/del&gt;
.
&lt;p&gt;&lt;del&gt;&lt;em&gt;foo&lt;/em&gt;&lt;/del&gt;&lt;/p&gt;
</code></pre><p>HTML tags designed to contain literal content<br>
(<code>script</code>, <code>style</code>, <code>pre</code>), comments, processing instructions,<br>
and declarations are treated somewhat differently.<br>
Instead of ending at the first blank line, these blocks<br>
end at the first line containing a corresponding end tag.<br>
As a result, these blocks can contain blank lines:</p>
<p>A pre tag (type 1):</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>&lt;pre language=&quot;haskell&quot;&gt;&lt;code&gt;
import Text.HTML.TagSoup

main :: IO ()
main = print $ parseTags tags
&lt;/code&gt;&lt;/pre&gt;
okay
.
&lt;pre language=&quot;haskell&quot;&gt;&lt;code&gt;
import Text.HTML.TagSoup

main :: IO ()
main = print $ parseTags tags
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;okay&lt;/p&gt;
</code></pre><p>A script tag (type 1):</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>&lt;script type=&quot;text/javascript&quot;&gt;
// JavaScript example

document.getElementById(&quot;demo&quot;).innerHTML = &quot;Hello JavaScript!&quot;;
&lt;/script&gt;
okay
.
&lt;script type=&quot;text/javascript&quot;&gt;
// JavaScript example

document.getElementById(&quot;demo&quot;).innerHTML = &quot;Hello JavaScript!&quot;;
&lt;/script&gt;
&lt;p&gt;okay&lt;/p&gt;
</code></pre><p>A style tag (type 1):</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>&lt;style
  type=&quot;text/css&quot;&gt;
h1 {color:red;}

p {color:blue;}
&lt;/style&gt;
okay
.
&lt;style
  type=&quot;text/css&quot;&gt;
h1 {color:red;}

p {color:blue;}
&lt;/style&gt;
&lt;p&gt;okay&lt;/p&gt;
</code></pre><p>If there is no matching end tag, the block will end at the<br>
end of the document (or the enclosing [block quote][block quotes]<br>
or [list item][list items]):</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>&lt;style
  type=&quot;text/css&quot;&gt;

foo
.
&lt;style
  type=&quot;text/css&quot;&gt;

foo
</code></pre><pre data-role="codeBlock" data-info="example" class="language-example"><code>&gt; &lt;div&gt;
&gt; foo

bar
.
&lt;blockquote&gt;
&lt;div&gt;
foo
&lt;/blockquote&gt;
&lt;p&gt;bar&lt;/p&gt;
</code></pre><pre data-role="codeBlock" data-info="example" class="language-example"><code>- &lt;div&gt;
- foo
.
&lt;ul&gt;
&lt;li&gt;
&lt;div&gt;
&lt;/li&gt;
&lt;li&gt;foo&lt;/li&gt;
&lt;/ul&gt;
</code></pre><p>The end tag can occur on the same line as the start tag:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>&lt;style&gt;p{color:red;}&lt;/style&gt;
*foo*
.
&lt;style&gt;p{color:red;}&lt;/style&gt;
&lt;p&gt;&lt;em&gt;foo&lt;/em&gt;&lt;/p&gt;
</code></pre><pre data-role="codeBlock" data-info="example" class="language-example"><code>&lt;!-- foo --&gt;*bar*
*baz*
.
&lt;!-- foo --&gt;*bar*
&lt;p&gt;&lt;em&gt;baz&lt;/em&gt;&lt;/p&gt;
</code></pre><p>Note that anything on the last line after the<br>
end tag will be included in the [HTML block]:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>&lt;script&gt;
foo
&lt;/script&gt;1. *bar*
.
&lt;script&gt;
foo
&lt;/script&gt;1. *bar*
</code></pre><p>A comment (type 2):</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>&lt;!-- Foo

bar
   baz --&gt;
okay
.
&lt;!-- Foo

bar
   baz --&gt;
&lt;p&gt;okay&lt;/p&gt;
</code></pre><p>A processing instruction (type 3):</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>&lt;?php

  echo &apos;&gt;&apos;;

?&gt;
okay
.
&lt;?php

  echo &apos;&gt;&apos;;

?&gt;
&lt;p&gt;okay&lt;/p&gt;
</code></pre><p>A declaration (type 4):</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>&lt;!DOCTYPE html&gt;
.
&lt;!DOCTYPE html&gt;
</code></pre><p>CDATA (type 5):</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>&lt;![CDATA[
function matchwo(a,b)
{
  if (a &lt; b &amp;&amp; a &lt; 0) then {
    return 1;

  } else {

    return 0;
  }
}
]]&gt;
okay
.
&lt;![CDATA[
function matchwo(a,b)
{
  if (a &lt; b &amp;&amp; a &lt; 0) then {
    return 1;

  } else {

    return 0;
  }
}
]]&gt;
&lt;p&gt;okay&lt;/p&gt;
</code></pre><p>The opening tag can be indented 1-3 spaces, but not 4:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>  &lt;!-- foo --&gt;

    &lt;!-- foo --&gt;
.
  &lt;!-- foo --&gt;
&lt;pre&gt;&lt;code&gt;&amp;lt;!-- foo --&amp;gt;
&lt;/code&gt;&lt;/pre&gt;
</code></pre><pre data-role="codeBlock" data-info="example" class="language-example"><code>  &lt;div&gt;

    &lt;div&gt;
.
  &lt;div&gt;
&lt;pre&gt;&lt;code&gt;&amp;lt;div&amp;gt;
&lt;/code&gt;&lt;/pre&gt;
</code></pre><p>An HTML block of types 1--6 can interrupt a paragraph, and need not be<br>
preceded by a blank line.</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>Foo
&lt;div&gt;
bar
&lt;/div&gt;
.
&lt;p&gt;Foo&lt;/p&gt;
&lt;div&gt;
bar
&lt;/div&gt;
</code></pre><p>However, a following blank line is needed, except at the end of<br>
a document, and except for blocks of types 1--5, [above][HTML<br>
block]:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>&lt;div&gt;
bar
&lt;/div&gt;
*foo*
.
&lt;div&gt;
bar
&lt;/div&gt;
*foo*
</code></pre><p>HTML blocks of type 7 cannot interrupt a paragraph:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>Foo
&lt;a href=&quot;bar&quot;&gt;
baz
.
&lt;p&gt;Foo
&lt;a href=&quot;bar&quot;&gt;
baz&lt;/p&gt;
</code></pre><p>This rule differs from John Gruber&apos;s original Markdown syntax<br>
specification, which says:</p>
<blockquote>
<p>The only restrictions are that block-level HTML elements &#x2014;<br>
e.g. <code>&lt;div&gt;</code>, <code>&lt;table&gt;</code>, <code>&lt;pre&gt;</code>, <code>&lt;p&gt;</code>, etc. &#x2014; must be separated from<br>
surrounding content by blank lines, and the start and end tags of the<br>
block should not be indented with tabs or spaces.</p>
</blockquote>
<p>In some ways Gruber&apos;s rule is more restrictive than the one given<br>
here:</p>
<ul>
<li>It requires that an HTML block be preceded by a blank line.</li>
<li>It does not allow the start tag to be indented.</li>
<li>It requires a matching end tag, which it also does not allow to<br>
be indented.</li>
</ul>
<p>Most Markdown implementations (including some of Gruber&apos;s own) do not<br>
respect all of these restrictions.</p>
<p>There is one respect, however, in which Gruber&apos;s rule is more liberal<br>
than the one given here, since it allows blank lines to occur inside<br>
an HTML block.  There are two reasons for disallowing them here.<br>
First, it removes the need to parse balanced tags, which is<br>
expensive and can require backtracking from the end of the document<br>
if no matching end tag is found. Second, it provides a very simple<br>
and flexible way of including Markdown content inside HTML tags:<br>
simply separate the Markdown from the HTML using blank lines:</p>
<p>Compare:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>&lt;div&gt;

*Emphasized* text.

&lt;/div&gt;
.
&lt;div&gt;
&lt;p&gt;&lt;em&gt;Emphasized&lt;/em&gt; text.&lt;/p&gt;
&lt;/div&gt;
</code></pre><pre data-role="codeBlock" data-info="example" class="language-example"><code>&lt;div&gt;
*Emphasized* text.
&lt;/div&gt;
.
&lt;div&gt;
*Emphasized* text.
&lt;/div&gt;
</code></pre><p>Some Markdown implementations have adopted a convention of<br>
interpreting content inside tags as text if the open tag has<br>
the attribute <code>markdown=1</code>.  The rule given above seems a simpler and<br>
more elegant way of achieving the same expressive power, which is also<br>
much simpler to parse.</p>
<p>The main potential drawback is that one can no longer paste HTML<br>
blocks into Markdown documents with 100% reliability.  However,<br>
<em>in most cases</em> this will work fine, because the blank lines in<br>
HTML are usually followed by HTML block tags.  For example:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>&lt;table&gt;

&lt;tr&gt;

&lt;td&gt;
Hi
&lt;/td&gt;

&lt;/tr&gt;

&lt;/table&gt;
.
&lt;table&gt;
&lt;tr&gt;
&lt;td&gt;
Hi
&lt;/td&gt;
&lt;/tr&gt;
&lt;/table&gt;
</code></pre><p>There are problems, however, if the inner tags are indented<br>
<em>and</em> separated by spaces, as then they will be interpreted as<br>
an indented code block:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>&lt;table&gt;

  &lt;tr&gt;

    &lt;td&gt;
      Hi
    &lt;/td&gt;

  &lt;/tr&gt;

&lt;/table&gt;
.
&lt;table&gt;
  &lt;tr&gt;
&lt;pre&gt;&lt;code&gt;&amp;lt;td&amp;gt;
  Hi
&amp;lt;/td&amp;gt;
&lt;/code&gt;&lt;/pre&gt;
  &lt;/tr&gt;
&lt;/table&gt;
</code></pre><p>Fortunately, blank lines are usually not necessary and can be<br>
deleted.  The exception is inside <code>&lt;pre&gt;</code> tags, but as described<br>
[above][HTML blocks], raw HTML blocks starting with <code>&lt;pre&gt;</code><br>
<em>can</em> contain blank lines.</p>
<h2 class="mume-header" id="link-reference-definitions">Link reference definitions</h2>

<p>A <a href="@">link reference definition</a><br>
consists of a [link label], indented up to three spaces, followed<br>
by a colon (<code>:</code>), optional [whitespace] (including up to one<br>
[line ending]), a [link destination],<br>
optional [whitespace] (including up to one<br>
[line ending]), and an optional [link<br>
title], which if it is present must be separated<br>
from the [link destination] by [whitespace].<br>
No further [non-whitespace characters] may occur on the line.</p>
<p>A [link reference definition]<br>
does not correspond to a structural element of a document.  Instead, it<br>
defines a label which can be used in [reference links]<br>
and reference-style [images] elsewhere in the document.  [Link<br>
reference definitions] can come either before or after the links that use<br>
them.</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>[foo]: /url &quot;title&quot;

[foo]
.
&lt;p&gt;&lt;a href=&quot;/url&quot; title=&quot;title&quot;&gt;foo&lt;/a&gt;&lt;/p&gt;
</code></pre><pre data-role="codeBlock" data-info="example" class="language-example"><code>   [foo]: 
      /url  
           &apos;the title&apos;  

[foo]
.
&lt;p&gt;&lt;a href=&quot;/url&quot; title=&quot;the title&quot;&gt;foo&lt;/a&gt;&lt;/p&gt;
</code></pre><pre data-role="codeBlock" data-info="example" class="language-example"><code>[Foo*bar\]]:my_(url) &apos;title (with parens)&apos;

[Foo*bar\]]
.
&lt;p&gt;&lt;a href=&quot;my_(url)&quot; title=&quot;title (with parens)&quot;&gt;Foo*bar]&lt;/a&gt;&lt;/p&gt;
</code></pre><pre data-role="codeBlock" data-info="example" class="language-example"><code>[Foo bar]:
&lt;my url&gt;
&apos;title&apos;

[Foo bar]
.
&lt;p&gt;&lt;a href=&quot;my%20url&quot; title=&quot;title&quot;&gt;Foo bar&lt;/a&gt;&lt;/p&gt;
</code></pre><p>The title may extend over multiple lines:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>[foo]: /url &apos;
title
line1
line2
&apos;

[foo]
.
&lt;p&gt;&lt;a href=&quot;/url&quot; title=&quot;
title
line1
line2
&quot;&gt;foo&lt;/a&gt;&lt;/p&gt;
</code></pre><p>However, it may not contain a [blank line]:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>[foo]: /url &apos;title

with blank line&apos;

[foo]
.
&lt;p&gt;[foo]: /url &apos;title&lt;/p&gt;
&lt;p&gt;with blank line&apos;&lt;/p&gt;
&lt;p&gt;[foo]&lt;/p&gt;
</code></pre><p>The title may be omitted:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>[foo]:
/url

[foo]
.
&lt;p&gt;&lt;a href=&quot;/url&quot;&gt;foo&lt;/a&gt;&lt;/p&gt;
</code></pre><p>The link destination may not be omitted:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>[foo]:

[foo]
.
&lt;p&gt;[foo]:&lt;/p&gt;
&lt;p&gt;[foo]&lt;/p&gt;
</code></pre><p>The title must be separated from the link destination by<br>
whitespace:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>[foo]: &lt;bar&gt;(baz)

[foo]
.
&lt;p&gt;[foo]: &lt;bar&gt;(baz)&lt;/p&gt;
&lt;p&gt;[foo]&lt;/p&gt;
</code></pre><p>Both title and destination can contain backslash escapes<br>
and literal backslashes:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>[foo]: /url\bar\*baz &quot;foo\&quot;bar\baz&quot;

[foo]
.
&lt;p&gt;&lt;a href=&quot;/url%5Cbar*baz&quot; title=&quot;foo&amp;quot;bar\baz&quot;&gt;foo&lt;/a&gt;&lt;/p&gt;
</code></pre><p>A link can come before its corresponding definition:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>[foo]

[foo]: url
.
&lt;p&gt;&lt;a href=&quot;url&quot;&gt;foo&lt;/a&gt;&lt;/p&gt;
</code></pre><p>If there are several matching definitions, the first one takes<br>
precedence:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>[foo]

[foo]: first
[foo]: second
.
&lt;p&gt;&lt;a href=&quot;first&quot;&gt;foo&lt;/a&gt;&lt;/p&gt;
</code></pre><p>As noted in the section on [Links], matching of labels is<br>
case-insensitive (see [matches]).</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>[FOO]: /url

[Foo]
.
&lt;p&gt;&lt;a href=&quot;/url&quot;&gt;Foo&lt;/a&gt;&lt;/p&gt;
</code></pre><pre data-role="codeBlock" data-info="example" class="language-example"><code>[&#x391;&#x393;&#x3A9;]: /&#x3C6;&#x3BF;&#x3C5;

[&#x3B1;&#x3B3;&#x3C9;]
.
&lt;p&gt;&lt;a href=&quot;/%CF%86%CE%BF%CF%85&quot;&gt;&#x3B1;&#x3B3;&#x3C9;&lt;/a&gt;&lt;/p&gt;
</code></pre><p>Here is a link reference definition with no corresponding link.<br>
It contributes nothing to the document.</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>[foo]: /url
.
</code></pre><p>Here is another one:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>[
foo
]: /url
bar
.
&lt;p&gt;bar&lt;/p&gt;
</code></pre><p>This is not a link reference definition, because there are<br>
[non-whitespace characters] after the title:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>[foo]: /url &quot;title&quot; ok
.
&lt;p&gt;[foo]: /url &amp;quot;title&amp;quot; ok&lt;/p&gt;
</code></pre><p>This is a link reference definition, but it has no title:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>[foo]: /url
&quot;title&quot; ok
.
&lt;p&gt;&amp;quot;title&amp;quot; ok&lt;/p&gt;
</code></pre><p>This is not a link reference definition, because it is indented<br>
four spaces:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>    [foo]: /url &quot;title&quot;

[foo]
.
&lt;pre&gt;&lt;code&gt;[foo]: /url &amp;quot;title&amp;quot;
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;[foo]&lt;/p&gt;
</code></pre><p>This is not a link reference definition, because it occurs inside<br>
a code block:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>```
[foo]: /url
```

[foo]
.
&lt;pre&gt;&lt;code&gt;[foo]: /url
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;[foo]&lt;/p&gt;
</code></pre><p>A [link reference definition] cannot interrupt a paragraph.</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>Foo
[bar]: /baz

[bar]
.
&lt;p&gt;Foo
[bar]: /baz&lt;/p&gt;
&lt;p&gt;[bar]&lt;/p&gt;
</code></pre><p>However, it can directly follow other block elements, such as headings<br>
and thematic breaks, and it need not be followed by a blank line.</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code># [Foo]
[foo]: /url
&gt; bar
.
&lt;h1&gt;&lt;a href=&quot;/url&quot;&gt;Foo&lt;/a&gt;&lt;/h1&gt;
&lt;blockquote&gt;
&lt;p&gt;bar&lt;/p&gt;
&lt;/blockquote&gt;
</code></pre><p>Several [link reference definitions]<br>
can occur one after another, without intervening blank lines.</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>[foo]: /foo-url &quot;foo&quot;
[bar]: /bar-url
  &quot;bar&quot;
[baz]: /baz-url

[foo],
[bar],
[baz]
.
&lt;p&gt;&lt;a href=&quot;/foo-url&quot; title=&quot;foo&quot;&gt;foo&lt;/a&gt;,
&lt;a href=&quot;/bar-url&quot; title=&quot;bar&quot;&gt;bar&lt;/a&gt;,
&lt;a href=&quot;/baz-url&quot;&gt;baz&lt;/a&gt;&lt;/p&gt;
</code></pre><p>[Link reference definitions] can occur<br>
inside block containers, like lists and block quotations.  They<br>
affect the entire document, not just the container in which they<br>
are defined:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>[foo]

&gt; [foo]: /url
.
&lt;p&gt;&lt;a href=&quot;/url&quot;&gt;foo&lt;/a&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;/blockquote&gt;
</code></pre><h2 class="mume-header" id="paragraphs">Paragraphs</h2>

<p>A sequence of non-blank lines that cannot be interpreted as other<br>
kinds of blocks forms a <a href="@">paragraph</a>.<br>
The contents of the paragraph are the result of parsing the<br>
paragraph&apos;s raw content as inlines.  The paragraph&apos;s raw content<br>
is formed by concatenating the lines and removing initial and final<br>
[whitespace].</p>
<p>A simple example with two paragraphs:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>aaa

bbb
.
&lt;p&gt;aaa&lt;/p&gt;
&lt;p&gt;bbb&lt;/p&gt;
</code></pre><p>Paragraphs can contain multiple lines, but no blank lines:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>aaa
bbb

ccc
ddd
.
&lt;p&gt;aaa
bbb&lt;/p&gt;
&lt;p&gt;ccc
ddd&lt;/p&gt;
</code></pre><p>Multiple blank lines between paragraph have no effect:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>aaa


bbb
.
&lt;p&gt;aaa&lt;/p&gt;
&lt;p&gt;bbb&lt;/p&gt;
</code></pre><p>Leading spaces are skipped:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>  aaa
 bbb
.
&lt;p&gt;aaa
bbb&lt;/p&gt;
</code></pre><p>Lines after the first may be indented any amount, since indented<br>
code blocks cannot interrupt paragraphs.</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>aaa
             bbb
                                       ccc
.
&lt;p&gt;aaa
bbb
ccc&lt;/p&gt;
</code></pre><p>However, the first line may be indented at most three spaces,<br>
or an indented code block will be triggered:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>   aaa
bbb
.
&lt;p&gt;aaa
bbb&lt;/p&gt;
</code></pre><pre data-role="codeBlock" data-info="example" class="language-example"><code>    aaa
bbb
.
&lt;pre&gt;&lt;code&gt;aaa
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;bbb&lt;/p&gt;
</code></pre><p>Final spaces are stripped before inline parsing, so a paragraph<br>
that ends with two or more spaces will not end with a [hard line<br>
break]:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>aaa     
bbb     
.
&lt;p&gt;aaa&lt;br /&gt;
bbb&lt;/p&gt;
</code></pre><h2 class="mume-header" id="blank-lines">Blank lines</h2>

<p>[Blank lines] between block-level elements are ignored,<br>
except for the role they play in determining whether a [list]<br>
is [tight] or [loose].</p>
<p>Blank lines at the beginning and end of the document are also ignored.</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>  

aaa
  

# aaa

  
.
&lt;p&gt;aaa&lt;/p&gt;
&lt;h1&gt;aaa&lt;/h1&gt;
</code></pre><div class="extension">
<h2>Tables (extension)</h2>
<p>GFM enables the <code>table</code> extension, where an additional leaf block type is<br>
available.</p>
<p>A <a href="@">table</a> is an arrangement of data with rows and columns, consisting of a<br>
single header row, a [delimiter row] separating the header from the data, and<br>
zero or more data rows.</p>
<p>Each row consists of cells containing arbitrary text, in which [inlines] are<br>
parsed, separated by pipes (<code>|</code>).  A leading and trailing pipe is also<br>
recommended for clarity of reading, and if there&apos;s otherwise parsing ambiguity.<br>
Spaces between pipes and cell content are trimmed.  Block-level elements cannot<br>
be inserted in a table.</p>
<p>The <a href="@">delimiter row</a> consists of cells whose only content are hyphens (<code>-</code>),<br>
and optionally, a leading or trailing colon (<code>:</code>), or both, to indicate left,<br>
right, or center alignment respectively.</p>
<pre data-role="codeBlock" data-info="example table" class="language-example"><code>| foo | bar |
| --- | --- |
| baz | bim |
.
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;foo&lt;/th&gt;
&lt;th&gt;bar&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;baz&lt;/td&gt;
&lt;td&gt;bim&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
</code></pre><p>Cells in one column don&apos;t need to match length, though it&apos;s easier to read if<br>
they are. Likewise, use of leading and trailing pipes may be inconsistent:</p>
<pre data-role="codeBlock" data-info="example table" class="language-example"><code>| abc | defghi |
:-: | -----------:
bar | baz
.
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th align=&quot;center&quot;&gt;abc&lt;/th&gt;
&lt;th align=&quot;right&quot;&gt;defghi&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td align=&quot;center&quot;&gt;bar&lt;/td&gt;
&lt;td align=&quot;right&quot;&gt;baz&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
</code></pre><p>Include a pipe in a cell&apos;s content by escaping it, including inside other<br>
inline spans:</p>
<pre data-role="codeBlock" data-info="example table" class="language-example"><code>| f\|oo  |
| ------ |
| b `\|` az |
| b **\|** im |
.
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;f|oo&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;b &lt;code&gt;|&lt;/code&gt; az&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;b &lt;strong&gt;|&lt;/strong&gt; im&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
</code></pre><p>The table is broken at the first empty line, or beginning of another<br>
block-level structure:</p>
<pre data-role="codeBlock" data-info="example table" class="language-example"><code>| abc | def |
| --- | --- |
| bar | baz |
&gt; bar
.
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;abc&lt;/th&gt;
&lt;th&gt;def&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;bar&lt;/td&gt;
&lt;td&gt;baz&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;blockquote&gt;
&lt;p&gt;bar&lt;/p&gt;
&lt;/blockquote&gt;
</code></pre><pre data-role="codeBlock" data-info="example table" class="language-example"><code>| abc | def |
| --- | --- |
| bar | baz |
bar

bar
.
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;abc&lt;/th&gt;
&lt;th&gt;def&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;bar&lt;/td&gt;
&lt;td&gt;baz&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;bar&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;bar&lt;/p&gt;
</code></pre><p>The header row must match the [delimiter row] in the number of cells.  If not,<br>
a table will not be recognized:</p>
<pre data-role="codeBlock" data-info="example table" class="language-example"><code>| abc | def |
| --- |
| bar |
.
&lt;p&gt;| abc | def |
| --- |
| bar |&lt;/p&gt;
</code></pre><p>The remainder of the table&apos;s rows may vary in the number of cells.  If there<br>
are a number of cells fewer than the number of cells in the header row, empty<br>
cells are inserted.  If there are greater, the excess is ignored:</p>
<pre data-role="codeBlock" data-info="example table" class="language-example"><code>| abc | def |
| --- | --- |
| bar |
| bar | baz | boo |
.
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;abc&lt;/th&gt;
&lt;th&gt;def&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;bar&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;bar&lt;/td&gt;
&lt;td&gt;baz&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
</code></pre><p>If there are no rows in the body, no <code>&lt;tbody&gt;</code> is generated in HTML output:</p>
<pre data-role="codeBlock" data-info="example table" class="language-example"><code>| abc | def |
| --- | --- |
.
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;abc&lt;/th&gt;
&lt;th&gt;def&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;/table&gt;
</code></pre></div>
<h1 class="mume-header" id="container-blocks">Container blocks</h1>

<p>A <a href="#container-blocks">container block</a> is a block that has other<br>
blocks as its contents.  There are two basic kinds of container blocks:<br>
[block quotes] and [list items].<br>
[Lists] are meta-containers for [list items].</p>
<p>We define the syntax for container blocks recursively.  The general<br>
form of the definition is:</p>
<blockquote>
<p>If X is a sequence of blocks, then the result of<br>
transforming X in such-and-such a way is a container of type Y<br>
with these blocks as its content.</p>
</blockquote>
<p>So, we explain what counts as a block quote or list item by explaining<br>
how these can be <em>generated</em> from their contents. This should suffice<br>
to define the syntax, although it does not give a recipe for <em>parsing</em><br>
these constructions.  (A recipe is provided below in the section entitled<br>
<a href="#appendix-a-parsing-strategy">A parsing strategy</a>.)</p>
<h2 class="mume-header" id="block-quotes">Block quotes</h2>

<p>A <a href="@">block quote marker</a><br>
consists of 0-3 spaces of initial indent, plus (a) the character <code>&gt;</code> together<br>
with a following space, or (b) a single character <code>&gt;</code> not followed by a space.</p>
<p>The following rules define [block quotes]:</p>
<ol>
<li>
<p><strong>Basic case.</strong>  If a string of lines <em>Ls</em> constitute a sequence<br>
of blocks <em>Bs</em>, then the result of prepending a [block quote<br>
marker] to the beginning of each line in <em>Ls</em><br>
is a <a href="#block-quotes">block quote</a> containing <em>Bs</em>.</p>
</li>
<li>
<p><strong>Laziness.</strong>  If a string of lines <em>Ls</em> constitute a <a href="#block-quotes">block<br>
quote</a> with contents <em>Bs</em>, then the result of deleting<br>
the initial [block quote marker] from one or<br>
more lines in which the next [non-whitespace character] after the [block<br>
quote marker] is [paragraph continuation<br>
text] is a block quote with <em>Bs</em> as its content.<br>
<a href="@">Paragraph continuation text</a> is text<br>
that will be parsed as part of the content of a paragraph, but does<br>
not occur at the beginning of the paragraph.</p>
</li>
<li>
<p><strong>Consecutiveness.</strong>  A document cannot contain two [block<br>
quotes] in a row unless there is a [blank line] between them.</p>
</li>
</ol>
<p>Nothing else counts as a <a href="#block-quotes">block quote</a>.</p>
<p>Here is a simple example:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>&gt; # Foo
&gt; bar
&gt; baz
.
&lt;blockquote&gt;
&lt;h1&gt;Foo&lt;/h1&gt;
&lt;p&gt;bar
baz&lt;/p&gt;
&lt;/blockquote&gt;
</code></pre><p>The spaces after the <code>&gt;</code> characters can be omitted:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>&gt;# Foo
&gt;bar
&gt; baz
.
&lt;blockquote&gt;
&lt;h1&gt;Foo&lt;/h1&gt;
&lt;p&gt;bar
baz&lt;/p&gt;
&lt;/blockquote&gt;
</code></pre><p>The <code>&gt;</code> characters can be indented 1-3 spaces:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>   &gt; # Foo
   &gt; bar
 &gt; baz
.
&lt;blockquote&gt;
&lt;h1&gt;Foo&lt;/h1&gt;
&lt;p&gt;bar
baz&lt;/p&gt;
&lt;/blockquote&gt;
</code></pre><p>Four spaces gives us a code block:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>    &gt; # Foo
    &gt; bar
    &gt; baz
.
&lt;pre&gt;&lt;code&gt;&amp;gt; # Foo
&amp;gt; bar
&amp;gt; baz
&lt;/code&gt;&lt;/pre&gt;
</code></pre><p>The Laziness clause allows us to omit the <code>&gt;</code> before<br>
[paragraph continuation text]:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>&gt; # Foo
&gt; bar
baz
.
&lt;blockquote&gt;
&lt;h1&gt;Foo&lt;/h1&gt;
&lt;p&gt;bar
baz&lt;/p&gt;
&lt;/blockquote&gt;
</code></pre><p>A block quote can contain some lazy and some non-lazy<br>
continuation lines:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>&gt; bar
baz
&gt; foo
.
&lt;blockquote&gt;
&lt;p&gt;bar
baz
foo&lt;/p&gt;
&lt;/blockquote&gt;
</code></pre><p>Laziness only applies to lines that would have been continuations of<br>
paragraphs had they been prepended with [block quote markers].<br>
For example, the <code>&gt;</code> cannot be omitted in the second line of</p>
<pre data-role="codeBlock" data-info="markdown" class="language-markdown"><span class="token blockquote punctuation">&gt;</span> foo
<span class="token blockquote punctuation">&gt;</span> <span class="token hr punctuation">---</span>
</pre><p>without changing the meaning:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>&gt; foo
---
.
&lt;blockquote&gt;
&lt;p&gt;foo&lt;/p&gt;
&lt;/blockquote&gt;
&lt;hr /&gt;
</code></pre><p>Similarly, if we omit the <code>&gt;</code> in the second line of</p>
<pre data-role="codeBlock" data-info="markdown" class="language-markdown"><span class="token blockquote punctuation">&gt;</span> <span class="token list punctuation">-</span> foo
<span class="token blockquote punctuation">&gt;</span> <span class="token list punctuation">-</span> bar
</pre><p>then the block quote ends after the first line:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>&gt; - foo
- bar
.
&lt;blockquote&gt;
&lt;ul&gt;
&lt;li&gt;foo&lt;/li&gt;
&lt;/ul&gt;
&lt;/blockquote&gt;
&lt;ul&gt;
&lt;li&gt;bar&lt;/li&gt;
&lt;/ul&gt;
</code></pre><p>For the same reason, we can&apos;t omit the <code>&gt;</code> in front of<br>
subsequent lines of an indented or fenced code block:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>&gt;     foo
    bar
.
&lt;blockquote&gt;
&lt;pre&gt;&lt;code&gt;foo
&lt;/code&gt;&lt;/pre&gt;
&lt;/blockquote&gt;
&lt;pre&gt;&lt;code&gt;bar
&lt;/code&gt;&lt;/pre&gt;
</code></pre><pre data-role="codeBlock" data-info="example" class="language-example"><code>&gt; ```
foo
```
.
&lt;blockquote&gt;
&lt;pre&gt;&lt;code&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/blockquote&gt;
&lt;p&gt;foo&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;&lt;/code&gt;&lt;/pre&gt;
</code></pre><p>Note that in the following case, we have a [lazy<br>
continuation line]:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>&gt; foo
    - bar
.
&lt;blockquote&gt;
&lt;p&gt;foo
- bar&lt;/p&gt;
&lt;/blockquote&gt;
</code></pre><p>To see why, note that in</p>
<pre data-role="codeBlock" data-info="markdown" class="language-markdown"><span class="token blockquote punctuation">&gt;</span> foo
<span class="token blockquote punctuation">&gt;</span>     <span class="token list punctuation">-</span> bar
</pre><p>the <code>- bar</code> is indented too far to start a list, and can&apos;t<br>
be an indented code block because indented code blocks cannot<br>
interrupt paragraphs, so it is [paragraph continuation text].</p>
<p>A block quote can be empty:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>&gt;
.
&lt;blockquote&gt;
&lt;/blockquote&gt;
</code></pre><pre data-role="codeBlock" data-info="example" class="language-example"><code>&gt;
&gt;  
&gt; 
.
&lt;blockquote&gt;
&lt;/blockquote&gt;
</code></pre><p>A block quote can have initial or final blank lines:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>&gt;
&gt; foo
&gt;  
.
&lt;blockquote&gt;
&lt;p&gt;foo&lt;/p&gt;
&lt;/blockquote&gt;
</code></pre><p>A blank line always separates block quotes:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>&gt; foo

&gt; bar
.
&lt;blockquote&gt;
&lt;p&gt;foo&lt;/p&gt;
&lt;/blockquote&gt;
&lt;blockquote&gt;
&lt;p&gt;bar&lt;/p&gt;
&lt;/blockquote&gt;
</code></pre><p>(Most current Markdown implementations, including John Gruber&apos;s<br>
original <code>Markdown.pl</code>, will parse this example as a single block quote<br>
with two paragraphs.  But it seems better to allow the author to decide<br>
whether two block quotes or one are wanted.)</p>
<p>Consecutiveness means that if we put these block quotes together,<br>
we get a single block quote:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>&gt; foo
&gt; bar
.
&lt;blockquote&gt;
&lt;p&gt;foo
bar&lt;/p&gt;
&lt;/blockquote&gt;
</code></pre><p>To get a block quote with two paragraphs, use:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>&gt; foo
&gt;
&gt; bar
.
&lt;blockquote&gt;
&lt;p&gt;foo&lt;/p&gt;
&lt;p&gt;bar&lt;/p&gt;
&lt;/blockquote&gt;
</code></pre><p>Block quotes can interrupt paragraphs:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>foo
&gt; bar
.
&lt;p&gt;foo&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;bar&lt;/p&gt;
&lt;/blockquote&gt;
</code></pre><p>In general, blank lines are not needed before or after block<br>
quotes:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>&gt; aaa
***
&gt; bbb
.
&lt;blockquote&gt;
&lt;p&gt;aaa&lt;/p&gt;
&lt;/blockquote&gt;
&lt;hr /&gt;
&lt;blockquote&gt;
&lt;p&gt;bbb&lt;/p&gt;
&lt;/blockquote&gt;
</code></pre><p>However, because of laziness, a blank line is needed between<br>
a block quote and a following paragraph:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>&gt; bar
baz
.
&lt;blockquote&gt;
&lt;p&gt;bar
baz&lt;/p&gt;
&lt;/blockquote&gt;
</code></pre><pre data-role="codeBlock" data-info="example" class="language-example"><code>&gt; bar

baz
.
&lt;blockquote&gt;
&lt;p&gt;bar&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;baz&lt;/p&gt;
</code></pre><pre data-role="codeBlock" data-info="example" class="language-example"><code>&gt; bar
&gt;
baz
.
&lt;blockquote&gt;
&lt;p&gt;bar&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;baz&lt;/p&gt;
</code></pre><p>It is a consequence of the Laziness rule that any number<br>
of initial <code>&gt;</code>s may be omitted on a continuation line of a<br>
nested block quote:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>&gt; &gt; &gt; foo
bar
.
&lt;blockquote&gt;
&lt;blockquote&gt;
&lt;blockquote&gt;
&lt;p&gt;foo
bar&lt;/p&gt;
&lt;/blockquote&gt;
&lt;/blockquote&gt;
&lt;/blockquote&gt;
</code></pre><pre data-role="codeBlock" data-info="example" class="language-example"><code>&gt;&gt;&gt; foo
&gt; bar
&gt;&gt;baz
.
&lt;blockquote&gt;
&lt;blockquote&gt;
&lt;blockquote&gt;
&lt;p&gt;foo
bar
baz&lt;/p&gt;
&lt;/blockquote&gt;
&lt;/blockquote&gt;
&lt;/blockquote&gt;
</code></pre><p>When including an indented code block in a block quote,<br>
remember that the [block quote marker] includes<br>
both the <code>&gt;</code> and a following space.  So <em>five spaces</em> are needed after<br>
the <code>&gt;</code>:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>&gt;     code

&gt;    not code
.
&lt;blockquote&gt;
&lt;pre&gt;&lt;code&gt;code
&lt;/code&gt;&lt;/pre&gt;
&lt;/blockquote&gt;
&lt;blockquote&gt;
&lt;p&gt;not code&lt;/p&gt;
&lt;/blockquote&gt;
</code></pre><h2 class="mume-header" id="list-items">List items</h2>

<p>A <a href="@">list marker</a> is a<br>
[bullet list marker] or an [ordered list marker].</p>
<p>A <a href="@">bullet list marker</a><br>
is a <code>-</code>, <code>+</code>, or <code>*</code> character.</p>
<p>An <a href="@">ordered list marker</a><br>
is a sequence of 1--9 arabic digits (<code>0-9</code>), followed by either a<br>
<code>.</code> character or a <code>)</code> character.  (The reason for the length<br>
limit is that with 10 digits we start seeing integer overflows<br>
in some browsers.)</p>
<p>The following rules define [list items]:</p>
<ol>
<li>
<p><strong>Basic case.</strong>  If a sequence of lines <em>Ls</em> constitute a sequence of<br>
blocks <em>Bs</em> starting with a [non-whitespace character] and not separated<br>
from each other by more than one blank line, and <em>M</em> is a list<br>
marker of width <em>W</em> followed by 1 &#x2264; <em>N</em> &#x2264; 4 spaces, then the result<br>
of prepending <em>M</em> and the following spaces to the first line of<br>
<em>Ls</em>, and indenting subsequent lines of <em>Ls</em> by <em>W + N</em> spaces, is a<br>
list item with <em>Bs</em> as its contents.  The type of the list item<br>
(bullet or ordered) is determined by the type of its list marker.<br>
If the list item is ordered, then it is also assigned a start<br>
number, based on the ordered list marker.</p>
<p>Exceptions:</p>
<ol>
<li>When the first list item in a [list] interrupts<br>
a paragraph---that is, when it starts on a line that would<br>
otherwise count as [paragraph continuation text]---then (a)<br>
the lines <em>Ls</em> must not begin with a blank line, and (b) if<br>
the list item is ordered, the start number must be 1.</li>
<li>If any line is a [thematic break][thematic breaks] then<br>
that line is not a list item.</li>
</ol>
</li>
</ol>
<p>For example, let <em>Ls</em> be the lines</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>A paragraph
with two lines.

    indented code

&gt; A block quote.
.
&lt;p&gt;A paragraph
with two lines.&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;indented code
&lt;/code&gt;&lt;/pre&gt;
&lt;blockquote&gt;
&lt;p&gt;A block quote.&lt;/p&gt;
&lt;/blockquote&gt;
</code></pre><p>And let <em>M</em> be the marker <code>1.</code>, and <em>N</em> = 2.  Then rule #1 says<br>
that the following is an ordered list item with start number 1,<br>
and the same contents as <em>Ls</em>:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>1.  A paragraph
    with two lines.

        indented code

    &gt; A block quote.
.
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;A paragraph
with two lines.&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;indented code
&lt;/code&gt;&lt;/pre&gt;
&lt;blockquote&gt;
&lt;p&gt;A block quote.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;/li&gt;
&lt;/ol&gt;
</code></pre><p>The most important thing to notice is that the position of<br>
the text after the list marker determines how much indentation<br>
is needed in subsequent blocks in the list item.  If the list<br>
marker takes up two spaces, and there are three spaces between<br>
the list marker and the next [non-whitespace character], then blocks<br>
must be indented five spaces in order to fall under the list<br>
item.</p>
<p>Here are some examples showing how far content must be indented to be<br>
put under the list item:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>- one

 two
.
&lt;ul&gt;
&lt;li&gt;one&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;two&lt;/p&gt;
</code></pre><pre data-role="codeBlock" data-info="example" class="language-example"><code>- one

  two
.
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;one&lt;/p&gt;
&lt;p&gt;two&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
</code></pre><pre data-role="codeBlock" data-info="example" class="language-example"><code> -    one

     two
.
&lt;ul&gt;
&lt;li&gt;one&lt;/li&gt;
&lt;/ul&gt;
&lt;pre&gt;&lt;code&gt; two
&lt;/code&gt;&lt;/pre&gt;
</code></pre><pre data-role="codeBlock" data-info="example" class="language-example"><code> -    one

      two
.
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;one&lt;/p&gt;
&lt;p&gt;two&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
</code></pre><p>It is tempting to think of this in terms of columns:  the continuation<br>
blocks must be indented at least to the column of the first<br>
[non-whitespace character] after the list marker. However, that is not quite right.<br>
The spaces after the list marker determine how much relative indentation<br>
is needed.  Which column this indentation reaches will depend on<br>
how the list item is embedded in other constructions, as shown by<br>
this example:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>   &gt; &gt; 1.  one
&gt;&gt;
&gt;&gt;     two
.
&lt;blockquote&gt;
&lt;blockquote&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;one&lt;/p&gt;
&lt;p&gt;two&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;/blockquote&gt;
&lt;/blockquote&gt;
</code></pre><p>Here <code>two</code> occurs in the same column as the list marker <code>1.</code>,<br>
but is actually contained in the list item, because there is<br>
sufficient indentation after the last containing blockquote marker.</p>
<p>The converse is also possible.  In the following example, the word <code>two</code><br>
occurs far to the right of the initial text of the list item, <code>one</code>, but<br>
it is not considered part of the list item, because it is not indented<br>
far enough past the blockquote marker:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>&gt;&gt;- one
&gt;&gt;
  &gt;  &gt; two
.
&lt;blockquote&gt;
&lt;blockquote&gt;
&lt;ul&gt;
&lt;li&gt;one&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;two&lt;/p&gt;
&lt;/blockquote&gt;
&lt;/blockquote&gt;
</code></pre><p>Note that at least one space is needed between the list marker and<br>
any following content, so these are not list items:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>-one

2.two
.
&lt;p&gt;-one&lt;/p&gt;
&lt;p&gt;2.two&lt;/p&gt;
</code></pre><p>A list item may contain blocks that are separated by more than<br>
one blank line.</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>- foo


  bar
.
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;foo&lt;/p&gt;
&lt;p&gt;bar&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
</code></pre><p>A list item may contain any kind of block:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>1.  foo

    ```
    bar
    ```

    baz

    &gt; bam
.
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;foo&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;bar
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;baz&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;bam&lt;/p&gt;
&lt;/blockquote&gt;
&lt;/li&gt;
&lt;/ol&gt;
</code></pre><p>A list item that contains an indented code block will preserve<br>
empty lines within the code block verbatim.</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>- Foo

      bar


      baz
.
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;Foo&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;bar


baz
&lt;/code&gt;&lt;/pre&gt;
&lt;/li&gt;
&lt;/ul&gt;
</code></pre><p>Note that ordered list start numbers must be nine digits or less:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>123456789. ok
.
&lt;ol start=&quot;123456789&quot;&gt;
&lt;li&gt;ok&lt;/li&gt;
&lt;/ol&gt;
</code></pre><pre data-role="codeBlock" data-info="example" class="language-example"><code>1234567890. not ok
.
&lt;p&gt;1234567890. not ok&lt;/p&gt;
</code></pre><p>A start number may begin with 0s:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>0. ok
.
&lt;ol start=&quot;0&quot;&gt;
&lt;li&gt;ok&lt;/li&gt;
&lt;/ol&gt;
</code></pre><pre data-role="codeBlock" data-info="example" class="language-example"><code>003. ok
.
&lt;ol start=&quot;3&quot;&gt;
&lt;li&gt;ok&lt;/li&gt;
&lt;/ol&gt;
</code></pre><p>A start number may not be negative:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>-1. not ok
.
&lt;p&gt;-1. not ok&lt;/p&gt;
</code></pre><ol start="2">
<li><strong>Item starting with indented code.</strong>  If a sequence of lines <em>Ls</em><br>
constitute a sequence of blocks <em>Bs</em> starting with an indented code<br>
block and not separated from each other by more than one blank line,<br>
and <em>M</em> is a list marker of width <em>W</em> followed by<br>
one space, then the result of prepending <em>M</em> and the following<br>
space to the first line of <em>Ls</em>, and indenting subsequent lines of<br>
<em>Ls</em> by <em>W + 1</em> spaces, is a list item with <em>Bs</em> as its contents.<br>
If a line is empty, then it need not be indented.  The type of the<br>
list item (bullet or ordered) is determined by the type of its list<br>
marker.  If the list item is ordered, then it is also assigned a<br>
start number, based on the ordered list marker.</li>
</ol>
<p>An indented code block will have to be indented four spaces beyond<br>
the edge of the region where text will be included in the list item.<br>
In the following case that is 6 spaces:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>- foo

      bar
.
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;foo&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;bar
&lt;/code&gt;&lt;/pre&gt;
&lt;/li&gt;
&lt;/ul&gt;
</code></pre><p>And in this case it is 11 spaces:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>  10.  foo

           bar
.
&lt;ol start=&quot;10&quot;&gt;
&lt;li&gt;
&lt;p&gt;foo&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;bar
&lt;/code&gt;&lt;/pre&gt;
&lt;/li&gt;
&lt;/ol&gt;
</code></pre><p>If the <em>first</em> block in the list item is an indented code block,<br>
then by rule #2, the contents must be indented <em>one</em> space after the<br>
list marker:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>    indented code

paragraph

    more code
.
&lt;pre&gt;&lt;code&gt;indented code
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;paragraph&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;more code
&lt;/code&gt;&lt;/pre&gt;
</code></pre><pre data-role="codeBlock" data-info="example" class="language-example"><code>1.     indented code

   paragraph

       more code
.
&lt;ol&gt;
&lt;li&gt;
&lt;pre&gt;&lt;code&gt;indented code
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;paragraph&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;more code
&lt;/code&gt;&lt;/pre&gt;
&lt;/li&gt;
&lt;/ol&gt;
</code></pre><p>Note that an additional space indent is interpreted as space<br>
inside the code block:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>1.      indented code

   paragraph

       more code
.
&lt;ol&gt;
&lt;li&gt;
&lt;pre&gt;&lt;code&gt; indented code
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;paragraph&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;more code
&lt;/code&gt;&lt;/pre&gt;
&lt;/li&gt;
&lt;/ol&gt;
</code></pre><p>Note that rules #1 and #2 only apply to two cases:  (a) cases<br>
in which the lines to be included in a list item begin with a<br>
[non-whitespace character], and (b) cases in which<br>
they begin with an indented code<br>
block.  In a case like the following, where the first block begins with<br>
a three-space indent, the rules do not allow us to form a list item by<br>
indenting the whole thing and prepending a list marker:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>   foo

bar
.
&lt;p&gt;foo&lt;/p&gt;
&lt;p&gt;bar&lt;/p&gt;
</code></pre><pre data-role="codeBlock" data-info="example" class="language-example"><code>-    foo

  bar
.
&lt;ul&gt;
&lt;li&gt;foo&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;bar&lt;/p&gt;
</code></pre><p>This is not a significant restriction, because when a block begins<br>
with 1-3 spaces indent, the indentation can always be removed without<br>
a change in interpretation, allowing rule #1 to be applied.  So, in<br>
the above case:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>-  foo

   bar
.
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;foo&lt;/p&gt;
&lt;p&gt;bar&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
</code></pre><ol start="3">
<li><strong>Item starting with a blank line.</strong>  If a sequence of lines <em>Ls</em><br>
starting with a single [blank line] constitute a (possibly empty)<br>
sequence of blocks <em>Bs</em>, not separated from each other by more than<br>
one blank line, and <em>M</em> is a list marker of width <em>W</em>,<br>
then the result of prepending <em>M</em> to the first line of <em>Ls</em>, and<br>
indenting subsequent lines of <em>Ls</em> by <em>W + 1</em> spaces, is a list<br>
item with <em>Bs</em> as its contents.<br>
If a line is empty, then it need not be indented.  The type of the<br>
list item (bullet or ordered) is determined by the type of its list<br>
marker.  If the list item is ordered, then it is also assigned a<br>
start number, based on the ordered list marker.</li>
</ol>
<p>Here are some list items that start with a blank line but are not empty:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>-
  foo
-
  ```
  bar
  ```
-
      baz
.
&lt;ul&gt;
&lt;li&gt;foo&lt;/li&gt;
&lt;li&gt;
&lt;pre&gt;&lt;code&gt;bar
&lt;/code&gt;&lt;/pre&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;pre&gt;&lt;code&gt;baz
&lt;/code&gt;&lt;/pre&gt;
&lt;/li&gt;
&lt;/ul&gt;
</code></pre><p>When the list item starts with a blank line, the number of spaces<br>
following the list marker doesn&apos;t change the required indentation:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>-   
  foo
.
&lt;ul&gt;
&lt;li&gt;foo&lt;/li&gt;
&lt;/ul&gt;
</code></pre><p>A list item can begin with at most one blank line.<br>
In the following example, <code>foo</code> is not part of the list<br>
item:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>-

  foo
.
&lt;ul&gt;
&lt;li&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;foo&lt;/p&gt;
</code></pre><p>Here is an empty bullet list item:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>- foo
-
- bar
.
&lt;ul&gt;
&lt;li&gt;foo&lt;/li&gt;
&lt;li&gt;&lt;/li&gt;
&lt;li&gt;bar&lt;/li&gt;
&lt;/ul&gt;
</code></pre><p>It does not matter whether there are spaces following the [list marker]:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>- foo
-   
- bar
.
&lt;ul&gt;
&lt;li&gt;foo&lt;/li&gt;
&lt;li&gt;&lt;/li&gt;
&lt;li&gt;bar&lt;/li&gt;
&lt;/ul&gt;
</code></pre><p>Here is an empty ordered list item:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>1. foo
2.
3. bar
.
&lt;ol&gt;
&lt;li&gt;foo&lt;/li&gt;
&lt;li&gt;&lt;/li&gt;
&lt;li&gt;bar&lt;/li&gt;
&lt;/ol&gt;
</code></pre><p>A list may start or end with an empty list item:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>*
.
&lt;ul&gt;
&lt;li&gt;&lt;/li&gt;
&lt;/ul&gt;
</code></pre><p>However, an empty list item cannot interrupt a paragraph:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>foo
*

foo
1.
.
&lt;p&gt;foo
*&lt;/p&gt;
&lt;p&gt;foo
1.&lt;/p&gt;
</code></pre><ol start="4">
<li><strong>Indentation.</strong>  If a sequence of lines <em>Ls</em> constitutes a list item<br>
according to rule #1, #2, or #3, then the result of indenting each line<br>
of <em>Ls</em> by 1-3 spaces (the same for each line) also constitutes a<br>
list item with the same contents and attributes.  If a line is<br>
empty, then it need not be indented.</li>
</ol>
<p>Indented one space:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code> 1.  A paragraph
     with two lines.

         indented code

     &gt; A block quote.
.
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;A paragraph
with two lines.&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;indented code
&lt;/code&gt;&lt;/pre&gt;
&lt;blockquote&gt;
&lt;p&gt;A block quote.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;/li&gt;
&lt;/ol&gt;
</code></pre><p>Indented two spaces:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>  1.  A paragraph
      with two lines.

          indented code

      &gt; A block quote.
.
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;A paragraph
with two lines.&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;indented code
&lt;/code&gt;&lt;/pre&gt;
&lt;blockquote&gt;
&lt;p&gt;A block quote.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;/li&gt;
&lt;/ol&gt;
</code></pre><p>Indented three spaces:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>   1.  A paragraph
       with two lines.

           indented code

       &gt; A block quote.
.
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;A paragraph
with two lines.&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;indented code
&lt;/code&gt;&lt;/pre&gt;
&lt;blockquote&gt;
&lt;p&gt;A block quote.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;/li&gt;
&lt;/ol&gt;
</code></pre><p>Four spaces indent gives a code block:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>    1.  A paragraph
        with two lines.

            indented code

        &gt; A block quote.
.
&lt;pre&gt;&lt;code&gt;1.  A paragraph
    with two lines.

        indented code

    &amp;gt; A block quote.
&lt;/code&gt;&lt;/pre&gt;
</code></pre><ol start="5">
<li><strong>Laziness.</strong>  If a string of lines <em>Ls</em> constitute a <a href="#list-items">list<br>
item</a> with contents <em>Bs</em>, then the result of deleting<br>
some or all of the indentation from one or more lines in which the<br>
next [non-whitespace character] after the indentation is<br>
[paragraph continuation text] is a<br>
list item with the same contents and attributes.  The unindented<br>
lines are called<br>
<a href="@">lazy continuation line</a>s.</li>
</ol>
<p>Here is an example with [lazy continuation lines]:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>  1.  A paragraph
with two lines.

          indented code

      &gt; A block quote.
.
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;A paragraph
with two lines.&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;indented code
&lt;/code&gt;&lt;/pre&gt;
&lt;blockquote&gt;
&lt;p&gt;A block quote.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;/li&gt;
&lt;/ol&gt;
</code></pre><p>Indentation can be partially deleted:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>  1.  A paragraph
    with two lines.
.
&lt;ol&gt;
&lt;li&gt;A paragraph
with two lines.&lt;/li&gt;
&lt;/ol&gt;
</code></pre><p>These examples show how laziness can work in nested structures:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>&gt; 1. &gt; Blockquote
continued here.
.
&lt;blockquote&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;blockquote&gt;
&lt;p&gt;Blockquote
continued here.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;/blockquote&gt;
</code></pre><pre data-role="codeBlock" data-info="example" class="language-example"><code>&gt; 1. &gt; Blockquote
&gt; continued here.
.
&lt;blockquote&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;blockquote&gt;
&lt;p&gt;Blockquote
continued here.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;/blockquote&gt;
</code></pre><ol start="6">
<li><strong>That&apos;s all.</strong> Nothing that is not counted as a list item by rules<br>
#1--5 counts as a <a href="#list-items">list item</a>.</li>
</ol>
<p>The rules for sublists follow from the general rules<br>
[above][List items].  A sublist must be indented the same number<br>
of spaces a paragraph would need to be in order to be included<br>
in the list item.</p>
<p>So, in this case we need two spaces indent:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>- foo
  - bar
    - baz
      - boo
.
&lt;ul&gt;
&lt;li&gt;foo
&lt;ul&gt;
&lt;li&gt;bar
&lt;ul&gt;
&lt;li&gt;baz
&lt;ul&gt;
&lt;li&gt;boo&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
</code></pre><p>One is not enough:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>- foo
 - bar
  - baz
   - boo
.
&lt;ul&gt;
&lt;li&gt;foo&lt;/li&gt;
&lt;li&gt;bar&lt;/li&gt;
&lt;li&gt;baz&lt;/li&gt;
&lt;li&gt;boo&lt;/li&gt;
&lt;/ul&gt;
</code></pre><p>Here we need four, because the list marker is wider:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>10) foo
    - bar
.
&lt;ol start=&quot;10&quot;&gt;
&lt;li&gt;foo
&lt;ul&gt;
&lt;li&gt;bar&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
</code></pre><p>Three is not enough:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>10) foo
   - bar
.
&lt;ol start=&quot;10&quot;&gt;
&lt;li&gt;foo&lt;/li&gt;
&lt;/ol&gt;
&lt;ul&gt;
&lt;li&gt;bar&lt;/li&gt;
&lt;/ul&gt;
</code></pre><p>A list may be the first block in a list item:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>- - foo
.
&lt;ul&gt;
&lt;li&gt;
&lt;ul&gt;
&lt;li&gt;foo&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
</code></pre><pre data-role="codeBlock" data-info="example" class="language-example"><code>1. - 2. foo
.
&lt;ol&gt;
&lt;li&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;ol start=&quot;2&quot;&gt;
&lt;li&gt;foo&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
</code></pre><p>A list item can contain a heading:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>- # Foo
- Bar
  ---
  baz
.
&lt;ul&gt;
&lt;li&gt;
&lt;h1&gt;Foo&lt;/h1&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;h2&gt;Bar&lt;/h2&gt;
baz&lt;/li&gt;
&lt;/ul&gt;
</code></pre><h3 class="mume-header" id="motivation">Motivation</h3>

<p>John Gruber&apos;s Markdown spec says the following about list items:</p>
<ol>
<li>
<p>&quot;List markers typically start at the left margin, but may be indented<br>
by up to three spaces. List markers must be followed by one or more<br>
spaces or a tab.&quot;</p>
</li>
<li>
<p>&quot;To make lists look nice, you can wrap items with hanging indents....<br>
But if you don&apos;t want to, you don&apos;t have to.&quot;</p>
</li>
<li>
<p>&quot;List items may consist of multiple paragraphs. Each subsequent<br>
paragraph in a list item must be indented by either 4 spaces or one<br>
tab.&quot;</p>
</li>
<li>
<p>&quot;It looks nice if you indent every line of the subsequent paragraphs,<br>
but here again, Markdown will allow you to be lazy.&quot;</p>
</li>
<li>
<p>&quot;To put a blockquote within a list item, the blockquote&apos;s <code>&gt;</code><br>
delimiters need to be indented.&quot;</p>
</li>
<li>
<p>&quot;To put a code block within a list item, the code block needs to be<br>
indented twice &#x2014; 8 spaces or two tabs.&quot;</p>
</li>
</ol>
<p>These rules specify that a paragraph under a list item must be indented<br>
four spaces (presumably, from the left margin, rather than the start of<br>
the list marker, but this is not said), and that code under a list item<br>
must be indented eight spaces instead of the usual four.  They also say<br>
that a block quote must be indented, but not by how much; however, the<br>
example given has four spaces indentation.  Although nothing is said<br>
about other kinds of block-level content, it is certainly reasonable to<br>
infer that <em>all</em> block elements under a list item, including other<br>
lists, must be indented four spaces.  This principle has been called the<br>
<em>four-space rule</em>.</p>
<p>The four-space rule is clear and principled, and if the reference<br>
implementation <code>Markdown.pl</code> had followed it, it probably would have<br>
become the standard.  However, <code>Markdown.pl</code> allowed paragraphs and<br>
sublists to start with only two spaces indentation, at least on the<br>
outer level.  Worse, its behavior was inconsistent: a sublist of an<br>
outer-level list needed two spaces indentation, but a sublist of this<br>
sublist needed three spaces.  It is not surprising, then, that different<br>
implementations of Markdown have developed very different rules for<br>
determining what comes under a list item.  (Pandoc and python-Markdown,<br>
for example, stuck with Gruber&apos;s syntax description and the four-space<br>
rule, while discount, redcarpet, marked, PHP Markdown, and others<br>
followed <code>Markdown.pl</code>&apos;s behavior more closely.)</p>
<p>Unfortunately, given the divergences between implementations, there<br>
is no way to give a spec for list items that will be guaranteed not<br>
to break any existing documents.  However, the spec given here should<br>
correctly handle lists formatted with either the four-space rule or<br>
the more forgiving <code>Markdown.pl</code> behavior, provided they are laid out<br>
in a way that is natural for a human to read.</p>
<p>The strategy here is to let the width and indentation of the list marker<br>
determine the indentation necessary for blocks to fall under the list<br>
item, rather than having a fixed and arbitrary number.  The writer can<br>
think of the body of the list item as a unit which gets indented to the<br>
right enough to fit the list marker (and any indentation on the list<br>
marker).  (The laziness rule, #5, then allows continuation lines to be<br>
unindented if needed.)</p>
<p>This rule is superior, we claim, to any rule requiring a fixed level of<br>
indentation from the margin.  The four-space rule is clear but<br>
unnatural. It is quite unintuitive that</p>
<pre data-role="codeBlock" data-info="markdown" class="language-markdown"><span class="token list punctuation">-</span> foo

  bar

  <span class="token list punctuation">-</span> baz
</pre><p>should be parsed as two lists with an intervening paragraph,</p>
<pre data-role="codeBlock" data-info="html" class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span>foo<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>bar<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span>baz<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">&gt;</span></span>
</pre><p>as the four-space rule demands, rather than a single list,</p>
<pre data-role="codeBlock" data-info="html" class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>foo<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>bar<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span>baz<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">&gt;</span></span>
</pre><p>The choice of four spaces is arbitrary.  It can be learned, but it is<br>
not likely to be guessed, and it trips up beginners regularly.</p>
<p>Would it help to adopt a two-space rule?  The problem is that such<br>
a rule, together with the rule allowing 1--3 spaces indentation of the<br>
initial list marker, allows text that is indented <em>less than</em> the<br>
original list marker to be included in the list item. For example,<br>
<code>Markdown.pl</code> parses</p>
<pre data-role="codeBlock" data-info="markdown" class="language-markdown">   <span class="token list punctuation">-</span> one

  two
</pre><p>as a single list item, with <code>two</code> a continuation paragraph:</p>
<pre data-role="codeBlock" data-info="html" class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>one<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>two<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">&gt;</span></span>
</pre><p>and similarly</p>
<pre data-role="codeBlock" data-info="markdown" class="language-markdown"><span class="token blockquote punctuation">&gt;</span>   <span class="token list punctuation">-</span> one
<span class="token blockquote punctuation">&gt;</span>
<span class="token blockquote punctuation">&gt;</span>  two
</pre><p>as</p>
<pre data-role="codeBlock" data-info="html" class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>blockquote</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>one<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>two<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>blockquote</span><span class="token punctuation">&gt;</span></span>
</pre><p>This is extremely unintuitive.</p>
<p>Rather than requiring a fixed indent from the margin, we could require<br>
a fixed indent (say, two spaces, or even one space) from the list marker (which<br>
may itself be indented).  This proposal would remove the last anomaly<br>
discussed.  Unlike the spec presented above, it would count the following<br>
as a list item with a subparagraph, even though the paragraph <code>bar</code><br>
is not indented as far as the first paragraph <code>foo</code>:</p>
<pre data-role="codeBlock" data-info="markdown" class="language-markdown"> <span class="token list punctuation">10.</span> foo

   bar  
</pre><p>Arguably this text does read like a list item with <code>bar</code> as a subparagraph,<br>
which may count in favor of the proposal.  However, on this proposal indented<br>
code would have to be indented six spaces after the list marker.  And this<br>
would break a lot of existing Markdown, which has the pattern:</p>
<pre data-role="codeBlock" data-info="markdown" class="language-markdown"><span class="token list punctuation">1.</span>  foo

<span class="token code keyword">        indented code</span>
</pre><p>where the code is indented eight spaces.  The spec above, by contrast, will<br>
parse this text as expected, since the code block&apos;s indentation is measured<br>
from the beginning of <code>foo</code>.</p>
<p>The one case that needs special treatment is a list item that <em>starts</em><br>
with indented code.  How much indentation is required in that case, since<br>
we don&apos;t have a &quot;first paragraph&quot; to measure from?  Rule #2 simply stipulates<br>
that in such cases, we require one space indentation from the list marker<br>
(and then the normal four spaces for the indented code).  This will match the<br>
four-space rule in cases where the list marker plus its initial indentation<br>
takes four spaces (a common case), but diverge in other cases.</p>
<div class="extension">
<h2>Task list items (extension)</h2>
<p>GFM enables the <code>tasklist</code> extension, where an additional processing step is<br>
performed on [list items].</p>
<p>A <a href="@">task list item</a> is a [list item][list items] where the first block in it<br>
is a paragraph which begins with a [task list item marker] and at least one<br>
whitespace character before any other content.</p>
<p>A <a href="@">task list item marker</a> consists of an optional number of spaces, a left<br>
bracket (<code>[</code>), either a whitespace character or the letter <code>x</code> in either<br>
lowercase or uppercase, and then a right bracket (<code>]</code>).</p>
<p>When rendered, the [task list item marker] is replaced with a semantic checkbox element;<br>
in an HTML output, this would be an <code>&lt;input type=&quot;checkbox&quot;&gt;</code> element.</p>
<p>If the character between the brackets is a whitespace character, the checkbox<br>
is unchecked.  Otherwise, the checkbox is checked.</p>
<p>This spec does not define how the checkbox elements are interacted with: in practice,<br>
implementors are free to render the checkboxes as disabled or inmutable elements,<br>
or they may dynamically handle dynamic interactions (i.e. checking, unchecking) in<br>
the final rendered document.</p>
<pre data-role="codeBlock" data-info="example disabled" class="language-example"><code>- [ ] foo
- [x] bar
.
&lt;ul&gt;
&lt;li&gt;&lt;input disabled=&quot;&quot; type=&quot;checkbox&quot;&gt; foo&lt;/li&gt;
&lt;li&gt;&lt;input checked=&quot;&quot; disabled=&quot;&quot; type=&quot;checkbox&quot;&gt; bar&lt;/li&gt;
&lt;/ul&gt;
</code></pre><p>Task lists can be arbitrarily nested:</p>
<pre data-role="codeBlock" data-info="example disabled" class="language-example"><code>- [x] foo
  - [ ] bar
  - [x] baz
- [ ] bim
.
&lt;ul&gt;
&lt;li&gt;&lt;input checked=&quot;&quot; disabled=&quot;&quot; type=&quot;checkbox&quot;&gt; foo
&lt;ul&gt;
&lt;li&gt;&lt;input disabled=&quot;&quot; type=&quot;checkbox&quot;&gt; bar&lt;/li&gt;
&lt;li&gt;&lt;input checked=&quot;&quot; disabled=&quot;&quot; type=&quot;checkbox&quot;&gt; baz&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;input disabled=&quot;&quot; type=&quot;checkbox&quot;&gt; bim&lt;/li&gt;
&lt;/ul&gt;
</code></pre></div>
<h2 class="mume-header" id="lists">Lists</h2>

<p>A <a href="@">list</a> is a sequence of one or more<br>
list items [of the same type].  The list items<br>
may be separated by any number of blank lines.</p>
<p>Two list items are <a href="@">of the same type</a><br>
if they begin with a [list marker] of the same type.<br>
Two list markers are of the<br>
same type if (a) they are bullet list markers using the same character<br>
(<code>-</code>, <code>+</code>, or <code>*</code>) or (b) they are ordered list numbers with the same<br>
delimiter (either <code>.</code> or <code>)</code>).</p>
<p>A list is an <a href="@">ordered list</a><br>
if its constituent list items begin with<br>
[ordered list markers], and a<br>
<a href="@">bullet list</a> if its constituent list<br>
items begin with [bullet list markers].</p>
<p>The <a href="@">start number</a><br>
of an [ordered list] is determined by the list number of<br>
its initial list item.  The numbers of subsequent list items are<br>
disregarded.</p>
<p>A list is <a href="@">loose</a> if any of its constituent<br>
list items are separated by blank lines, or if any of its constituent<br>
list items directly contain two block-level elements with a blank line<br>
between them.  Otherwise a list is <a href="@">tight</a>.<br>
(The difference in HTML output is that paragraphs in a loose list are<br>
wrapped in <code>&lt;p&gt;</code> tags, while paragraphs in a tight list are not.)</p>
<p>Changing the bullet or ordered list delimiter starts a new list:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>- foo
- bar
+ baz
.
&lt;ul&gt;
&lt;li&gt;foo&lt;/li&gt;
&lt;li&gt;bar&lt;/li&gt;
&lt;/ul&gt;
&lt;ul&gt;
&lt;li&gt;baz&lt;/li&gt;
&lt;/ul&gt;
</code></pre><pre data-role="codeBlock" data-info="example" class="language-example"><code>1. foo
2. bar
3) baz
.
&lt;ol&gt;
&lt;li&gt;foo&lt;/li&gt;
&lt;li&gt;bar&lt;/li&gt;
&lt;/ol&gt;
&lt;ol start=&quot;3&quot;&gt;
&lt;li&gt;baz&lt;/li&gt;
&lt;/ol&gt;
</code></pre><p>In CommonMark, a list can interrupt a paragraph. That is,<br>
no blank line is needed to separate a paragraph from a following<br>
list:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>Foo
- bar
- baz
.
&lt;p&gt;Foo&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;bar&lt;/li&gt;
&lt;li&gt;baz&lt;/li&gt;
&lt;/ul&gt;
</code></pre><p><code>Markdown.pl</code> does not allow this, through fear of triggering a list<br>
via a numeral in a hard-wrapped line:</p>
<pre data-role="codeBlock" data-info="markdown" class="language-markdown">The number of windows in my house is
<span class="token list punctuation">14.</span>  The number of doors is 6.
</pre><p>Oddly, though, <code>Markdown.pl</code> <em>does</em> allow a blockquote to<br>
interrupt a paragraph, even though the same considerations might<br>
apply.</p>
<p>In CommonMark, we do allow lists to interrupt paragraphs, for<br>
two reasons.  First, it is natural and not uncommon for people<br>
to start lists without blank lines:</p>
<pre data-role="codeBlock" data-info="markdown" class="language-markdown">I need to buy
<span class="token list punctuation">-</span> new shoes
<span class="token list punctuation">-</span> a coat
<span class="token list punctuation">-</span> a plane ticket
</pre><p>Second, we are attracted to a</p>
<blockquote>
<p><a href="@">principle of uniformity</a>:<br>
if a chunk of text has a certain<br>
meaning, it will continue to have the same meaning when put into a<br>
container block (such as a list item or blockquote).</p>
</blockquote>
<p>(Indeed, the spec for [list items] and [block quotes] presupposes<br>
this principle.) This principle implies that if</p>
<pre data-role="codeBlock" data-info="markdown" class="language-markdown">  <span class="token list punctuation">*</span> I need to buy
    <span class="token list punctuation">-</span> new shoes
    <span class="token list punctuation">-</span> a coat
    <span class="token list punctuation">-</span> a plane ticket
</pre><p>is a list item containing a paragraph followed by a nested sublist,<br>
as all Markdown implementations agree it is (though the paragraph<br>
may be rendered without <code>&lt;p&gt;</code> tags, since the list is &quot;tight&quot;),<br>
then</p>
<pre data-role="codeBlock" data-info="markdown" class="language-markdown">I need to buy
<span class="token list punctuation">-</span> new shoes
<span class="token list punctuation">-</span> a coat
<span class="token list punctuation">-</span> a plane ticket
</pre><p>by itself should be a paragraph followed by a nested sublist.</p>
<p>Since it is well established Markdown practice to allow lists to<br>
interrupt paragraphs inside list items, the [principle of<br>
uniformity] requires us to allow this outside list items as<br>
well.  (<a href="http://docutils.sourceforge.net/rst.html">reStructuredText</a><br>
takes a different approach, requiring blank lines before lists<br>
even inside other list items.)</p>
<p>In order to solve of unwanted lists in paragraphs with<br>
hard-wrapped numerals, we allow only lists starting with <code>1</code> to<br>
interrupt paragraphs.  Thus,</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>The number of windows in my house is
14.  The number of doors is 6.
.
&lt;p&gt;The number of windows in my house is
14.  The number of doors is 6.&lt;/p&gt;
</code></pre><p>We may still get an unintended result in cases like</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>The number of windows in my house is
1.  The number of doors is 6.
.
&lt;p&gt;The number of windows in my house is&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;The number of doors is 6.&lt;/li&gt;
&lt;/ol&gt;
</code></pre><p>but this rule should prevent most spurious list captures.</p>
<p>There can be any number of blank lines between items:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>- foo

- bar


- baz
.
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;foo&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;bar&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;baz&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
</code></pre><pre data-role="codeBlock" data-info="example" class="language-example"><code>- foo
  - bar
    - baz


      bim
.
&lt;ul&gt;
&lt;li&gt;foo
&lt;ul&gt;
&lt;li&gt;bar
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;baz&lt;/p&gt;
&lt;p&gt;bim&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
</code></pre><p>To separate consecutive lists of the same type, or to separate a<br>
list from an indented code block that would otherwise be parsed<br>
as a subparagraph of the final list item, you can insert a blank HTML<br>
comment:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>- foo
- bar

&lt;!-- --&gt;

- baz
- bim
.
&lt;ul&gt;
&lt;li&gt;foo&lt;/li&gt;
&lt;li&gt;bar&lt;/li&gt;
&lt;/ul&gt;
&lt;!-- --&gt;
&lt;ul&gt;
&lt;li&gt;baz&lt;/li&gt;
&lt;li&gt;bim&lt;/li&gt;
&lt;/ul&gt;
</code></pre><pre data-role="codeBlock" data-info="example" class="language-example"><code>-   foo

    notcode

-   foo

&lt;!-- --&gt;

    code
.
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;foo&lt;/p&gt;
&lt;p&gt;notcode&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;foo&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;!-- --&gt;
&lt;pre&gt;&lt;code&gt;code
&lt;/code&gt;&lt;/pre&gt;
</code></pre><p>List items need not be indented to the same level.  The following<br>
list items will be treated as items at the same list level,<br>
since none is indented enough to belong to the previous list<br>
item:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>- a
 - b
  - c
   - d
  - e
 - f
- g
.
&lt;ul&gt;
&lt;li&gt;a&lt;/li&gt;
&lt;li&gt;b&lt;/li&gt;
&lt;li&gt;c&lt;/li&gt;
&lt;li&gt;d&lt;/li&gt;
&lt;li&gt;e&lt;/li&gt;
&lt;li&gt;f&lt;/li&gt;
&lt;li&gt;g&lt;/li&gt;
&lt;/ul&gt;
</code></pre><pre data-role="codeBlock" data-info="example" class="language-example"><code>1. a

  2. b

   3. c
.
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;a&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;b&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;c&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
</code></pre><p>Note, however, that list items may not be indented more than<br>
three spaces.  Here <code>- e</code> is treated as a paragraph continuation<br>
line, because it is indented more than three spaces:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>- a
 - b
  - c
   - d
    - e
.
&lt;ul&gt;
&lt;li&gt;a&lt;/li&gt;
&lt;li&gt;b&lt;/li&gt;
&lt;li&gt;c&lt;/li&gt;
&lt;li&gt;d
- e&lt;/li&gt;
&lt;/ul&gt;
</code></pre><p>And here, <code>3. c</code> is treated as in indented code block,<br>
because it is indented four spaces and preceded by a<br>
blank line.</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>1. a

  2. b

    3. c
.
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;a&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;b&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;pre&gt;&lt;code&gt;3. c
&lt;/code&gt;&lt;/pre&gt;
</code></pre><p>This is a loose list, because there is a blank line between<br>
two of the list items:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>- a
- b

- c
.
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;a&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;b&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;c&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
</code></pre><p>So is this, with a empty second item:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>* a
*

* c
.
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;a&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;c&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
</code></pre><p>These are loose lists, even though there is no space between the items,<br>
because one of the items directly contains two block-level elements<br>
with a blank line between them:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>- a
- b

  c
- d
.
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;a&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;b&lt;/p&gt;
&lt;p&gt;c&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;d&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
</code></pre><pre data-role="codeBlock" data-info="example" class="language-example"><code>- a
- b

  [ref]: /url
- d
.
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;a&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;b&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;d&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
</code></pre><p>This is a tight list, because the blank lines are in a code block:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>- a
- ```
  b


  ```
- c
.
&lt;ul&gt;
&lt;li&gt;a&lt;/li&gt;
&lt;li&gt;
&lt;pre&gt;&lt;code&gt;b


&lt;/code&gt;&lt;/pre&gt;
&lt;/li&gt;
&lt;li&gt;c&lt;/li&gt;
&lt;/ul&gt;
</code></pre><p>This is a tight list, because the blank line is between two<br>
paragraphs of a sublist.  So the sublist is loose while<br>
the outer list is tight:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>- a
  - b

    c
- d
.
&lt;ul&gt;
&lt;li&gt;a
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;b&lt;/p&gt;
&lt;p&gt;c&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;d&lt;/li&gt;
&lt;/ul&gt;
</code></pre><p>This is a tight list, because the blank line is inside the<br>
block quote:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>* a
  &gt; b
  &gt;
* c
.
&lt;ul&gt;
&lt;li&gt;a
&lt;blockquote&gt;
&lt;p&gt;b&lt;/p&gt;
&lt;/blockquote&gt;
&lt;/li&gt;
&lt;li&gt;c&lt;/li&gt;
&lt;/ul&gt;
</code></pre><p>This list is tight, because the consecutive block elements<br>
are not separated by blank lines:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>- a
  &gt; b
  ```
  c
  ```
- d
.
&lt;ul&gt;
&lt;li&gt;a
&lt;blockquote&gt;
&lt;p&gt;b&lt;/p&gt;
&lt;/blockquote&gt;
&lt;pre&gt;&lt;code&gt;c
&lt;/code&gt;&lt;/pre&gt;
&lt;/li&gt;
&lt;li&gt;d&lt;/li&gt;
&lt;/ul&gt;
</code></pre><p>A single-paragraph list is tight:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>- a
.
&lt;ul&gt;
&lt;li&gt;a&lt;/li&gt;
&lt;/ul&gt;
</code></pre><pre data-role="codeBlock" data-info="example" class="language-example"><code>- a
  - b
.
&lt;ul&gt;
&lt;li&gt;a
&lt;ul&gt;
&lt;li&gt;b&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
</code></pre><p>This list is loose, because of the blank line between the<br>
two block elements in the list item:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>1. ```
   foo
   ```

   bar
.
&lt;ol&gt;
&lt;li&gt;
&lt;pre&gt;&lt;code&gt;foo
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;bar&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
</code></pre><p>Here the outer list is loose, the inner list tight:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>* foo
  * bar

  baz
.
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;foo&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;bar&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;baz&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
</code></pre><pre data-role="codeBlock" data-info="example" class="language-example"><code>- a
  - b
  - c

- d
  - e
  - f
.
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;a&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;b&lt;/li&gt;
&lt;li&gt;c&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;d&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;e&lt;/li&gt;
&lt;li&gt;f&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
</code></pre><h1 class="mume-header" id="inlines">Inlines</h1>

<p>Inlines are parsed sequentially from the beginning of the character<br>
stream to the end (left to right, in left-to-right languages).<br>
Thus, for example, in</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>`hi`lo`
.
&lt;p&gt;&lt;code&gt;hi&lt;/code&gt;lo`&lt;/p&gt;
</code></pre><p><code>hi</code> is parsed as code, leaving the backtick at the end as a literal<br>
backtick.</p>
<h2 class="mume-header" id="backslash-escapes">Backslash escapes</h2>

<p>Any ASCII punctuation character may be backslash-escaped:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>\!\&quot;\#\$\%\&amp;\&apos;\(\)\*\+\,\-\.\/\:\;\&lt;\=\&gt;\?\@\[\\\]\^\_\`\{\|\}\~
.
&lt;p&gt;!&amp;quot;#$%&amp;amp;&apos;()*+,-./:;&amp;lt;=&amp;gt;?@[\]^_`{|}~&lt;/p&gt;
</code></pre><p>Backslashes before other characters are treated as literal<br>
backslashes:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>\&#x2192;\A\a\ \3\&#x3C6;\&#xAB;
.
&lt;p&gt;\&#x2192;\A\a\ \3\&#x3C6;\&#xAB;&lt;/p&gt;
</code></pre><p>Escaped characters are treated as regular characters and do<br>
not have their usual Markdown meanings:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>\*not emphasized*
\&lt;br/&gt; not a tag
\[not a link](/foo)
\`not code`
1\. not a list
\* not a list
\# not a heading
\[foo]: /url &quot;not a reference&quot;
.
&lt;p&gt;*not emphasized*
&amp;lt;br/&amp;gt; not a tag
[not a link](/foo)
`not code`
1. not a list
* not a list
# not a heading
[foo]: /url &amp;quot;not a reference&amp;quot;&lt;/p&gt;
</code></pre><p>If a backslash is itself escaped, the following character is not:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>\\*emphasis*
.
&lt;p&gt;\&lt;em&gt;emphasis&lt;/em&gt;&lt;/p&gt;
</code></pre><p>A backslash at the end of the line is a [hard line break]:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>foo\
bar
.
&lt;p&gt;foo&lt;br /&gt;
bar&lt;/p&gt;
</code></pre><p>Backslash escapes do not work in code blocks, code spans, autolinks, or<br>
raw HTML:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>`` \[\` ``
.
&lt;p&gt;&lt;code&gt;\[\`&lt;/code&gt;&lt;/p&gt;
</code></pre><pre data-role="codeBlock" data-info="example" class="language-example"><code>    \[\]
.
&lt;pre&gt;&lt;code&gt;\[\]
&lt;/code&gt;&lt;/pre&gt;
</code></pre><pre data-role="codeBlock" data-info="example" class="language-example"><code>~~~
\[\]
~~~
.
&lt;pre&gt;&lt;code&gt;\[\]
&lt;/code&gt;&lt;/pre&gt;
</code></pre><pre data-role="codeBlock" data-info="example" class="language-example"><code>&lt;http://example.com?find=\*&gt;
.
&lt;p&gt;&lt;a href=&quot;http://example.com?find=%5C*&quot;&gt;http://example.com?find=\*&lt;/a&gt;&lt;/p&gt;
</code></pre><pre data-role="codeBlock" data-info="example" class="language-example"><code>&lt;a href=&quot;/bar\/)&quot;&gt;
.
&lt;a href=&quot;/bar\/)&quot;&gt;
</code></pre><p>But they work in all other contexts, including URLs and link titles,<br>
link references, and [info strings] in [fenced code blocks]:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>[foo](/bar\* &quot;ti\*tle&quot;)
.
&lt;p&gt;&lt;a href=&quot;/bar*&quot; title=&quot;ti*tle&quot;&gt;foo&lt;/a&gt;&lt;/p&gt;
</code></pre><pre data-role="codeBlock" data-info="example" class="language-example"><code>[foo]

[foo]: /bar\* &quot;ti\*tle&quot;
.
&lt;p&gt;&lt;a href=&quot;/bar*&quot; title=&quot;ti*tle&quot;&gt;foo&lt;/a&gt;&lt;/p&gt;
</code></pre><pre data-role="codeBlock" data-info="example" class="language-example"><code>``` foo\+bar
foo
```
.
&lt;pre&gt;&lt;code class=&quot;language-foo+bar&quot;&gt;foo
&lt;/code&gt;&lt;/pre&gt;
</code></pre><h2 class="mume-header" id="entity-and-numeric-character-references">Entity and numeric character references</h2>

<p>All valid HTML entity references and numeric character<br>
references, except those occurring in code blocks and code spans,<br>
are recognized as such and treated as equivalent to the<br>
corresponding Unicode characters.  Conforming CommonMark parsers<br>
need not store information about whether a particular character<br>
was represented in the source using a Unicode character or<br>
an entity reference.</p>
<p><a href="@">Entity references</a> consist of <code>&amp;</code> + any of the valid<br>
HTML5 entity names + <code>;</code>. The<br>
document <a href="https://html.spec.whatwg.org/multipage/entities.json">https://html.spec.whatwg.org/multipage/entities.json</a><br>
is used as an authoritative source for the valid entity<br>
references and their corresponding code points.</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>&amp;nbsp; &amp;amp; &amp;copy; &amp;AElig; &amp;Dcaron;
&amp;frac34; &amp;HilbertSpace; &amp;DifferentialD;
&amp;ClockwiseContourIntegral; &amp;ngE;
.
&lt;p&gt;  &amp;amp; &#xA9; &#xC6; &#x10E;
&#xBE; &#x210B; &#x2146;
&#x2232; &#x2267;&#x338;&lt;/p&gt;
</code></pre><p><a href="@">Decimal numeric character<br>
references</a><br>
consist of <code>&amp;#</code> + a string of 1--7 arabic digits + <code>;</code>. A<br>
numeric character reference is parsed as the corresponding<br>
Unicode character. Invalid Unicode code points will be replaced by<br>
the REPLACEMENT CHARACTER (<code>U+FFFD</code>).  For security reasons,<br>
the code point <code>U+0000</code> will also be replaced by <code>U+FFFD</code>.</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>&amp;#35; &amp;#1234; &amp;#992; &amp;#0;
.
&lt;p&gt;# &#x4D2; &#x3E0; &#xFFFD;&lt;/p&gt;
</code></pre><p><a href="@">Hexadecimal numeric character<br>
references</a> consist of <code>&amp;#</code> +<br>
either <code>X</code> or <code>x</code> + a string of 1-6 hexadecimal digits + <code>;</code>.<br>
They too are parsed as the corresponding Unicode character (this<br>
time specified with a hexadecimal numeral instead of decimal).</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>&amp;#X22; &amp;#XD06; &amp;#xcab;
.
&lt;p&gt;&amp;quot; &#xD06; &#xCAB;&lt;/p&gt;
</code></pre><p>Here are some nonentities:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>&amp;nbsp &amp;x; &amp;#; &amp;#x;
&amp;#987654321;
&amp;#abcdef0;
&amp;ThisIsNotDefined; &amp;hi?;
.
&lt;p&gt;&amp;amp;nbsp &amp;amp;x; &amp;amp;#; &amp;amp;#x;
&amp;amp;#987654321;
&amp;amp;#abcdef0;
&amp;amp;ThisIsNotDefined; &amp;amp;hi?;&lt;/p&gt;
</code></pre><p>Although HTML5 does accept some entity references<br>
without a trailing semicolon (such as <code>&amp;copy</code>), these are not<br>
recognized here, because it makes the grammar too ambiguous:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>&amp;copy
.
&lt;p&gt;&amp;amp;copy&lt;/p&gt;
</code></pre><p>Strings that are not on the list of HTML5 named entities are not<br>
recognized as entity references either:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>&amp;MadeUpEntity;
.
&lt;p&gt;&amp;amp;MadeUpEntity;&lt;/p&gt;
</code></pre><p>Entity and numeric character references are recognized in any<br>
context besides code spans or code blocks, including<br>
URLs, [link titles], and [fenced code block][] [info strings]:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>&lt;a href=&quot;&amp;ouml;&amp;ouml;.html&quot;&gt;
.
&lt;a href=&quot;&amp;ouml;&amp;ouml;.html&quot;&gt;
</code></pre><pre data-role="codeBlock" data-info="example" class="language-example"><code>[foo](/f&amp;ouml;&amp;ouml; &quot;f&amp;ouml;&amp;ouml;&quot;)
.
&lt;p&gt;&lt;a href=&quot;/f%C3%B6%C3%B6&quot; title=&quot;f&#xF6;&#xF6;&quot;&gt;foo&lt;/a&gt;&lt;/p&gt;
</code></pre><pre data-role="codeBlock" data-info="example" class="language-example"><code>[foo]

[foo]: /f&amp;ouml;&amp;ouml; &quot;f&amp;ouml;&amp;ouml;&quot;
.
&lt;p&gt;&lt;a href=&quot;/f%C3%B6%C3%B6&quot; title=&quot;f&#xF6;&#xF6;&quot;&gt;foo&lt;/a&gt;&lt;/p&gt;
</code></pre><pre data-role="codeBlock" data-info="example" class="language-example"><code>``` f&amp;ouml;&amp;ouml;
foo
```
.
&lt;pre&gt;&lt;code class=&quot;language-f&#xF6;&#xF6;&quot;&gt;foo
&lt;/code&gt;&lt;/pre&gt;
</code></pre><p>Entity and numeric character references are treated as literal<br>
text in code spans and code blocks:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>`f&amp;ouml;&amp;ouml;`
.
&lt;p&gt;&lt;code&gt;f&amp;amp;ouml;&amp;amp;ouml;&lt;/code&gt;&lt;/p&gt;
</code></pre><pre data-role="codeBlock" data-info="example" class="language-example"><code>    f&amp;ouml;f&amp;ouml;
.
&lt;pre&gt;&lt;code&gt;f&amp;amp;ouml;f&amp;amp;ouml;
&lt;/code&gt;&lt;/pre&gt;
</code></pre><h2 class="mume-header" id="code-spans">Code spans</h2>

<p>A <a href="@">backtick string</a><br>
is a string of one or more backtick characters (<code>`</code>) that is neither<br>
preceded nor followed by a backtick.</p>
<p>A <a href="@">code span</a> begins with a backtick string and ends with<br>
a backtick string of equal length.  The contents of the code span are<br>
the characters between the two backtick strings, normalized in the<br>
following ways:</p>
<ul>
<li>First, [line endings] are converted to [spaces].</li>
<li>If the resulting string both begins <em>and</em> ends with a [space]<br>
character, a single [space] character is removed from the<br>
front and back.  This allows you to include code that begins<br>
or ends with backtick characters, which must be separated by<br>
whitespace from the opening or closing backtick strings.</li>
</ul>
<p>This is a simple code span:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>`foo`
.
&lt;p&gt;&lt;code&gt;foo&lt;/code&gt;&lt;/p&gt;
</code></pre><p>Here two backticks are used, because the code contains a backtick.<br>
This example also illustrates stripping of a single leading and<br>
trailing space:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>`` foo ` bar ``
.
&lt;p&gt;&lt;code&gt;foo ` bar&lt;/code&gt;&lt;/p&gt;
</code></pre><p>This example shows the motivation for stripping leading and trailing<br>
spaces:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>` `` `
.
&lt;p&gt;&lt;code&gt;``&lt;/code&gt;&lt;/p&gt;
</code></pre><p>Note that only <em>one</em> space is stripped:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>`  ``  `
.
&lt;p&gt;&lt;code&gt; `` &lt;/code&gt;&lt;/p&gt;
</code></pre><p>The stripping only happens if the space is on both<br>
sides of the string:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>` a`
.
&lt;p&gt;&lt;code&gt; a&lt;/code&gt;&lt;/p&gt;
</code></pre><p>Only [spaces], and not [unicode whitespace] in general, are<br>
stripped in this way:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>` b `
.
&lt;p&gt;&lt;code&gt; b &lt;/code&gt;&lt;/p&gt;
</code></pre><p>[Line endings] are treated like spaces:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>``
foo
bar  
baz
``
.
&lt;p&gt;&lt;code&gt;foo bar   baz&lt;/code&gt;&lt;/p&gt;
</code></pre><pre data-role="codeBlock" data-info="example" class="language-example"><code>``
foo 
``
.
&lt;p&gt;&lt;code&gt;foo &lt;/code&gt;&lt;/p&gt;
</code></pre><p>Interior spaces are not collapsed:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>`foo   bar 
baz`
.
&lt;p&gt;&lt;code&gt;foo   bar  baz&lt;/code&gt;&lt;/p&gt;
</code></pre><p>Note that browsers will typically collapse consecutive spaces<br>
when rendering <code>&lt;code&gt;</code> elements, so it is recommended that<br>
the following CSS be used:</p>
<pre class="language-text">code{white-space: pre-wrap;}
</pre>
<p>Note that backslash escapes do not work in code spans. All backslashes<br>
are treated literally:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>`foo\`bar`
.
&lt;p&gt;&lt;code&gt;foo\&lt;/code&gt;bar`&lt;/p&gt;
</code></pre><p>Backslash escapes are never needed, because one can always choose a<br>
string of <em>n</em> backtick characters as delimiters, where the code does<br>
not contain any strings of exactly <em>n</em> backtick characters.</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>``foo`bar``
.
&lt;p&gt;&lt;code&gt;foo`bar&lt;/code&gt;&lt;/p&gt;
</code></pre><pre data-role="codeBlock" data-info="example" class="language-example"><code>` foo `` bar `
.
&lt;p&gt;&lt;code&gt;foo `` bar&lt;/code&gt;&lt;/p&gt;
</code></pre><p>Code span backticks have higher precedence than any other inline<br>
constructs except HTML tags and autolinks.  Thus, for example, this is<br>
not parsed as emphasized text, since the second <code>*</code> is part of a code<br>
span:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>*foo`*`
.
&lt;p&gt;*foo&lt;code&gt;*&lt;/code&gt;&lt;/p&gt;
</code></pre><p>And this is not parsed as a link:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>[not a `link](/foo`)
.
&lt;p&gt;[not a &lt;code&gt;link](/foo&lt;/code&gt;)&lt;/p&gt;
</code></pre><p>Code spans, HTML tags, and autolinks have the same precedence.<br>
Thus, this is code:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>`&lt;a href=&quot;`&quot;&gt;`
.
&lt;p&gt;&lt;code&gt;&amp;lt;a href=&amp;quot;&lt;/code&gt;&amp;quot;&amp;gt;`&lt;/p&gt;
</code></pre><p>But this is an HTML tag:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>&lt;a href=&quot;`&quot;&gt;`
.
&lt;p&gt;&lt;a href=&quot;`&quot;&gt;`&lt;/p&gt;
</code></pre><p>And this is code:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>`&lt;http://foo.bar.`baz&gt;`
.
&lt;p&gt;&lt;code&gt;&amp;lt;http://foo.bar.&lt;/code&gt;baz&amp;gt;`&lt;/p&gt;
</code></pre><p>But this is an autolink:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>&lt;http://foo.bar.`baz&gt;`
.
&lt;p&gt;&lt;a href=&quot;http://foo.bar.%60baz&quot;&gt;http://foo.bar.`baz&lt;/a&gt;`&lt;/p&gt;
</code></pre><p>When a backtick string is not closed by a matching backtick string,<br>
we just have literal backticks:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>```foo``
.
&lt;p&gt;```foo``&lt;/p&gt;
</code></pre><pre data-role="codeBlock" data-info="example" class="language-example"><code>`foo
.
&lt;p&gt;`foo&lt;/p&gt;
</code></pre><p>The following case also illustrates the need for opening and<br>
closing backtick strings to be equal in length:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>`foo``bar``
.
&lt;p&gt;`foo&lt;code&gt;bar&lt;/code&gt;&lt;/p&gt;
</code></pre><h2 class="mume-header" id="emphasis-and-strong-emphasis">Emphasis and strong emphasis</h2>

<p>John Gruber&apos;s original <a href="http://daringfireball.net/projects/markdown/syntax#em">Markdown syntax<br>
description</a> says:</p>
<blockquote>
<p>Markdown treats asterisks (<code>*</code>) and underscores (<code>_</code>) as indicators of<br>
emphasis. Text wrapped with one <code>*</code> or <code>_</code> will be wrapped with an HTML<br>
<code>&lt;em&gt;</code> tag; double <code>*</code>&apos;s or <code>_</code>&apos;s will be wrapped with an HTML <code>&lt;strong&gt;</code><br>
tag.</p>
</blockquote>
<p>This is enough for most users, but these rules leave much undecided,<br>
especially when it comes to nested emphasis.  The original<br>
<code>Markdown.pl</code> test suite makes it clear that triple <code>***</code> and<br>
<code>___</code> delimiters can be used for strong emphasis, and most<br>
implementations have also allowed the following patterns:</p>
<pre data-role="codeBlock" data-info="markdown" class="language-markdown"><span class="token bold"><span class="token punctuation">**</span><span class="token content"><span class="token italic"><span class="token punctuation">*</span><span class="token content">strong emph</span><span class="token punctuation">*</span></span></span><span class="token punctuation">**</span></span>
<span class="token bold"><span class="token punctuation">**</span><span class="token content"><span class="token italic"><span class="token punctuation">*</span><span class="token content">strong</span><span class="token punctuation">*</span></span>* in emph*
</span><span class="token punctuation">**</span></span>*emph<span class="token italic"><span class="token punctuation">*</span><span class="token content"> in strong<span class="token bold"><span class="token punctuation">**</span><span class="token content">
</span><span class="token punctuation">**</span></span>in strong </span><span class="token punctuation">*</span></span>emph<span class="token bold"><span class="token punctuation">**</span><span class="token content"><span class="token italic"><span class="token punctuation">*</span><span class="token content">
</span><span class="token punctuation">*</span></span>in emph </span><span class="token punctuation">**</span></span>strong***
</pre><p>The following patterns are less widely supported, but the intent<br>
is clear and they are useful (especially in contexts like bibliography<br>
entries):</p>
<pre data-role="codeBlock" data-info="markdown" class="language-markdown"><span class="token italic"><span class="token punctuation">*</span><span class="token content">emph </span><span class="token punctuation">*</span></span>with emph<span class="token italic"><span class="token punctuation">*</span><span class="token content"> in it</span><span class="token punctuation">*</span></span>
<span class="token bold"><span class="token punctuation">**</span><span class="token content">strong </span><span class="token punctuation">**</span></span>with strong<span class="token bold"><span class="token punctuation">**</span><span class="token content"> in it</span><span class="token punctuation">**</span></span>
</pre><p>Many implementations have also restricted intraword emphasis to<br>
the <code>*</code> forms, to avoid unwanted emphasis in words containing<br>
internal underscores.  (It is best practice to put these in code<br>
spans, but users often do not.)</p>
<pre data-role="codeBlock" data-info="markdown" class="language-markdown">internal emphasis: foo<span class="token italic"><span class="token punctuation">*</span><span class="token content">bar</span><span class="token punctuation">*</span></span>baz
no emphasis: foo_bar_baz
</pre><p>The rules given below capture all of these patterns, while allowing<br>
for efficient parsing strategies that do not backtrack.</p>
<p>First, some definitions.  A <a href="@">delimiter run</a> is either<br>
a sequence of one or more <code>*</code> characters that is not preceded or<br>
followed by a non-backslash-escaped <code>*</code> character, or a sequence<br>
of one or more <code>_</code> characters that is not preceded or followed by<br>
a non-backslash-escaped <code>_</code> character.</p>
<p>A <a href="@">left-flanking delimiter run</a> is<br>
a [delimiter run] that is (1) not followed by [Unicode whitespace],<br>
and either (2a) not followed by a [punctuation character], or<br>
(2b) followed by a [punctuation character] and<br>
preceded by [Unicode whitespace] or a [punctuation character].<br>
For purposes of this definition, the beginning and the end of<br>
the line count as Unicode whitespace.</p>
<p>A <a href="@">right-flanking delimiter run</a> is<br>
a [delimiter run] that is (1) not preceded by [Unicode whitespace],<br>
and either (2a) not preceded by a [punctuation character], or<br>
(2b) preceded by a [punctuation character] and<br>
followed by [Unicode whitespace] or a [punctuation character].<br>
For purposes of this definition, the beginning and the end of<br>
the line count as Unicode whitespace.</p>
<p>Here are some examples of delimiter runs.</p>
<ul>
<li>
<p>left-flanking but not right-flanking:</p>
<pre data-role="codeBlock" data-info class="language-"><code>***abc
  _abc
**&quot;abc&quot;
 _&quot;abc&quot;
</code></pre></li>
<li>
<p>right-flanking but not left-flanking:</p>
<pre data-role="codeBlock" data-info class="language-"><code> abc***
 abc_
&quot;abc&quot;**
&quot;abc&quot;_
</code></pre></li>
<li>
<p>Both left and right-flanking:</p>
<pre data-role="codeBlock" data-info class="language-"><code> abc***def
&quot;abc&quot;_&quot;def&quot;
</code></pre></li>
<li>
<p>Neither left nor right-flanking:</p>
<pre data-role="codeBlock" data-info class="language-"><code>abc *** def
a _ b
</code></pre></li>
</ul>
<p>(The idea of distinguishing left-flanking and right-flanking<br>
delimiter runs based on the character before and the character<br>
after comes from Roopesh Chander&apos;s<br>
<a href="http://www.vfmd.org/vfmd-spec/specification/#procedure-for-identifying-emphasis-tags">vfmd</a>.<br>
vfmd uses the terminology &quot;emphasis indicator string&quot; instead of &quot;delimiter<br>
run,&quot; and its rules for distinguishing left- and right-flanking runs<br>
are a bit more complex than the ones given here.)</p>
<p>The following rules define emphasis and strong emphasis:</p>
<ol>
<li>
<p>A single <code>*</code> character <a href="@">can open emphasis</a><br>
iff (if and only if) it is part of a [left-flanking delimiter run].</p>
</li>
<li>
<p>A single <code>_</code> character [can open emphasis] iff<br>
it is part of a [left-flanking delimiter run]<br>
and either (a) not part of a [right-flanking delimiter run]<br>
or (b) part of a [right-flanking delimiter run]<br>
preceded by punctuation.</p>
</li>
<li>
<p>A single <code>*</code> character <a href="@">can close emphasis</a><br>
iff it is part of a [right-flanking delimiter run].</p>
</li>
<li>
<p>A single <code>_</code> character [can close emphasis] iff<br>
it is part of a [right-flanking delimiter run]<br>
and either (a) not part of a [left-flanking delimiter run]<br>
or (b) part of a [left-flanking delimiter run]<br>
followed by punctuation.</p>
</li>
<li>
<p>A double <code>**</code> <a href="@">can open strong emphasis</a><br>
iff it is part of a [left-flanking delimiter run].</p>
</li>
<li>
<p>A double <code>__</code> [can open strong emphasis] iff<br>
it is part of a [left-flanking delimiter run]<br>
and either (a) not part of a [right-flanking delimiter run]<br>
or (b) part of a [right-flanking delimiter run]<br>
preceded by punctuation.</p>
</li>
<li>
<p>A double <code>**</code> <a href="@">can close strong emphasis</a><br>
iff it is part of a [right-flanking delimiter run].</p>
</li>
<li>
<p>A double <code>__</code> [can close strong emphasis] iff<br>
it is part of a [right-flanking delimiter run]<br>
and either (a) not part of a [left-flanking delimiter run]<br>
or (b) part of a [left-flanking delimiter run]<br>
followed by punctuation.</p>
</li>
<li>
<p>Emphasis begins with a delimiter that [can open emphasis] and ends<br>
with a delimiter that [can close emphasis], and that uses the same<br>
character (<code>_</code> or <code>*</code>) as the opening delimiter.  The<br>
opening and closing delimiters must belong to separate<br>
[delimiter runs].  If one of the delimiters can both<br>
open and close emphasis, then the sum of the lengths of the<br>
delimiter runs containing the opening and closing delimiters<br>
must not be a multiple of 3.</p>
</li>
<li>
<p>Strong emphasis begins with a delimiter that<br>
[can open strong emphasis] and ends with a delimiter that<br>
[can close strong emphasis], and that uses the same character<br>
(<code>_</code> or <code>*</code>) as the opening delimiter.  The<br>
opening and closing delimiters must belong to separate<br>
[delimiter runs].  If one of the delimiters can both open<br>
and close strong emphasis, then the sum of the lengths of<br>
the delimiter runs containing the opening and closing<br>
delimiters must not be a multiple of 3.</p>
</li>
<li>
<p>A literal <code>*</code> character cannot occur at the beginning or end of<br>
<code>*</code>-delimited emphasis or <code>**</code>-delimited strong emphasis, unless it<br>
is backslash-escaped.</p>
</li>
<li>
<p>A literal <code>_</code> character cannot occur at the beginning or end of<br>
<code>_</code>-delimited emphasis or <code>__</code>-delimited strong emphasis, unless it<br>
is backslash-escaped.</p>
</li>
</ol>
<p>Where rules 1--12 above are compatible with multiple parsings,<br>
the following principles resolve ambiguity:</p>
<ol start="13">
<li>
<p>The number of nestings should be minimized. Thus, for example,<br>
an interpretation <code>&lt;strong&gt;...&lt;/strong&gt;</code> is always preferred to<br>
<code>&lt;em&gt;&lt;em&gt;...&lt;/em&gt;&lt;/em&gt;</code>.</p>
</li>
<li>
<p>An interpretation <code>&lt;em&gt;&lt;strong&gt;...&lt;/strong&gt;&lt;/em&gt;</code> is always<br>
preferred to <code>&lt;strong&gt;&lt;em&gt;...&lt;/em&gt;&lt;/strong&gt;</code>.</p>
</li>
<li>
<p>When two potential emphasis or strong emphasis spans overlap,<br>
so that the second begins before the first ends and ends after<br>
the first ends, the first takes precedence. Thus, for example,<br>
<code>*foo _bar* baz_</code> is parsed as <code>&lt;em&gt;foo _bar&lt;/em&gt; baz_</code> rather<br>
than <code>*foo &lt;em&gt;bar* baz&lt;/em&gt;</code>.</p>
</li>
<li>
<p>When there are two potential emphasis or strong emphasis spans<br>
with the same closing delimiter, the shorter one (the one that<br>
opens later) takes precedence. Thus, for example,<br>
<code>**foo **bar baz**</code> is parsed as <code>**foo &lt;strong&gt;bar baz&lt;/strong&gt;</code><br>
rather than <code>&lt;strong&gt;foo **bar baz&lt;/strong&gt;</code>.</p>
</li>
<li>
<p>Inline code spans, links, images, and HTML tags group more tightly<br>
than emphasis.  So, when there is a choice between an interpretation<br>
that contains one of these elements and one that does not, the<br>
former always wins.  Thus, for example, <code>*[foo*](bar)</code> is<br>
parsed as <code>*&lt;a href=&quot;bar&quot;&gt;foo*&lt;/a&gt;</code> rather than as<br>
<code>&lt;em&gt;[foo&lt;/em&gt;](bar)</code>.</p>
</li>
</ol>
<p>These rules can be illustrated through a series of examples.</p>
<p>Rule 1:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>*foo bar*
.
&lt;p&gt;&lt;em&gt;foo bar&lt;/em&gt;&lt;/p&gt;
</code></pre><p>This is not emphasis, because the opening <code>*</code> is followed by<br>
whitespace, and hence not part of a [left-flanking delimiter run]:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>a * foo bar*
.
&lt;p&gt;a * foo bar*&lt;/p&gt;
</code></pre><p>This is not emphasis, because the opening <code>*</code> is preceded<br>
by an alphanumeric and followed by punctuation, and hence<br>
not part of a [left-flanking delimiter run]:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>a*&quot;foo&quot;*
.
&lt;p&gt;a*&amp;quot;foo&amp;quot;*&lt;/p&gt;
</code></pre><p>Unicode nonbreaking spaces count as whitespace, too:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>* a *
.
&lt;p&gt;* a *&lt;/p&gt;
</code></pre><p>Intraword emphasis with <code>*</code> is permitted:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>foo*bar*
.
&lt;p&gt;foo&lt;em&gt;bar&lt;/em&gt;&lt;/p&gt;
</code></pre><pre data-role="codeBlock" data-info="example" class="language-example"><code>5*6*78
.
&lt;p&gt;5&lt;em&gt;6&lt;/em&gt;78&lt;/p&gt;
</code></pre><p>Rule 2:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>_foo bar_
.
&lt;p&gt;&lt;em&gt;foo bar&lt;/em&gt;&lt;/p&gt;
</code></pre><p>This is not emphasis, because the opening <code>_</code> is followed by<br>
whitespace:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>_ foo bar_
.
&lt;p&gt;_ foo bar_&lt;/p&gt;
</code></pre><p>This is not emphasis, because the opening <code>_</code> is preceded<br>
by an alphanumeric and followed by punctuation:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>a_&quot;foo&quot;_
.
&lt;p&gt;a_&amp;quot;foo&amp;quot;_&lt;/p&gt;
</code></pre><p>Emphasis with <code>_</code> is not allowed inside words:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>foo_bar_
.
&lt;p&gt;foo_bar_&lt;/p&gt;
</code></pre><pre data-role="codeBlock" data-info="example" class="language-example"><code>5_6_78
.
&lt;p&gt;5_6_78&lt;/p&gt;
</code></pre><pre data-role="codeBlock" data-info="example" class="language-example"><code>&#x43F;&#x440;&#x438;&#x441;&#x442;&#x430;&#x43D;&#x44F;&#x43C;_&#x441;&#x442;&#x440;&#x435;&#x43C;&#x44F;&#x442;&#x441;&#x44F;_
.
&lt;p&gt;&#x43F;&#x440;&#x438;&#x441;&#x442;&#x430;&#x43D;&#x44F;&#x43C;_&#x441;&#x442;&#x440;&#x435;&#x43C;&#x44F;&#x442;&#x441;&#x44F;_&lt;/p&gt;
</code></pre><p>Here <code>_</code> does not generate emphasis, because the first delimiter run<br>
is right-flanking and the second left-flanking:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>aa_&quot;bb&quot;_cc
.
&lt;p&gt;aa_&amp;quot;bb&amp;quot;_cc&lt;/p&gt;
</code></pre><p>This is emphasis, even though the opening delimiter is<br>
both left- and right-flanking, because it is preceded by<br>
punctuation:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>foo-_(bar)_
.
&lt;p&gt;foo-&lt;em&gt;(bar)&lt;/em&gt;&lt;/p&gt;
</code></pre><p>Rule 3:</p>
<p>This is not emphasis, because the closing delimiter does<br>
not match the opening delimiter:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>_foo*
.
&lt;p&gt;_foo*&lt;/p&gt;
</code></pre><p>This is not emphasis, because the closing <code>*</code> is preceded by<br>
whitespace:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>*foo bar *
.
&lt;p&gt;*foo bar *&lt;/p&gt;
</code></pre><p>A newline also counts as whitespace:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>*foo bar
*
.
&lt;p&gt;*foo bar
*&lt;/p&gt;
</code></pre><p>This is not emphasis, because the second <code>*</code> is<br>
preceded by punctuation and followed by an alphanumeric<br>
(hence it is not part of a [right-flanking delimiter run]:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>*(*foo)
.
&lt;p&gt;*(*foo)&lt;/p&gt;
</code></pre><p>The point of this restriction is more easily appreciated<br>
with this example:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>*(*foo*)*
.
&lt;p&gt;&lt;em&gt;(&lt;em&gt;foo&lt;/em&gt;)&lt;/em&gt;&lt;/p&gt;
</code></pre><p>Intraword emphasis with <code>*</code> is allowed:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>*foo*bar
.
&lt;p&gt;&lt;em&gt;foo&lt;/em&gt;bar&lt;/p&gt;
</code></pre><p>Rule 4:</p>
<p>This is not emphasis, because the closing <code>_</code> is preceded by<br>
whitespace:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>_foo bar _
.
&lt;p&gt;_foo bar _&lt;/p&gt;
</code></pre><p>This is not emphasis, because the second <code>_</code> is<br>
preceded by punctuation and followed by an alphanumeric:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>_(_foo)
.
&lt;p&gt;_(_foo)&lt;/p&gt;
</code></pre><p>This is emphasis within emphasis:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>_(_foo_)_
.
&lt;p&gt;&lt;em&gt;(&lt;em&gt;foo&lt;/em&gt;)&lt;/em&gt;&lt;/p&gt;
</code></pre><p>Intraword emphasis is disallowed for <code>_</code>:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>_foo_bar
.
&lt;p&gt;_foo_bar&lt;/p&gt;
</code></pre><pre data-role="codeBlock" data-info="example" class="language-example"><code>_&#x43F;&#x440;&#x438;&#x441;&#x442;&#x430;&#x43D;&#x44F;&#x43C;_&#x441;&#x442;&#x440;&#x435;&#x43C;&#x44F;&#x442;&#x441;&#x44F;
.
&lt;p&gt;_&#x43F;&#x440;&#x438;&#x441;&#x442;&#x430;&#x43D;&#x44F;&#x43C;_&#x441;&#x442;&#x440;&#x435;&#x43C;&#x44F;&#x442;&#x441;&#x44F;&lt;/p&gt;
</code></pre><pre data-role="codeBlock" data-info="example" class="language-example"><code>_foo_bar_baz_
.
&lt;p&gt;&lt;em&gt;foo_bar_baz&lt;/em&gt;&lt;/p&gt;
</code></pre><p>This is emphasis, even though the closing delimiter is<br>
both left- and right-flanking, because it is followed by<br>
punctuation:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>_(bar)_.
.
&lt;p&gt;&lt;em&gt;(bar)&lt;/em&gt;.&lt;/p&gt;
</code></pre><p>Rule 5:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>**foo bar**
.
&lt;p&gt;&lt;strong&gt;foo bar&lt;/strong&gt;&lt;/p&gt;
</code></pre><p>This is not strong emphasis, because the opening delimiter is<br>
followed by whitespace:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>** foo bar**
.
&lt;p&gt;** foo bar**&lt;/p&gt;
</code></pre><p>This is not strong emphasis, because the opening <code>**</code> is preceded<br>
by an alphanumeric and followed by punctuation, and hence<br>
not part of a [left-flanking delimiter run]:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>a**&quot;foo&quot;**
.
&lt;p&gt;a**&amp;quot;foo&amp;quot;**&lt;/p&gt;
</code></pre><p>Intraword strong emphasis with <code>**</code> is permitted:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>foo**bar**
.
&lt;p&gt;foo&lt;strong&gt;bar&lt;/strong&gt;&lt;/p&gt;
</code></pre><p>Rule 6:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>__foo bar__
.
&lt;p&gt;&lt;strong&gt;foo bar&lt;/strong&gt;&lt;/p&gt;
</code></pre><p>This is not strong emphasis, because the opening delimiter is<br>
followed by whitespace:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>__ foo bar__
.
&lt;p&gt;__ foo bar__&lt;/p&gt;
</code></pre><p>A newline counts as whitespace:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>__
foo bar__
.
&lt;p&gt;__
foo bar__&lt;/p&gt;
</code></pre><p>This is not strong emphasis, because the opening <code>__</code> is preceded<br>
by an alphanumeric and followed by punctuation:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>a__&quot;foo&quot;__
.
&lt;p&gt;a__&amp;quot;foo&amp;quot;__&lt;/p&gt;
</code></pre><p>Intraword strong emphasis is forbidden with <code>__</code>:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>foo__bar__
.
&lt;p&gt;foo__bar__&lt;/p&gt;
</code></pre><pre data-role="codeBlock" data-info="example" class="language-example"><code>5__6__78
.
&lt;p&gt;5__6__78&lt;/p&gt;
</code></pre><pre data-role="codeBlock" data-info="example" class="language-example"><code>&#x43F;&#x440;&#x438;&#x441;&#x442;&#x430;&#x43D;&#x44F;&#x43C;__&#x441;&#x442;&#x440;&#x435;&#x43C;&#x44F;&#x442;&#x441;&#x44F;__
.
&lt;p&gt;&#x43F;&#x440;&#x438;&#x441;&#x442;&#x430;&#x43D;&#x44F;&#x43C;__&#x441;&#x442;&#x440;&#x435;&#x43C;&#x44F;&#x442;&#x441;&#x44F;__&lt;/p&gt;
</code></pre><pre data-role="codeBlock" data-info="example" class="language-example"><code>__foo, __bar__, baz__
.
&lt;p&gt;&lt;strong&gt;foo, &lt;strong&gt;bar&lt;/strong&gt;, baz&lt;/strong&gt;&lt;/p&gt;
</code></pre><p>This is strong emphasis, even though the opening delimiter is<br>
both left- and right-flanking, because it is preceded by<br>
punctuation:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>foo-__(bar)__
.
&lt;p&gt;foo-&lt;strong&gt;(bar)&lt;/strong&gt;&lt;/p&gt;
</code></pre><p>Rule 7:</p>
<p>This is not strong emphasis, because the closing delimiter is preceded<br>
by whitespace:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>**foo bar **
.
&lt;p&gt;**foo bar **&lt;/p&gt;
</code></pre><p>(Nor can it be interpreted as an emphasized <code>*foo bar *</code>, because of<br>
Rule 11.)</p>
<p>This is not strong emphasis, because the second <code>**</code> is<br>
preceded by punctuation and followed by an alphanumeric:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>**(**foo)
.
&lt;p&gt;**(**foo)&lt;/p&gt;
</code></pre><p>The point of this restriction is more easily appreciated<br>
with these examples:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>*(**foo**)*
.
&lt;p&gt;&lt;em&gt;(&lt;strong&gt;foo&lt;/strong&gt;)&lt;/em&gt;&lt;/p&gt;
</code></pre><pre data-role="codeBlock" data-info="example" class="language-example"><code>**Gomphocarpus (*Gomphocarpus physocarpus*, syn.
*Asclepias physocarpa*)**
.
&lt;p&gt;&lt;strong&gt;Gomphocarpus (&lt;em&gt;Gomphocarpus physocarpus&lt;/em&gt;, syn.
&lt;em&gt;Asclepias physocarpa&lt;/em&gt;)&lt;/strong&gt;&lt;/p&gt;
</code></pre><pre data-role="codeBlock" data-info="example" class="language-example"><code>**foo &quot;*bar*&quot; foo**
.
&lt;p&gt;&lt;strong&gt;foo &amp;quot;&lt;em&gt;bar&lt;/em&gt;&amp;quot; foo&lt;/strong&gt;&lt;/p&gt;
</code></pre><p>Intraword emphasis:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>**foo**bar
.
&lt;p&gt;&lt;strong&gt;foo&lt;/strong&gt;bar&lt;/p&gt;
</code></pre><p>Rule 8:</p>
<p>This is not strong emphasis, because the closing delimiter is<br>
preceded by whitespace:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>__foo bar __
.
&lt;p&gt;__foo bar __&lt;/p&gt;
</code></pre><p>This is not strong emphasis, because the second <code>__</code> is<br>
preceded by punctuation and followed by an alphanumeric:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>__(__foo)
.
&lt;p&gt;__(__foo)&lt;/p&gt;
</code></pre><p>The point of this restriction is more easily appreciated<br>
with this example:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>_(__foo__)_
.
&lt;p&gt;&lt;em&gt;(&lt;strong&gt;foo&lt;/strong&gt;)&lt;/em&gt;&lt;/p&gt;
</code></pre><p>Intraword strong emphasis is forbidden with <code>__</code>:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>__foo__bar
.
&lt;p&gt;__foo__bar&lt;/p&gt;
</code></pre><pre data-role="codeBlock" data-info="example" class="language-example"><code>__&#x43F;&#x440;&#x438;&#x441;&#x442;&#x430;&#x43D;&#x44F;&#x43C;__&#x441;&#x442;&#x440;&#x435;&#x43C;&#x44F;&#x442;&#x441;&#x44F;
.
&lt;p&gt;__&#x43F;&#x440;&#x438;&#x441;&#x442;&#x430;&#x43D;&#x44F;&#x43C;__&#x441;&#x442;&#x440;&#x435;&#x43C;&#x44F;&#x442;&#x441;&#x44F;&lt;/p&gt;
</code></pre><pre data-role="codeBlock" data-info="example" class="language-example"><code>__foo__bar__baz__
.
&lt;p&gt;&lt;strong&gt;foo__bar__baz&lt;/strong&gt;&lt;/p&gt;
</code></pre><p>This is strong emphasis, even though the closing delimiter is<br>
both left- and right-flanking, because it is followed by<br>
punctuation:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>__(bar)__.
.
&lt;p&gt;&lt;strong&gt;(bar)&lt;/strong&gt;.&lt;/p&gt;
</code></pre><p>Rule 9:</p>
<p>Any nonempty sequence of inline elements can be the contents of an<br>
emphasized span.</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>*foo [bar](/url)*
.
&lt;p&gt;&lt;em&gt;foo &lt;a href=&quot;/url&quot;&gt;bar&lt;/a&gt;&lt;/em&gt;&lt;/p&gt;
</code></pre><pre data-role="codeBlock" data-info="example" class="language-example"><code>*foo
bar*
.
&lt;p&gt;&lt;em&gt;foo
bar&lt;/em&gt;&lt;/p&gt;
</code></pre><p>In particular, emphasis and strong emphasis can be nested<br>
inside emphasis:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>_foo __bar__ baz_
.
&lt;p&gt;&lt;em&gt;foo &lt;strong&gt;bar&lt;/strong&gt; baz&lt;/em&gt;&lt;/p&gt;
</code></pre><pre data-role="codeBlock" data-info="example" class="language-example"><code>_foo _bar_ baz_
.
&lt;p&gt;&lt;em&gt;foo &lt;em&gt;bar&lt;/em&gt; baz&lt;/em&gt;&lt;/p&gt;
</code></pre><pre data-role="codeBlock" data-info="example" class="language-example"><code>__foo_ bar_
.
&lt;p&gt;&lt;em&gt;&lt;em&gt;foo&lt;/em&gt; bar&lt;/em&gt;&lt;/p&gt;
</code></pre><pre data-role="codeBlock" data-info="example" class="language-example"><code>*foo *bar**
.
&lt;p&gt;&lt;em&gt;foo &lt;em&gt;bar&lt;/em&gt;&lt;/em&gt;&lt;/p&gt;
</code></pre><pre data-role="codeBlock" data-info="example" class="language-example"><code>*foo **bar** baz*
.
&lt;p&gt;&lt;em&gt;foo &lt;strong&gt;bar&lt;/strong&gt; baz&lt;/em&gt;&lt;/p&gt;
</code></pre><pre data-role="codeBlock" data-info="example" class="language-example"><code>*foo**bar**baz*
.
&lt;p&gt;&lt;em&gt;foo&lt;strong&gt;bar&lt;/strong&gt;baz&lt;/em&gt;&lt;/p&gt;
</code></pre><p>Note that in the preceding case, the interpretation</p>
<pre data-role="codeBlock" data-info="markdown" class="language-markdown"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>em</span><span class="token punctuation">&gt;</span></span>foo<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>em</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>em</span><span class="token punctuation">&gt;</span></span>bar<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>em</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>em</span><span class="token punctuation">&gt;</span></span>baz<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>em</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
</pre><p>is precluded by the condition that a delimiter that<br>
can both open and close (like the <code>*</code> after <code>foo</code>)<br>
cannot form emphasis if the sum of the lengths of<br>
the delimiter runs containing the opening and<br>
closing delimiters is a multiple of 3.</p>
<p>For the same reason, we don&apos;t get two consecutive<br>
emphasis sections in this example:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>*foo**bar*
.
&lt;p&gt;&lt;em&gt;foo**bar&lt;/em&gt;&lt;/p&gt;
</code></pre><p>The same condition ensures that the following<br>
cases are all strong emphasis nested inside<br>
emphasis, even when the interior spaces are<br>
omitted:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>***foo** bar*
.
&lt;p&gt;&lt;em&gt;&lt;strong&gt;foo&lt;/strong&gt; bar&lt;/em&gt;&lt;/p&gt;
</code></pre><pre data-role="codeBlock" data-info="example" class="language-example"><code>*foo **bar***
.
&lt;p&gt;&lt;em&gt;foo &lt;strong&gt;bar&lt;/strong&gt;&lt;/em&gt;&lt;/p&gt;
</code></pre><pre data-role="codeBlock" data-info="example" class="language-example"><code>*foo**bar***
.
&lt;p&gt;&lt;em&gt;foo&lt;strong&gt;bar&lt;/strong&gt;&lt;/em&gt;&lt;/p&gt;
</code></pre><p>Indefinite levels of nesting are possible:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>*foo **bar *baz* bim** bop*
.
&lt;p&gt;&lt;em&gt;foo &lt;strong&gt;bar &lt;em&gt;baz&lt;/em&gt; bim&lt;/strong&gt; bop&lt;/em&gt;&lt;/p&gt;
</code></pre><pre data-role="codeBlock" data-info="example" class="language-example"><code>*foo [*bar*](/url)*
.
&lt;p&gt;&lt;em&gt;foo &lt;a href=&quot;/url&quot;&gt;&lt;em&gt;bar&lt;/em&gt;&lt;/a&gt;&lt;/em&gt;&lt;/p&gt;
</code></pre><p>There can be no empty emphasis or strong emphasis:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>** is not an empty emphasis
.
&lt;p&gt;** is not an empty emphasis&lt;/p&gt;
</code></pre><pre data-role="codeBlock" data-info="example" class="language-example"><code>**** is not an empty strong emphasis
.
&lt;p&gt;**** is not an empty strong emphasis&lt;/p&gt;
</code></pre><p>Rule 10:</p>
<p>Any nonempty sequence of inline elements can be the contents of an<br>
strongly emphasized span.</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>**foo [bar](/url)**
.
&lt;p&gt;&lt;strong&gt;foo &lt;a href=&quot;/url&quot;&gt;bar&lt;/a&gt;&lt;/strong&gt;&lt;/p&gt;
</code></pre><pre data-role="codeBlock" data-info="example" class="language-example"><code>**foo
bar**
.
&lt;p&gt;&lt;strong&gt;foo
bar&lt;/strong&gt;&lt;/p&gt;
</code></pre><p>In particular, emphasis and strong emphasis can be nested<br>
inside strong emphasis:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>__foo _bar_ baz__
.
&lt;p&gt;&lt;strong&gt;foo &lt;em&gt;bar&lt;/em&gt; baz&lt;/strong&gt;&lt;/p&gt;
</code></pre><pre data-role="codeBlock" data-info="example" class="language-example"><code>__foo __bar__ baz__
.
&lt;p&gt;&lt;strong&gt;foo &lt;strong&gt;bar&lt;/strong&gt; baz&lt;/strong&gt;&lt;/p&gt;
</code></pre><pre data-role="codeBlock" data-info="example" class="language-example"><code>____foo__ bar__
.
&lt;p&gt;&lt;strong&gt;&lt;strong&gt;foo&lt;/strong&gt; bar&lt;/strong&gt;&lt;/p&gt;
</code></pre><pre data-role="codeBlock" data-info="example" class="language-example"><code>**foo **bar****
.
&lt;p&gt;&lt;strong&gt;foo &lt;strong&gt;bar&lt;/strong&gt;&lt;/strong&gt;&lt;/p&gt;
</code></pre><pre data-role="codeBlock" data-info="example" class="language-example"><code>**foo *bar* baz**
.
&lt;p&gt;&lt;strong&gt;foo &lt;em&gt;bar&lt;/em&gt; baz&lt;/strong&gt;&lt;/p&gt;
</code></pre><pre data-role="codeBlock" data-info="example" class="language-example"><code>**foo*bar*baz**
.
&lt;p&gt;&lt;strong&gt;foo&lt;em&gt;bar&lt;/em&gt;baz&lt;/strong&gt;&lt;/p&gt;
</code></pre><pre data-role="codeBlock" data-info="example" class="language-example"><code>***foo* bar**
.
&lt;p&gt;&lt;strong&gt;&lt;em&gt;foo&lt;/em&gt; bar&lt;/strong&gt;&lt;/p&gt;
</code></pre><pre data-role="codeBlock" data-info="example" class="language-example"><code>**foo *bar***
.
&lt;p&gt;&lt;strong&gt;foo &lt;em&gt;bar&lt;/em&gt;&lt;/strong&gt;&lt;/p&gt;
</code></pre><p>Indefinite levels of nesting are possible:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>**foo *bar **baz**
bim* bop**
.
&lt;p&gt;&lt;strong&gt;foo &lt;em&gt;bar &lt;strong&gt;baz&lt;/strong&gt;
bim&lt;/em&gt; bop&lt;/strong&gt;&lt;/p&gt;
</code></pre><pre data-role="codeBlock" data-info="example" class="language-example"><code>**foo [*bar*](/url)**
.
&lt;p&gt;&lt;strong&gt;foo &lt;a href=&quot;/url&quot;&gt;&lt;em&gt;bar&lt;/em&gt;&lt;/a&gt;&lt;/strong&gt;&lt;/p&gt;
</code></pre><p>There can be no empty emphasis or strong emphasis:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>__ is not an empty emphasis
.
&lt;p&gt;__ is not an empty emphasis&lt;/p&gt;
</code></pre><pre data-role="codeBlock" data-info="example" class="language-example"><code>____ is not an empty strong emphasis
.
&lt;p&gt;____ is not an empty strong emphasis&lt;/p&gt;
</code></pre><p>Rule 11:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>foo ***
.
&lt;p&gt;foo ***&lt;/p&gt;
</code></pre><pre data-role="codeBlock" data-info="example" class="language-example"><code>foo *\**
.
&lt;p&gt;foo &lt;em&gt;*&lt;/em&gt;&lt;/p&gt;
</code></pre><pre data-role="codeBlock" data-info="example" class="language-example"><code>foo *_*
.
&lt;p&gt;foo &lt;em&gt;_&lt;/em&gt;&lt;/p&gt;
</code></pre><pre data-role="codeBlock" data-info="example" class="language-example"><code>foo *****
.
&lt;p&gt;foo *****&lt;/p&gt;
</code></pre><pre data-role="codeBlock" data-info="example" class="language-example"><code>foo **\***
.
&lt;p&gt;foo &lt;strong&gt;*&lt;/strong&gt;&lt;/p&gt;
</code></pre><pre data-role="codeBlock" data-info="example" class="language-example"><code>foo **_**
.
&lt;p&gt;foo &lt;strong&gt;_&lt;/strong&gt;&lt;/p&gt;
</code></pre><p>Note that when delimiters do not match evenly, Rule 11 determines<br>
that the excess literal <code>*</code> characters will appear outside of the<br>
emphasis, rather than inside it:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>**foo*
.
&lt;p&gt;*&lt;em&gt;foo&lt;/em&gt;&lt;/p&gt;
</code></pre><pre data-role="codeBlock" data-info="example" class="language-example"><code>*foo**
.
&lt;p&gt;&lt;em&gt;foo&lt;/em&gt;*&lt;/p&gt;
</code></pre><pre data-role="codeBlock" data-info="example" class="language-example"><code>***foo**
.
&lt;p&gt;*&lt;strong&gt;foo&lt;/strong&gt;&lt;/p&gt;
</code></pre><pre data-role="codeBlock" data-info="example" class="language-example"><code>****foo*
.
&lt;p&gt;***&lt;em&gt;foo&lt;/em&gt;&lt;/p&gt;
</code></pre><pre data-role="codeBlock" data-info="example" class="language-example"><code>**foo***
.
&lt;p&gt;&lt;strong&gt;foo&lt;/strong&gt;*&lt;/p&gt;
</code></pre><pre data-role="codeBlock" data-info="example" class="language-example"><code>*foo****
.
&lt;p&gt;&lt;em&gt;foo&lt;/em&gt;***&lt;/p&gt;
</code></pre><p>Rule 12:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>foo ___
.
&lt;p&gt;foo ___&lt;/p&gt;
</code></pre><pre data-role="codeBlock" data-info="example" class="language-example"><code>foo _\__
.
&lt;p&gt;foo &lt;em&gt;_&lt;/em&gt;&lt;/p&gt;
</code></pre><pre data-role="codeBlock" data-info="example" class="language-example"><code>foo _*_
.
&lt;p&gt;foo &lt;em&gt;*&lt;/em&gt;&lt;/p&gt;
</code></pre><pre data-role="codeBlock" data-info="example" class="language-example"><code>foo _____
.
&lt;p&gt;foo _____&lt;/p&gt;
</code></pre><pre data-role="codeBlock" data-info="example" class="language-example"><code>foo __\___
.
&lt;p&gt;foo &lt;strong&gt;_&lt;/strong&gt;&lt;/p&gt;
</code></pre><pre data-role="codeBlock" data-info="example" class="language-example"><code>foo __*__
.
&lt;p&gt;foo &lt;strong&gt;*&lt;/strong&gt;&lt;/p&gt;
</code></pre><pre data-role="codeBlock" data-info="example" class="language-example"><code>__foo_
.
&lt;p&gt;_&lt;em&gt;foo&lt;/em&gt;&lt;/p&gt;
</code></pre><p>Note that when delimiters do not match evenly, Rule 12 determines<br>
that the excess literal <code>_</code> characters will appear outside of the<br>
emphasis, rather than inside it:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>_foo__
.
&lt;p&gt;&lt;em&gt;foo&lt;/em&gt;_&lt;/p&gt;
</code></pre><pre data-role="codeBlock" data-info="example" class="language-example"><code>___foo__
.
&lt;p&gt;_&lt;strong&gt;foo&lt;/strong&gt;&lt;/p&gt;
</code></pre><pre data-role="codeBlock" data-info="example" class="language-example"><code>____foo_
.
&lt;p&gt;___&lt;em&gt;foo&lt;/em&gt;&lt;/p&gt;
</code></pre><pre data-role="codeBlock" data-info="example" class="language-example"><code>__foo___
.
&lt;p&gt;&lt;strong&gt;foo&lt;/strong&gt;_&lt;/p&gt;
</code></pre><pre data-role="codeBlock" data-info="example" class="language-example"><code>_foo____
.
&lt;p&gt;&lt;em&gt;foo&lt;/em&gt;___&lt;/p&gt;
</code></pre><p>Rule 13 implies that if you want emphasis nested directly inside<br>
emphasis, you must use different delimiters:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>**foo**
.
&lt;p&gt;&lt;strong&gt;foo&lt;/strong&gt;&lt;/p&gt;
</code></pre><pre data-role="codeBlock" data-info="example" class="language-example"><code>*_foo_*
.
&lt;p&gt;&lt;em&gt;&lt;em&gt;foo&lt;/em&gt;&lt;/em&gt;&lt;/p&gt;
</code></pre><pre data-role="codeBlock" data-info="example" class="language-example"><code>__foo__
.
&lt;p&gt;&lt;strong&gt;foo&lt;/strong&gt;&lt;/p&gt;
</code></pre><pre data-role="codeBlock" data-info="example" class="language-example"><code>_*foo*_
.
&lt;p&gt;&lt;em&gt;&lt;em&gt;foo&lt;/em&gt;&lt;/em&gt;&lt;/p&gt;
</code></pre><p>However, strong emphasis within strong emphasis is possible without<br>
switching delimiters:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>****foo****
.
&lt;p&gt;&lt;strong&gt;&lt;strong&gt;foo&lt;/strong&gt;&lt;/strong&gt;&lt;/p&gt;
</code></pre><pre data-role="codeBlock" data-info="example" class="language-example"><code>____foo____
.
&lt;p&gt;&lt;strong&gt;&lt;strong&gt;foo&lt;/strong&gt;&lt;/strong&gt;&lt;/p&gt;
</code></pre><p>Rule 13 can be applied to arbitrarily long sequences of<br>
delimiters:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>******foo******
.
&lt;p&gt;&lt;strong&gt;&lt;strong&gt;&lt;strong&gt;foo&lt;/strong&gt;&lt;/strong&gt;&lt;/strong&gt;&lt;/p&gt;
</code></pre><p>Rule 14:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>***foo***
.
&lt;p&gt;&lt;em&gt;&lt;strong&gt;foo&lt;/strong&gt;&lt;/em&gt;&lt;/p&gt;
</code></pre><pre data-role="codeBlock" data-info="example" class="language-example"><code>_____foo_____
.
&lt;p&gt;&lt;em&gt;&lt;strong&gt;&lt;strong&gt;foo&lt;/strong&gt;&lt;/strong&gt;&lt;/em&gt;&lt;/p&gt;
</code></pre><p>Rule 15:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>*foo _bar* baz_
.
&lt;p&gt;&lt;em&gt;foo _bar&lt;/em&gt; baz_&lt;/p&gt;
</code></pre><pre data-role="codeBlock" data-info="example" class="language-example"><code>*foo __bar *baz bim__ bam*
.
&lt;p&gt;&lt;em&gt;foo &lt;strong&gt;bar *baz bim&lt;/strong&gt; bam&lt;/em&gt;&lt;/p&gt;
</code></pre><p>Rule 16:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>**foo **bar baz**
.
&lt;p&gt;**foo &lt;strong&gt;bar baz&lt;/strong&gt;&lt;/p&gt;
</code></pre><pre data-role="codeBlock" data-info="example" class="language-example"><code>*foo *bar baz*
.
&lt;p&gt;*foo &lt;em&gt;bar baz&lt;/em&gt;&lt;/p&gt;
</code></pre><p>Rule 17:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>*[bar*](/url)
.
&lt;p&gt;*&lt;a href=&quot;/url&quot;&gt;bar*&lt;/a&gt;&lt;/p&gt;
</code></pre><pre data-role="codeBlock" data-info="example" class="language-example"><code>_foo [bar_](/url)
.
&lt;p&gt;_foo &lt;a href=&quot;/url&quot;&gt;bar_&lt;/a&gt;&lt;/p&gt;
</code></pre><pre data-role="codeBlock" data-info="example" class="language-example"><code>*&lt;img src=&quot;foo&quot; title=&quot;*&quot;/&gt;
.
&lt;p&gt;*&lt;img src=&quot;foo&quot; title=&quot;*&quot;/&gt;&lt;/p&gt;
</code></pre><pre data-role="codeBlock" data-info="example" class="language-example"><code>**&lt;a href=&quot;**&quot;&gt;
.
&lt;p&gt;**&lt;a href=&quot;**&quot;&gt;&lt;/p&gt;
</code></pre><pre data-role="codeBlock" data-info="example" class="language-example"><code>__&lt;a href=&quot;__&quot;&gt;
.
&lt;p&gt;__&lt;a href=&quot;__&quot;&gt;&lt;/p&gt;
</code></pre><pre data-role="codeBlock" data-info="example" class="language-example"><code>*a `*`*
.
&lt;p&gt;&lt;em&gt;a &lt;code&gt;*&lt;/code&gt;&lt;/em&gt;&lt;/p&gt;
</code></pre><pre data-role="codeBlock" data-info="example" class="language-example"><code>_a `_`_
.
&lt;p&gt;&lt;em&gt;a &lt;code&gt;_&lt;/code&gt;&lt;/em&gt;&lt;/p&gt;
</code></pre><pre data-role="codeBlock" data-info="example" class="language-example"><code>**a&lt;http://foo.bar/?q=**&gt;
.
&lt;p&gt;**a&lt;a href=&quot;http://foo.bar/?q=**&quot;&gt;http://foo.bar/?q=**&lt;/a&gt;&lt;/p&gt;
</code></pre><pre data-role="codeBlock" data-info="example" class="language-example"><code>__a&lt;http://foo.bar/?q=__&gt;
.
&lt;p&gt;__a&lt;a href=&quot;http://foo.bar/?q=__&quot;&gt;http://foo.bar/?q=__&lt;/a&gt;&lt;/p&gt;
</code></pre><div class="extension">
<h2>Strikethrough (extension)</h2>
<p>GFM enables the <code>strikethrough</code> extension, where an additional emphasis type is<br>
available.</p>
<p>Strikethrough text is any text wrapped in two tildes (<code>~</code>).</p>
<pre data-role="codeBlock" data-info="example strikethrough" class="language-example"><code>~~Hi~~ Hello, world!
.
&lt;p&gt;&lt;del&gt;Hi&lt;/del&gt; Hello, world!&lt;/p&gt;
</code></pre><p>As with regular emphasis delimiters, a new paragraph will cause strikethrough<br>
parsing to cease:</p>
<pre data-role="codeBlock" data-info="example strikethrough" class="language-example"><code>This ~~has a

new paragraph~~.
.
&lt;p&gt;This ~~has a&lt;/p&gt;
&lt;p&gt;new paragraph~~.&lt;/p&gt;
</code></pre></div>
<h2 class="mume-header" id="links">Links</h2>

<p>A link contains [link text] (the visible text), a [link destination]<br>
(the URI that is the link destination), and optionally a [link title].<br>
There are two basic kinds of links in Markdown.  In [inline links] the<br>
destination and title are given immediately after the link text.  In<br>
[reference links] the destination and title are defined elsewhere in<br>
the document.</p>
<p>A <a href="@">link text</a> consists of a sequence of zero or more<br>
inline elements enclosed by square brackets (<code>[</code> and <code>]</code>).  The<br>
following rules apply:</p>
<ul>
<li>
<p>Links may not contain other links, at any level of nesting. If<br>
multiple otherwise valid link definitions appear nested inside each<br>
other, the inner-most definition is used.</p>
</li>
<li>
<p>Brackets are allowed in the [link text] only if (a) they<br>
are backslash-escaped or (b) they appear as a matched pair of brackets,<br>
with an open bracket <code>[</code>, a sequence of zero or more inlines, and<br>
a close bracket <code>]</code>.</p>
</li>
<li>
<p>Backtick [code spans], [autolinks], and raw [HTML tags] bind more tightly<br>
than the brackets in link text.  Thus, for example,<br>
<code>[foo`]`</code> could not be a link text, since the second <code>]</code><br>
is part of a code span.</p>
</li>
<li>
<p>The brackets in link text bind more tightly than markers for<br>
[emphasis and strong emphasis]. Thus, for example, <code>*[foo*](url)</code> is a link.</p>
</li>
</ul>
<p>A <a href="@">link destination</a> consists of either</p>
<ul>
<li>
<p>a sequence of zero or more characters between an opening <code>&lt;</code> and a<br>
closing <code>&gt;</code> that contains no line breaks or unescaped<br>
<code>&lt;</code> or <code>&gt;</code> characters, or</p>
</li>
<li>
<p>a nonempty sequence of characters that does not include<br>
ASCII space or control characters, and includes parentheses<br>
only if (a) they are backslash-escaped or (b) they are part of<br>
a balanced pair of unescaped parentheses.  (Implementations<br>
may impose limits on parentheses nesting to avoid performance<br>
issues, but at least three levels of nesting should be supported.)</p>
</li>
</ul>
<p>A <a href="@">link title</a>  consists of either</p>
<ul>
<li>
<p>a sequence of zero or more characters between straight double-quote<br>
characters (<code>&quot;</code>), including a <code>&quot;</code> character only if it is<br>
backslash-escaped, or</p>
</li>
<li>
<p>a sequence of zero or more characters between straight single-quote<br>
characters (<code>&apos;</code>), including a <code>&apos;</code> character only if it is<br>
backslash-escaped, or</p>
</li>
<li>
<p>a sequence of zero or more characters between matching parentheses<br>
(<code>(...)</code>), including a <code>)</code> character only if it is backslash-escaped.</p>
</li>
</ul>
<p>Although [link titles] may span multiple lines, they may not contain<br>
a [blank line].</p>
<p>An <a href="@">inline link</a> consists of a [link text] followed immediately<br>
by a left parenthesis <code>(</code>, optional [whitespace], an optional<br>
[link destination], an optional [link title] separated from the link<br>
destination by [whitespace], optional [whitespace], and a right<br>
parenthesis <code>)</code>. The link&apos;s text consists of the inlines contained<br>
in the [link text] (excluding the enclosing square brackets).<br>
The link&apos;s URI consists of the link destination, excluding enclosing<br>
<code>&lt;...&gt;</code> if present, with backslash-escapes in effect as described<br>
above.  The link&apos;s title consists of the link title, excluding its<br>
enclosing delimiters, with backslash-escapes in effect as described<br>
above.</p>
<p>Here is a simple inline link:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>[link](/uri &quot;title&quot;)
.
&lt;p&gt;&lt;a href=&quot;/uri&quot; title=&quot;title&quot;&gt;link&lt;/a&gt;&lt;/p&gt;
</code></pre><p>The title may be omitted:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>[link](/uri)
.
&lt;p&gt;&lt;a href=&quot;/uri&quot;&gt;link&lt;/a&gt;&lt;/p&gt;
</code></pre><p>Both the title and the destination may be omitted:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>[link]()
.
&lt;p&gt;&lt;a href=&quot;&quot;&gt;link&lt;/a&gt;&lt;/p&gt;
</code></pre><pre data-role="codeBlock" data-info="example" class="language-example"><code>[link](&lt;&gt;)
.
&lt;p&gt;&lt;a href=&quot;&quot;&gt;link&lt;/a&gt;&lt;/p&gt;
</code></pre><p>The destination can only contain spaces if it is<br>
enclosed in pointy brackets:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>[link](/my uri)
.
&lt;p&gt;[link](/my uri)&lt;/p&gt;
</code></pre><pre data-role="codeBlock" data-info="example" class="language-example"><code>[link](&lt;/my uri&gt;)
.
&lt;p&gt;&lt;a href=&quot;/my%20uri&quot;&gt;link&lt;/a&gt;&lt;/p&gt;
</code></pre><p>The destination cannot contain line breaks,<br>
even if enclosed in pointy brackets:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>[link](foo
bar)
.
&lt;p&gt;[link](foo
bar)&lt;/p&gt;
</code></pre><pre data-role="codeBlock" data-info="example" class="language-example"><code>[link](&lt;foo
bar&gt;)
.
&lt;p&gt;[link](&lt;foo
bar&gt;)&lt;/p&gt;
</code></pre><p>Parentheses inside the link destination may be escaped:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>[link](\(foo\))
.
&lt;p&gt;&lt;a href=&quot;(foo)&quot;&gt;link&lt;/a&gt;&lt;/p&gt;
</code></pre><p>Any number of parentheses are allowed without escaping, as long as they are<br>
balanced:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>[link](foo(and(bar)))
.
&lt;p&gt;&lt;a href=&quot;foo(and(bar))&quot;&gt;link&lt;/a&gt;&lt;/p&gt;
</code></pre><p>However, if you have unbalanced parentheses, you need to escape or use the<br>
<code>&lt;...&gt;</code> form:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>[link](foo\(and\(bar\))
.
&lt;p&gt;&lt;a href=&quot;foo(and(bar)&quot;&gt;link&lt;/a&gt;&lt;/p&gt;
</code></pre><pre data-role="codeBlock" data-info="example" class="language-example"><code>[link](&lt;foo(and(bar)&gt;)
.
&lt;p&gt;&lt;a href=&quot;foo(and(bar)&quot;&gt;link&lt;/a&gt;&lt;/p&gt;
</code></pre><p>Parentheses and other symbols can also be escaped, as usual<br>
in Markdown:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>[link](foo\)\:)
.
&lt;p&gt;&lt;a href=&quot;foo):&quot;&gt;link&lt;/a&gt;&lt;/p&gt;
</code></pre><p>A link can contain fragment identifiers and queries:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>[link](#fragment)

[link](http://example.com#fragment)

[link](http://example.com?foo=3#frag)
.
&lt;p&gt;&lt;a href=&quot;#fragment&quot;&gt;link&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;http://example.com#fragment&quot;&gt;link&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;http://example.com?foo=3#frag&quot;&gt;link&lt;/a&gt;&lt;/p&gt;
</code></pre><p>Note that a backslash before a non-escapable character is<br>
just a backslash:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>[link](foo\bar)
.
&lt;p&gt;&lt;a href=&quot;foo%5Cbar&quot;&gt;link&lt;/a&gt;&lt;/p&gt;
</code></pre><p>URL-escaping should be left alone inside the destination, as all<br>
URL-escaped characters are also valid URL characters. Entity and<br>
numerical character references in the destination will be parsed<br>
into the corresponding Unicode code points, as usual.  These may<br>
be optionally URL-escaped when written as HTML, but this spec<br>
does not enforce any particular policy for rendering URLs in<br>
HTML or other formats.  Renderers may make different decisions<br>
about how to escape or normalize URLs in the output.</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>[link](foo%20b&amp;auml;)
.
&lt;p&gt;&lt;a href=&quot;foo%20b%C3%A4&quot;&gt;link&lt;/a&gt;&lt;/p&gt;
</code></pre><p>Note that, because titles can often be parsed as destinations,<br>
if you try to omit the destination and keep the title, you&apos;ll<br>
get unexpected results:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>[link](&quot;title&quot;)
.
&lt;p&gt;&lt;a href=&quot;%22title%22&quot;&gt;link&lt;/a&gt;&lt;/p&gt;
</code></pre><p>Titles may be in single quotes, double quotes, or parentheses:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>[link](/url &quot;title&quot;)
[link](/url &apos;title&apos;)
[link](/url (title))
.
&lt;p&gt;&lt;a href=&quot;/url&quot; title=&quot;title&quot;&gt;link&lt;/a&gt;
&lt;a href=&quot;/url&quot; title=&quot;title&quot;&gt;link&lt;/a&gt;
&lt;a href=&quot;/url&quot; title=&quot;title&quot;&gt;link&lt;/a&gt;&lt;/p&gt;
</code></pre><p>Backslash escapes and entity and numeric character references<br>
may be used in titles:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>[link](/url &quot;title \&quot;&amp;quot;&quot;)
.
&lt;p&gt;&lt;a href=&quot;/url&quot; title=&quot;title &amp;quot;&amp;quot;&quot;&gt;link&lt;/a&gt;&lt;/p&gt;
</code></pre><p>Titles must be separated from the link using a [whitespace].<br>
Other [Unicode whitespace] like non-breaking space doesn&apos;t work.</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>[link](/url &quot;title&quot;)
.
&lt;p&gt;&lt;a href=&quot;/url%C2%A0%22title%22&quot;&gt;link&lt;/a&gt;&lt;/p&gt;
</code></pre><p>Nested balanced quotes are not allowed without escaping:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>[link](/url &quot;title &quot;and&quot; title&quot;)
.
&lt;p&gt;[link](/url &amp;quot;title &amp;quot;and&amp;quot; title&amp;quot;)&lt;/p&gt;
</code></pre><p>But it is easy to work around this by using a different quote type:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>[link](/url &apos;title &quot;and&quot; title&apos;)
.
&lt;p&gt;&lt;a href=&quot;/url&quot; title=&quot;title &amp;quot;and&amp;quot; title&quot;&gt;link&lt;/a&gt;&lt;/p&gt;
</code></pre><p>(Note:  <code>Markdown.pl</code> did allow double quotes inside a double-quoted<br>
title, and its test suite included a test demonstrating this.<br>
But it is hard to see a good rationale for the extra complexity this<br>
brings, since there are already many ways---backslash escaping,<br>
entity and numeric character references, or using a different<br>
quote type for the enclosing title---to write titles containing<br>
double quotes.  <code>Markdown.pl</code>&apos;s handling of titles has a number<br>
of other strange features.  For example, it allows single-quoted<br>
titles in inline links, but not reference links.  And, in<br>
reference links but not inline links, it allows a title to begin<br>
with <code>&quot;</code> and end with <code>)</code>.  <code>Markdown.pl</code> 1.0.1 even allows<br>
titles with no closing quotation mark, though 1.0.2b8 does not.<br>
It seems preferable to adopt a simple, rational rule that works<br>
the same way in inline links and link reference definitions.)</p>
<p>[Whitespace] is allowed around the destination and title:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>[link](   /uri
  &quot;title&quot;  )
.
&lt;p&gt;&lt;a href=&quot;/uri&quot; title=&quot;title&quot;&gt;link&lt;/a&gt;&lt;/p&gt;
</code></pre><p>But it is not allowed between the link text and the<br>
following parenthesis:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>[link] (/uri)
.
&lt;p&gt;[link] (/uri)&lt;/p&gt;
</code></pre><p>The link text may contain balanced brackets, but not unbalanced ones,<br>
unless they are escaped:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>[link [foo [bar]]](/uri)
.
&lt;p&gt;&lt;a href=&quot;/uri&quot;&gt;link [foo [bar]]&lt;/a&gt;&lt;/p&gt;
</code></pre><pre data-role="codeBlock" data-info="example" class="language-example"><code>[link] bar](/uri)
.
&lt;p&gt;[link] bar](/uri)&lt;/p&gt;
</code></pre><pre data-role="codeBlock" data-info="example" class="language-example"><code>[link [bar](/uri)
.
&lt;p&gt;[link &lt;a href=&quot;/uri&quot;&gt;bar&lt;/a&gt;&lt;/p&gt;
</code></pre><pre data-role="codeBlock" data-info="example" class="language-example"><code>[link \[bar](/uri)
.
&lt;p&gt;&lt;a href=&quot;/uri&quot;&gt;link [bar&lt;/a&gt;&lt;/p&gt;
</code></pre><p>The link text may contain inline content:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>[link *foo **bar** `#`*](/uri)
.
&lt;p&gt;&lt;a href=&quot;/uri&quot;&gt;link &lt;em&gt;foo &lt;strong&gt;bar&lt;/strong&gt; &lt;code&gt;#&lt;/code&gt;&lt;/em&gt;&lt;/a&gt;&lt;/p&gt;
</code></pre><pre data-role="codeBlock" data-info="example" class="language-example"><code>[![moon](moon.jpg)](/uri)
.
&lt;p&gt;&lt;a href=&quot;/uri&quot;&gt;&lt;img src=&quot;moon.jpg&quot; alt=&quot;moon&quot; /&gt;&lt;/a&gt;&lt;/p&gt;
</code></pre><p>However, links may not contain other links, at any level of nesting.</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>[foo [bar](/uri)](/uri)
.
&lt;p&gt;[foo &lt;a href=&quot;/uri&quot;&gt;bar&lt;/a&gt;](/uri)&lt;/p&gt;
</code></pre><pre data-role="codeBlock" data-info="example" class="language-example"><code>[foo *[bar [baz](/uri)](/uri)*](/uri)
.
&lt;p&gt;[foo &lt;em&gt;[bar &lt;a href=&quot;/uri&quot;&gt;baz&lt;/a&gt;](/uri)&lt;/em&gt;](/uri)&lt;/p&gt;
</code></pre><pre data-role="codeBlock" data-info="example" class="language-example"><code>![[[foo](uri1)](uri2)](uri3)
.
&lt;p&gt;&lt;img src=&quot;uri3&quot; alt=&quot;[foo](uri2)&quot; /&gt;&lt;/p&gt;
</code></pre><p>These cases illustrate the precedence of link text grouping over<br>
emphasis grouping:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>*[foo*](/uri)
.
&lt;p&gt;*&lt;a href=&quot;/uri&quot;&gt;foo*&lt;/a&gt;&lt;/p&gt;
</code></pre><pre data-role="codeBlock" data-info="example" class="language-example"><code>[foo *bar](baz*)
.
&lt;p&gt;&lt;a href=&quot;baz*&quot;&gt;foo *bar&lt;/a&gt;&lt;/p&gt;
</code></pre><p>Note that brackets that <em>aren&apos;t</em> part of links do not take<br>
precedence:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>*foo [bar* baz]
.
&lt;p&gt;&lt;em&gt;foo [bar&lt;/em&gt; baz]&lt;/p&gt;
</code></pre><p>These cases illustrate the precedence of HTML tags, code spans,<br>
and autolinks over link grouping:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>[foo &lt;bar attr=&quot;](baz)&quot;&gt;
.
&lt;p&gt;[foo &lt;bar attr=&quot;](baz)&quot;&gt;&lt;/p&gt;
</code></pre><pre data-role="codeBlock" data-info="example" class="language-example"><code>[foo`](/uri)`
.
&lt;p&gt;[foo&lt;code&gt;](/uri)&lt;/code&gt;&lt;/p&gt;
</code></pre><pre data-role="codeBlock" data-info="example" class="language-example"><code>[foo&lt;http://example.com/?search=](uri)&gt;
.
&lt;p&gt;[foo&lt;a href=&quot;http://example.com/?search=%5D(uri)&quot;&gt;http://example.com/?search=](uri)&lt;/a&gt;&lt;/p&gt;
</code></pre><p>There are three kinds of <a href="@">reference link</a>s:<br>
<a href="#full-reference-link">full</a>, <a href="#collapsed-reference-link">collapsed</a>,<br>
and <a href="#shortcut-reference-link">shortcut</a>.</p>
<p>A <a href="@">full reference link</a><br>
consists of a [link text] immediately followed by a [link label]<br>
that [matches] a [link reference definition] elsewhere in the document.</p>
<p>A <a href="@">link label</a>  begins with a left bracket (<code>[</code>) and ends<br>
with the first right bracket (<code>]</code>) that is not backslash-escaped.<br>
Between these brackets there must be at least one [non-whitespace character].<br>
Unescaped square bracket characters are not allowed inside the<br>
opening and closing square brackets of [link labels].  A link<br>
label can have at most 999 characters inside the square<br>
brackets.</p>
<p>One label <a href="@">matches</a><br>
another just in case their normalized forms are equal.  To normalize a<br>
label, strip off the opening and closing brackets,<br>
perform the <em>Unicode case fold</em>, strip leading and trailing<br>
[whitespace] and collapse consecutive internal<br>
[whitespace] to a single space.  If there are multiple<br>
matching reference link definitions, the one that comes first in the<br>
document is used.  (It is desirable in such cases to emit a warning.)</p>
<p>The contents of the first link label are parsed as inlines, which are<br>
used as the link&apos;s text.  The link&apos;s URI and title are provided by the<br>
matching [link reference definition].</p>
<p>Here is a simple example:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>[foo][bar]

[bar]: /url &quot;title&quot;
.
&lt;p&gt;&lt;a href=&quot;/url&quot; title=&quot;title&quot;&gt;foo&lt;/a&gt;&lt;/p&gt;
</code></pre><p>The rules for the [link text] are the same as with<br>
[inline links].  Thus:</p>
<p>The link text may contain balanced brackets, but not unbalanced ones,<br>
unless they are escaped:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>[link [foo [bar]]][ref]

[ref]: /uri
.
&lt;p&gt;&lt;a href=&quot;/uri&quot;&gt;link [foo [bar]]&lt;/a&gt;&lt;/p&gt;
</code></pre><pre data-role="codeBlock" data-info="example" class="language-example"><code>[link \[bar][ref]

[ref]: /uri
.
&lt;p&gt;&lt;a href=&quot;/uri&quot;&gt;link [bar&lt;/a&gt;&lt;/p&gt;
</code></pre><p>The link text may contain inline content:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>[link *foo **bar** `#`*][ref]

[ref]: /uri
.
&lt;p&gt;&lt;a href=&quot;/uri&quot;&gt;link &lt;em&gt;foo &lt;strong&gt;bar&lt;/strong&gt; &lt;code&gt;#&lt;/code&gt;&lt;/em&gt;&lt;/a&gt;&lt;/p&gt;
</code></pre><pre data-role="codeBlock" data-info="example" class="language-example"><code>[![moon](moon.jpg)][ref]

[ref]: /uri
.
&lt;p&gt;&lt;a href=&quot;/uri&quot;&gt;&lt;img src=&quot;moon.jpg&quot; alt=&quot;moon&quot; /&gt;&lt;/a&gt;&lt;/p&gt;
</code></pre><p>However, links may not contain other links, at any level of nesting.</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>[foo [bar](/uri)][ref]

[ref]: /uri
.
&lt;p&gt;[foo &lt;a href=&quot;/uri&quot;&gt;bar&lt;/a&gt;]&lt;a href=&quot;/uri&quot;&gt;ref&lt;/a&gt;&lt;/p&gt;
</code></pre><pre data-role="codeBlock" data-info="example" class="language-example"><code>[foo *bar [baz][ref]*][ref]

[ref]: /uri
.
&lt;p&gt;[foo &lt;em&gt;bar &lt;a href=&quot;/uri&quot;&gt;baz&lt;/a&gt;&lt;/em&gt;]&lt;a href=&quot;/uri&quot;&gt;ref&lt;/a&gt;&lt;/p&gt;
</code></pre><p>(In the examples above, we have two [shortcut reference links]<br>
instead of one [full reference link].)</p>
<p>The following cases illustrate the precedence of link text grouping over<br>
emphasis grouping:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>*[foo*][ref]

[ref]: /uri
.
&lt;p&gt;*&lt;a href=&quot;/uri&quot;&gt;foo*&lt;/a&gt;&lt;/p&gt;
</code></pre><pre data-role="codeBlock" data-info="example" class="language-example"><code>[foo *bar][ref]

[ref]: /uri
.
&lt;p&gt;&lt;a href=&quot;/uri&quot;&gt;foo *bar&lt;/a&gt;&lt;/p&gt;
</code></pre><p>These cases illustrate the precedence of HTML tags, code spans,<br>
and autolinks over link grouping:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>[foo &lt;bar attr=&quot;][ref]&quot;&gt;

[ref]: /uri
.
&lt;p&gt;[foo &lt;bar attr=&quot;][ref]&quot;&gt;&lt;/p&gt;
</code></pre><pre data-role="codeBlock" data-info="example" class="language-example"><code>[foo`][ref]`

[ref]: /uri
.
&lt;p&gt;[foo&lt;code&gt;][ref]&lt;/code&gt;&lt;/p&gt;
</code></pre><pre data-role="codeBlock" data-info="example" class="language-example"><code>[foo&lt;http://example.com/?search=][ref]&gt;

[ref]: /uri
.
&lt;p&gt;[foo&lt;a href=&quot;http://example.com/?search=%5D%5Bref%5D&quot;&gt;http://example.com/?search=][ref]&lt;/a&gt;&lt;/p&gt;
</code></pre><p>Matching is case-insensitive:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>[foo][BaR]

[bar]: /url &quot;title&quot;
.
&lt;p&gt;&lt;a href=&quot;/url&quot; title=&quot;title&quot;&gt;foo&lt;/a&gt;&lt;/p&gt;
</code></pre><p>Unicode case fold is used:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>[&#x422;&#x43E;&#x43B;&#x43F;&#x43E;&#x439;][&#x422;&#x43E;&#x43B;&#x43F;&#x43E;&#x439;] is a Russian word.

[&#x422;&#x41E;&#x41B;&#x41F;&#x41E;&#x419;]: /url
.
&lt;p&gt;&lt;a href=&quot;/url&quot;&gt;&#x422;&#x43E;&#x43B;&#x43F;&#x43E;&#x439;&lt;/a&gt; is a Russian word.&lt;/p&gt;
</code></pre><p>Consecutive internal [whitespace] is treated as one space for<br>
purposes of determining matching:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>[Foo
  bar]: /url

[Baz][Foo bar]
.
&lt;p&gt;&lt;a href=&quot;/url&quot;&gt;Baz&lt;/a&gt;&lt;/p&gt;
</code></pre><p>No [whitespace] is allowed between the [link text] and the<br>
[link label]:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>[foo] [bar]

[bar]: /url &quot;title&quot;
.
&lt;p&gt;[foo] &lt;a href=&quot;/url&quot; title=&quot;title&quot;&gt;bar&lt;/a&gt;&lt;/p&gt;
</code></pre><pre data-role="codeBlock" data-info="example" class="language-example"><code>[foo]
[bar]

[bar]: /url &quot;title&quot;
.
&lt;p&gt;[foo]
&lt;a href=&quot;/url&quot; title=&quot;title&quot;&gt;bar&lt;/a&gt;&lt;/p&gt;
</code></pre><p>This is a departure from John Gruber&apos;s original Markdown syntax<br>
description, which explicitly allows whitespace between the link<br>
text and the link label.  It brings reference links in line with<br>
[inline links], which (according to both original Markdown and<br>
this spec) cannot have whitespace after the link text.  More<br>
importantly, it prevents inadvertent capture of consecutive<br>
[shortcut reference links]. If whitespace is allowed between the<br>
link text and the link label, then in the following we will have<br>
a single reference link, not two shortcut reference links, as<br>
intended:</p>
<pre data-role="codeBlock" data-info="markdown" class="language-markdown">[foo]
[bar]

<span class="token url-reference url"><span class="token punctuation">[</span><span class="token variable">foo</span><span class="token punctuation">]</span><span class="token punctuation">:</span> /url1</span>
<span class="token url-reference url"><span class="token punctuation">[</span><span class="token variable">bar</span><span class="token punctuation">]</span><span class="token punctuation">:</span> /url2</span>
</pre><p>(Note that [shortcut reference links] were introduced by Gruber<br>
himself in a beta version of <code>Markdown.pl</code>, but never included<br>
in the official syntax description.  Without shortcut reference<br>
links, it is harmless to allow space between the link text and<br>
link label; but once shortcut references are introduced, it is<br>
too dangerous to allow this, as it frequently leads to<br>
unintended results.)</p>
<p>When there are multiple matching [link reference definitions],<br>
the first is used:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>[foo]: /url1

[foo]: /url2

[bar][foo]
.
&lt;p&gt;&lt;a href=&quot;/url1&quot;&gt;bar&lt;/a&gt;&lt;/p&gt;
</code></pre><p>Note that matching is performed on normalized strings, not parsed<br>
inline content.  So the following does not match, even though the<br>
labels define equivalent inline content:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>[bar][foo\!]

[foo!]: /url
.
&lt;p&gt;[bar][foo!]&lt;/p&gt;
</code></pre><p>[Link labels] cannot contain brackets, unless they are<br>
backslash-escaped:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>[foo][ref[]

[ref[]: /uri
.
&lt;p&gt;[foo][ref[]&lt;/p&gt;
&lt;p&gt;[ref[]: /uri&lt;/p&gt;
</code></pre><pre data-role="codeBlock" data-info="example" class="language-example"><code>[foo][ref[bar]]

[ref[bar]]: /uri
.
&lt;p&gt;[foo][ref[bar]]&lt;/p&gt;
&lt;p&gt;[ref[bar]]: /uri&lt;/p&gt;
</code></pre><pre data-role="codeBlock" data-info="example" class="language-example"><code>[[[foo]]]

[[[foo]]]: /url
.
&lt;p&gt;[[[foo]]]&lt;/p&gt;
&lt;p&gt;[[[foo]]]: /url&lt;/p&gt;
</code></pre><pre data-role="codeBlock" data-info="example" class="language-example"><code>[foo][ref\[]

[ref\[]: /uri
.
&lt;p&gt;&lt;a href=&quot;/uri&quot;&gt;foo&lt;/a&gt;&lt;/p&gt;
</code></pre><p>Note that in this example <code>]</code> is not backslash-escaped:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>[bar\\]: /uri

[bar\\]
.
&lt;p&gt;&lt;a href=&quot;/uri&quot;&gt;bar\&lt;/a&gt;&lt;/p&gt;
</code></pre><p>A [link label] must contain at least one [non-whitespace character]:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>[]

[]: /uri
.
&lt;p&gt;[]&lt;/p&gt;
&lt;p&gt;[]: /uri&lt;/p&gt;
</code></pre><pre data-role="codeBlock" data-info="example" class="language-example"><code>[
 ]

[
 ]: /uri
.
&lt;p&gt;[
]&lt;/p&gt;
&lt;p&gt;[
]: /uri&lt;/p&gt;
</code></pre><p>A <a href="@">collapsed reference link</a><br>
consists of a [link label] that [matches] a<br>
[link reference definition] elsewhere in the<br>
document, followed by the string <code>[]</code>.<br>
The contents of the first link label are parsed as inlines,<br>
which are used as the link&apos;s text.  The link&apos;s URI and title are<br>
provided by the matching reference link definition.  Thus,<br>
<code>[foo][]</code> is equivalent to <code>[foo][foo]</code>.</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>[foo][]

[foo]: /url &quot;title&quot;
.
&lt;p&gt;&lt;a href=&quot;/url&quot; title=&quot;title&quot;&gt;foo&lt;/a&gt;&lt;/p&gt;
</code></pre><pre data-role="codeBlock" data-info="example" class="language-example"><code>[*foo* bar][]

[*foo* bar]: /url &quot;title&quot;
.
&lt;p&gt;&lt;a href=&quot;/url&quot; title=&quot;title&quot;&gt;&lt;em&gt;foo&lt;/em&gt; bar&lt;/a&gt;&lt;/p&gt;
</code></pre><p>The link labels are case-insensitive:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>[Foo][]

[foo]: /url &quot;title&quot;
.
&lt;p&gt;&lt;a href=&quot;/url&quot; title=&quot;title&quot;&gt;Foo&lt;/a&gt;&lt;/p&gt;
</code></pre><p>As with full reference links, [whitespace] is not<br>
allowed between the two sets of brackets:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>[foo] 
[]

[foo]: /url &quot;title&quot;
.
&lt;p&gt;&lt;a href=&quot;/url&quot; title=&quot;title&quot;&gt;foo&lt;/a&gt;
[]&lt;/p&gt;
</code></pre><p>A <a href="@">shortcut reference link</a><br>
consists of a [link label] that [matches] a<br>
[link reference definition] elsewhere in the<br>
document and is not followed by <code>[]</code> or a link label.<br>
The contents of the first link label are parsed as inlines,<br>
which are used as the link&apos;s text.  The link&apos;s URI and title<br>
are provided by the matching link reference definition.<br>
Thus, <code>[foo]</code> is equivalent to <code>[foo][]</code>.</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>[foo]

[foo]: /url &quot;title&quot;
.
&lt;p&gt;&lt;a href=&quot;/url&quot; title=&quot;title&quot;&gt;foo&lt;/a&gt;&lt;/p&gt;
</code></pre><pre data-role="codeBlock" data-info="example" class="language-example"><code>[*foo* bar]

[*foo* bar]: /url &quot;title&quot;
.
&lt;p&gt;&lt;a href=&quot;/url&quot; title=&quot;title&quot;&gt;&lt;em&gt;foo&lt;/em&gt; bar&lt;/a&gt;&lt;/p&gt;
</code></pre><pre data-role="codeBlock" data-info="example" class="language-example"><code>[[*foo* bar]]

[*foo* bar]: /url &quot;title&quot;
.
&lt;p&gt;[&lt;a href=&quot;/url&quot; title=&quot;title&quot;&gt;&lt;em&gt;foo&lt;/em&gt; bar&lt;/a&gt;]&lt;/p&gt;
</code></pre><pre data-role="codeBlock" data-info="example" class="language-example"><code>[[bar [foo]

[foo]: /url
.
&lt;p&gt;[[bar &lt;a href=&quot;/url&quot;&gt;foo&lt;/a&gt;&lt;/p&gt;
</code></pre><p>The link labels are case-insensitive:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>[Foo]

[foo]: /url &quot;title&quot;
.
&lt;p&gt;&lt;a href=&quot;/url&quot; title=&quot;title&quot;&gt;Foo&lt;/a&gt;&lt;/p&gt;
</code></pre><p>A space after the link text should be preserved:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>[foo] bar

[foo]: /url
.
&lt;p&gt;&lt;a href=&quot;/url&quot;&gt;foo&lt;/a&gt; bar&lt;/p&gt;
</code></pre><p>If you just want bracketed text, you can backslash-escape the<br>
opening bracket to avoid links:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>\[foo]

[foo]: /url &quot;title&quot;
.
&lt;p&gt;[foo]&lt;/p&gt;
</code></pre><p>Note that this is a link, because a link label ends with the first<br>
following closing bracket:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>[foo*]: /url

*[foo*]
.
&lt;p&gt;*&lt;a href=&quot;/url&quot;&gt;foo*&lt;/a&gt;&lt;/p&gt;
</code></pre><p>Full and compact references take precedence over shortcut<br>
references:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>[foo][bar]

[foo]: /url1
[bar]: /url2
.
&lt;p&gt;&lt;a href=&quot;/url2&quot;&gt;foo&lt;/a&gt;&lt;/p&gt;
</code></pre><pre data-role="codeBlock" data-info="example" class="language-example"><code>[foo][]

[foo]: /url1
.
&lt;p&gt;&lt;a href=&quot;/url1&quot;&gt;foo&lt;/a&gt;&lt;/p&gt;
</code></pre><p>Inline links also take precedence:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>[foo]()

[foo]: /url1
.
&lt;p&gt;&lt;a href=&quot;&quot;&gt;foo&lt;/a&gt;&lt;/p&gt;
</code></pre><pre data-role="codeBlock" data-info="example" class="language-example"><code>[foo](not a link)

[foo]: /url1
.
&lt;p&gt;&lt;a href=&quot;/url1&quot;&gt;foo&lt;/a&gt;(not a link)&lt;/p&gt;
</code></pre><p>In the following case <code>[bar][baz]</code> is parsed as a reference,<br>
<code>[foo]</code> as normal text:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>[foo][bar][baz]

[baz]: /url
.
&lt;p&gt;[foo]&lt;a href=&quot;/url&quot;&gt;bar&lt;/a&gt;&lt;/p&gt;
</code></pre><p>Here, though, <code>[foo][bar]</code> is parsed as a reference, since<br>
<code>[bar]</code> is defined:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>[foo][bar][baz]

[baz]: /url1
[bar]: /url2
.
&lt;p&gt;&lt;a href=&quot;/url2&quot;&gt;foo&lt;/a&gt;&lt;a href=&quot;/url1&quot;&gt;baz&lt;/a&gt;&lt;/p&gt;
</code></pre><p>Here <code>[foo]</code> is not parsed as a shortcut reference, because it<br>
is followed by a link label (even though <code>[bar]</code> is not defined):</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>[foo][bar][baz]

[baz]: /url1
[foo]: /url2
.
&lt;p&gt;[foo]&lt;a href=&quot;/url1&quot;&gt;bar&lt;/a&gt;&lt;/p&gt;
</code></pre><h2 class="mume-header" id="images">Images</h2>

<p>Syntax for images is like the syntax for links, with one<br>
difference. Instead of [link text], we have an<br>
<a href="@">image description</a>.  The rules for this are the<br>
same as for [link text], except that (a) an<br>
image description starts with <code>![</code> rather than <code>[</code>, and<br>
(b) an image description may contain links.<br>
An image description has inline elements<br>
as its contents.  When an image is rendered to HTML,<br>
this is standardly used as the image&apos;s <code>alt</code> attribute.</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>![foo](/url &quot;title&quot;)
.
&lt;p&gt;&lt;img src=&quot;/url&quot; alt=&quot;foo&quot; title=&quot;title&quot; /&gt;&lt;/p&gt;
</code></pre><pre data-role="codeBlock" data-info="example" class="language-example"><code>![foo *bar*]

[foo *bar*]: train.jpg &quot;train &amp; tracks&quot;
.
&lt;p&gt;&lt;img src=&quot;train.jpg&quot; alt=&quot;foo bar&quot; title=&quot;train &amp;amp; tracks&quot; /&gt;&lt;/p&gt;
</code></pre><pre data-role="codeBlock" data-info="example" class="language-example"><code>![foo ![bar](/url)](/url2)
.
&lt;p&gt;&lt;img src=&quot;/url2&quot; alt=&quot;foo bar&quot; /&gt;&lt;/p&gt;
</code></pre><pre data-role="codeBlock" data-info="example" class="language-example"><code>![foo [bar](/url)](/url2)
.
&lt;p&gt;&lt;img src=&quot;/url2&quot; alt=&quot;foo bar&quot; /&gt;&lt;/p&gt;
</code></pre><p>Though this spec is concerned with parsing, not rendering, it is<br>
recommended that in rendering to HTML, only the plain string content<br>
of the [image description] be used.  Note that in<br>
the above example, the alt attribute&apos;s value is <code>foo bar</code>, not <code>foo [bar](/url)</code> or <code>foo &lt;a href=&quot;/url&quot;&gt;bar&lt;/a&gt;</code>.  Only the plain string<br>
content is rendered, without formatting.</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>![foo *bar*][]

[foo *bar*]: train.jpg &quot;train &amp; tracks&quot;
.
&lt;p&gt;&lt;img src=&quot;train.jpg&quot; alt=&quot;foo bar&quot; title=&quot;train &amp;amp; tracks&quot; /&gt;&lt;/p&gt;
</code></pre><pre data-role="codeBlock" data-info="example" class="language-example"><code>![foo *bar*][foobar]

[FOOBAR]: train.jpg &quot;train &amp; tracks&quot;
.
&lt;p&gt;&lt;img src=&quot;train.jpg&quot; alt=&quot;foo bar&quot; title=&quot;train &amp;amp; tracks&quot; /&gt;&lt;/p&gt;
</code></pre><pre data-role="codeBlock" data-info="example" class="language-example"><code>![foo](train.jpg)
.
&lt;p&gt;&lt;img src=&quot;train.jpg&quot; alt=&quot;foo&quot; /&gt;&lt;/p&gt;
</code></pre><pre data-role="codeBlock" data-info="example" class="language-example"><code>My ![foo bar](/path/to/train.jpg  &quot;title&quot;   )
.
&lt;p&gt;My &lt;img src=&quot;/path/to/train.jpg&quot; alt=&quot;foo bar&quot; title=&quot;title&quot; /&gt;&lt;/p&gt;
</code></pre><pre data-role="codeBlock" data-info="example" class="language-example"><code>![foo](&lt;url&gt;)
.
&lt;p&gt;&lt;img src=&quot;url&quot; alt=&quot;foo&quot; /&gt;&lt;/p&gt;
</code></pre><pre data-role="codeBlock" data-info="example" class="language-example"><code>![](/url)
.
&lt;p&gt;&lt;img src=&quot;/url&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
</code></pre><p>Reference-style:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>![foo][bar]

[bar]: /url
.
&lt;p&gt;&lt;img src=&quot;/url&quot; alt=&quot;foo&quot; /&gt;&lt;/p&gt;
</code></pre><pre data-role="codeBlock" data-info="example" class="language-example"><code>![foo][bar]

[BAR]: /url
.
&lt;p&gt;&lt;img src=&quot;/url&quot; alt=&quot;foo&quot; /&gt;&lt;/p&gt;
</code></pre><p>Collapsed:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>![foo][]

[foo]: /url &quot;title&quot;
.
&lt;p&gt;&lt;img src=&quot;/url&quot; alt=&quot;foo&quot; title=&quot;title&quot; /&gt;&lt;/p&gt;
</code></pre><pre data-role="codeBlock" data-info="example" class="language-example"><code>![*foo* bar][]

[*foo* bar]: /url &quot;title&quot;
.
&lt;p&gt;&lt;img src=&quot;/url&quot; alt=&quot;foo bar&quot; title=&quot;title&quot; /&gt;&lt;/p&gt;
</code></pre><p>The labels are case-insensitive:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>![Foo][]

[foo]: /url &quot;title&quot;
.
&lt;p&gt;&lt;img src=&quot;/url&quot; alt=&quot;Foo&quot; title=&quot;title&quot; /&gt;&lt;/p&gt;
</code></pre><p>As with reference links, [whitespace] is not allowed<br>
between the two sets of brackets:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>![foo] 
[]

[foo]: /url &quot;title&quot;
.
&lt;p&gt;&lt;img src=&quot;/url&quot; alt=&quot;foo&quot; title=&quot;title&quot; /&gt;
[]&lt;/p&gt;
</code></pre><p>Shortcut:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>![foo]

[foo]: /url &quot;title&quot;
.
&lt;p&gt;&lt;img src=&quot;/url&quot; alt=&quot;foo&quot; title=&quot;title&quot; /&gt;&lt;/p&gt;
</code></pre><pre data-role="codeBlock" data-info="example" class="language-example"><code>![*foo* bar]

[*foo* bar]: /url &quot;title&quot;
.
&lt;p&gt;&lt;img src=&quot;/url&quot; alt=&quot;foo bar&quot; title=&quot;title&quot; /&gt;&lt;/p&gt;
</code></pre><p>Note that link labels cannot contain unescaped brackets:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>![[foo]]

[[foo]]: /url &quot;title&quot;
.
&lt;p&gt;![[foo]]&lt;/p&gt;
&lt;p&gt;[[foo]]: /url &amp;quot;title&amp;quot;&lt;/p&gt;
</code></pre><p>The link labels are case-insensitive:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>![Foo]

[foo]: /url &quot;title&quot;
.
&lt;p&gt;&lt;img src=&quot;/url&quot; alt=&quot;Foo&quot; title=&quot;title&quot; /&gt;&lt;/p&gt;
</code></pre><p>If you just want a literal <code>!</code> followed by bracketed text, you can<br>
backslash-escape the opening <code>[</code>:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>!\[foo]

[foo]: /url &quot;title&quot;
.
&lt;p&gt;![foo]&lt;/p&gt;
</code></pre><p>If you want a link after a literal <code>!</code>, backslash-escape the<br>
<code>!</code>:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>\![foo]

[foo]: /url &quot;title&quot;
.
&lt;p&gt;!&lt;a href=&quot;/url&quot; title=&quot;title&quot;&gt;foo&lt;/a&gt;&lt;/p&gt;
</code></pre><h2 class="mume-header" id="autolinks">Autolinks</h2>

<p><a href="@">Autolink</a>s are absolute URIs and email addresses inside<br>
<code>&lt;</code> and <code>&gt;</code>. They are parsed as links, with the URL or email address<br>
as the link label.</p>
<p>A <a href="@">URI autolink</a> consists of <code>&lt;</code>, followed by an<br>
[absolute URI] not containing <code>&lt;</code>, followed by <code>&gt;</code>.  It is parsed as<br>
a link to the URI, with the URI as the link&apos;s label.</p>
<p>An <a href="@">absolute URI</a>,<br>
for these purposes, consists of a [scheme] followed by a colon (<code>:</code>)<br>
followed by zero or more characters other than ASCII<br>
[whitespace] and control characters, <code>&lt;</code>, and <code>&gt;</code>.  If<br>
the URI includes these characters, they must be percent-encoded<br>
(e.g. <code>%20</code> for a space).</p>
<p>For purposes of this spec, a <a href="@">scheme</a> is any sequence<br>
of 2--32 characters beginning with an ASCII letter and followed<br>
by any combination of ASCII letters, digits, or the symbols plus<br>
(&quot;+&quot;), period (&quot;.&quot;), or hyphen (&quot;-&quot;).</p>
<p>Here are some valid autolinks:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>&lt;http://foo.bar.baz&gt;
.
&lt;p&gt;&lt;a href=&quot;http://foo.bar.baz&quot;&gt;http://foo.bar.baz&lt;/a&gt;&lt;/p&gt;
</code></pre><pre data-role="codeBlock" data-info="example" class="language-example"><code>&lt;http://foo.bar.baz/test?q=hello&amp;id=22&amp;boolean&gt;
.
&lt;p&gt;&lt;a href=&quot;http://foo.bar.baz/test?q=hello&amp;amp;id=22&amp;amp;boolean&quot;&gt;http://foo.bar.baz/test?q=hello&amp;amp;id=22&amp;amp;boolean&lt;/a&gt;&lt;/p&gt;
</code></pre><pre data-role="codeBlock" data-info="example" class="language-example"><code>&lt;irc://foo.bar:2233/baz&gt;
.
&lt;p&gt;&lt;a href=&quot;irc://foo.bar:2233/baz&quot;&gt;irc://foo.bar:2233/baz&lt;/a&gt;&lt;/p&gt;
</code></pre><p>Uppercase is also fine:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>&lt;MAILTO:FOO@BAR.BAZ&gt;
.
&lt;p&gt;&lt;a href=&quot;MAILTO:FOO@BAR.BAZ&quot;&gt;MAILTO:FOO@BAR.BAZ&lt;/a&gt;&lt;/p&gt;
</code></pre><p>Note that many strings that count as [absolute URIs] for<br>
purposes of this spec are not valid URIs, because their<br>
schemes are not registered or because of other problems<br>
with their syntax:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>&lt;a+b+c:d&gt;
.
&lt;p&gt;&lt;a href=&quot;a+b+c:d&quot;&gt;a+b+c:d&lt;/a&gt;&lt;/p&gt;
</code></pre><pre data-role="codeBlock" data-info="example" class="language-example"><code>&lt;made-up-scheme://foo,bar&gt;
.
&lt;p&gt;&lt;a href=&quot;made-up-scheme://foo,bar&quot;&gt;made-up-scheme://foo,bar&lt;/a&gt;&lt;/p&gt;
</code></pre><pre data-role="codeBlock" data-info="example" class="language-example"><code>&lt;http://../&gt;
.
&lt;p&gt;&lt;a href=&quot;http://../&quot;&gt;http://../&lt;/a&gt;&lt;/p&gt;
</code></pre><pre data-role="codeBlock" data-info="example" class="language-example"><code>&lt;localhost:5001/foo&gt;
.
&lt;p&gt;&lt;a href=&quot;localhost:5001/foo&quot;&gt;localhost:5001/foo&lt;/a&gt;&lt;/p&gt;
</code></pre><p>Spaces are not allowed in autolinks:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>&lt;http://foo.bar/baz bim&gt;
.
&lt;p&gt;&amp;lt;http://foo.bar/baz bim&amp;gt;&lt;/p&gt;
</code></pre><p>Backslash-escapes do not work inside autolinks:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>&lt;http://example.com/\[\&gt;
.
&lt;p&gt;&lt;a href=&quot;http://example.com/%5C%5B%5C&quot;&gt;http://example.com/\[\&lt;/a&gt;&lt;/p&gt;
</code></pre><p>An <a href="@">email autolink</a><br>
consists of <code>&lt;</code>, followed by an [email address],<br>
followed by <code>&gt;</code>.  The link&apos;s label is the email address,<br>
and the URL is <code>mailto:</code> followed by the email address.</p>
<p>An <a href="@">email address</a>,<br>
for these purposes, is anything that matches<br>
the <a href="https://html.spec.whatwg.org/multipage/forms.html#e-mail-state-(type=email)">non-normative regex from the HTML5<br>
spec</a>:</p>
<pre class="language-text">/^[a-zA-Z0-9.!#$%&amp;&apos;*+/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?
(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/
</pre>
<p>Examples of email autolinks:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>&lt;foo@bar.example.com&gt;
.
&lt;p&gt;&lt;a href=&quot;mailto:foo@bar.example.com&quot;&gt;foo@bar.example.com&lt;/a&gt;&lt;/p&gt;
</code></pre><pre data-role="codeBlock" data-info="example" class="language-example"><code>&lt;foo+special@Bar.baz-bar0.com&gt;
.
&lt;p&gt;&lt;a href=&quot;mailto:foo+special@Bar.baz-bar0.com&quot;&gt;foo+special@Bar.baz-bar0.com&lt;/a&gt;&lt;/p&gt;
</code></pre><p>Backslash-escapes do not work inside email autolinks:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>&lt;foo\+@bar.example.com&gt;
.
&lt;p&gt;&amp;lt;foo+@bar.example.com&amp;gt;&lt;/p&gt;
</code></pre><p>These are not autolinks:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>&lt;&gt;
.
&lt;p&gt;&amp;lt;&amp;gt;&lt;/p&gt;
</code></pre><pre data-role="codeBlock" data-info="example" class="language-example"><code>&lt; http://foo.bar &gt;
.
&lt;p&gt;&amp;lt; http://foo.bar &amp;gt;&lt;/p&gt;
</code></pre><pre data-role="codeBlock" data-info="example" class="language-example"><code>&lt;m:abc&gt;
.
&lt;p&gt;&amp;lt;m:abc&amp;gt;&lt;/p&gt;
</code></pre><pre data-role="codeBlock" data-info="example" class="language-example"><code>&lt;foo.bar.baz&gt;
.
&lt;p&gt;&amp;lt;foo.bar.baz&amp;gt;&lt;/p&gt;
</code></pre><pre data-role="codeBlock" data-info="example" class="language-example"><code>http://example.com
.
&lt;p&gt;http://example.com&lt;/p&gt;
</code></pre><pre data-role="codeBlock" data-info="example" class="language-example"><code>foo@bar.example.com
.
&lt;p&gt;foo@bar.example.com&lt;/p&gt;
</code></pre><div class="extension">
<h2>Autolinks (extension)</h2>
<p>GFM enables the <code>autolink</code> extension, where autolinks will be recognised in a<br>
greater number of conditions.</p>
<p>[Autolink]s can also be constructed without requiring the use of <code>&lt;</code> and to <code>&gt;</code><br>
to delimit them, although they will be recognized under a smaller set of<br>
circumstances.  All such recognized autolinks can only come at the beginning of<br>
a line, after whitespace, or any of the delimiting characters <code>*</code>, <code>_</code>, <code>~</code>,<br>
and <code>(</code>.</p>
<p>An <a href="@">extended www autolink</a> will be recognized when the text <code>www.</code> is found<br>
followed by a [valid domain]. A <a href="@">valid domain</a> consists of alphanumeric<br>
characters, underscores (<code>_</code>), hyphens (<code>-</code>) and periods (<code>.</code>).  There must be<br>
at least one period, and no underscores may be present in the last two segments<br>
of the domain.</p>
<p>The scheme <code>http</code> will be inserted automatically:</p>
<pre data-role="codeBlock" data-info="example autolink" class="language-example"><code>www.commonmark.org
.
&lt;p&gt;&lt;a href=&quot;http://www.commonmark.org&quot;&gt;www.commonmark.org&lt;/a&gt;&lt;/p&gt;
</code></pre><p>After a [valid domain], zero or more non-space non-<code>&lt;</code> characters may follow:</p>
<pre data-role="codeBlock" data-info="example autolink" class="language-example"><code>Visit www.commonmark.org/help for more information.
.
&lt;p&gt;Visit &lt;a href=&quot;http://www.commonmark.org/help&quot;&gt;www.commonmark.org/help&lt;/a&gt; for more information.&lt;/p&gt;
</code></pre><p>We then apply <a href="@">extended autolink path validation</a> as follows:</p>
<p>Trailing punctuation (specifically, <code>?</code>, <code>!</code>, <code>.</code>, <code>,</code>, <code>:</code>, <code>*</code>, <code>_</code>, and <code>~</code>)<br>
will not be considered part of the autolink, though they may be included in the<br>
interior of the link:</p>
<pre data-role="codeBlock" data-info="example autolink" class="language-example"><code>Visit www.commonmark.org.

Visit www.commonmark.org/a.b.
.
&lt;p&gt;Visit &lt;a href=&quot;http://www.commonmark.org&quot;&gt;www.commonmark.org&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;Visit &lt;a href=&quot;http://www.commonmark.org/a.b&quot;&gt;www.commonmark.org/a.b&lt;/a&gt;.&lt;/p&gt;
</code></pre><p>When an autolink ends in <code>)</code>, we scan the entire autolink for the total number<br>
of parentheses.  If there is a greater number of closing parentheses than<br>
opening ones, we don&apos;t consider the last character part of the autolink, in<br>
order to facilitate including an autolink inside a parenthesis:</p>
<pre data-role="codeBlock" data-info="example autolink" class="language-example"><code>www.google.com/search?q=Markup+(business)

(www.google.com/search?q=Markup+(business))
.
&lt;p&gt;&lt;a href=&quot;http://www.google.com/search?q=Markup+(business)&quot;&gt;www.google.com/search?q=Markup+(business)&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;(&lt;a href=&quot;http://www.google.com/search?q=Markup+(business)&quot;&gt;www.google.com/search?q=Markup+(business)&lt;/a&gt;)&lt;/p&gt;
</code></pre><p>This check is only done when the link ends in a closing parentheses <code>)</code>, so if<br>
the only parentheses are in the interior of the autolink, no special rules are<br>
applied:</p>
<pre data-role="codeBlock" data-info="example autolink" class="language-example"><code>www.google.com/search?q=(business))+ok
.
&lt;p&gt;&lt;a href=&quot;http://www.google.com/search?q=(business))+ok&quot;&gt;www.google.com/search?q=(business))+ok&lt;/a&gt;&lt;/p&gt;
</code></pre><p>If an autolink ends in a semicolon (<code>;</code>), we check to see if it appears to<br>
resemble an [entity reference][entity references]; if the preceding text is <code>&amp;</code><br>
followed by one or more alphanumeric characters.  If so, it is excluded from<br>
the autolink:</p>
<pre data-role="codeBlock" data-info="example autolink" class="language-example"><code>www.google.com/search?q=commonmark&amp;hl=en

www.google.com/search?q=commonmark&amp;hl;
.
&lt;p&gt;&lt;a href=&quot;http://www.google.com/search?q=commonmark&amp;amp;hl=en&quot;&gt;www.google.com/search?q=commonmark&amp;amp;hl=en&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;http://www.google.com/search?q=commonmark&quot;&gt;www.google.com/search?q=commonmark&lt;/a&gt;&amp;amp;hl;&lt;/p&gt;
</code></pre><p><code>&lt;</code> immediately ends an autolink.</p>
<pre data-role="codeBlock" data-info="example autolink" class="language-example"><code>www.commonmark.org/he&lt;lp
.
&lt;p&gt;&lt;a href=&quot;http://www.commonmark.org/he&quot;&gt;www.commonmark.org/he&lt;/a&gt;&amp;lt;lp&lt;/p&gt;
</code></pre><p>An <a href="@">extended url autolink</a> will be recognised when one of the schemes<br>
<code>http://</code>, <code>https://</code>, or <code>ftp://</code>, followed by a [valid domain], then zero or<br>
more non-space non-<code>&lt;</code> characters according to<br>
[extended autolink path validation]:</p>
<pre data-role="codeBlock" data-info="example autolink" class="language-example"><code>http://commonmark.org

(Visit https://encrypted.google.com/search?q=Markup+(business))

Anonymous FTP is available at ftp://foo.bar.baz.
.
&lt;p&gt;&lt;a href=&quot;http://commonmark.org&quot;&gt;http://commonmark.org&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;(Visit &lt;a href=&quot;https://encrypted.google.com/search?q=Markup+(business)&quot;&gt;https://encrypted.google.com/search?q=Markup+(business)&lt;/a&gt;)&lt;/p&gt;
&lt;p&gt;Anonymous FTP is available at &lt;a href=&quot;ftp://foo.bar.baz&quot;&gt;ftp://foo.bar.baz&lt;/a&gt;.&lt;/p&gt;
</code></pre><p>An <a href="@">extended email autolink</a> will be recognised when an email address is<br>
recognised within any text node.  Email addresses are recognised according to<br>
the following rules:</p>
<ul>
<li>One ore more characters which are alphanumeric, or <code>.</code>, <code>-</code>, <code>_</code>, or <code>+</code>.</li>
<li>An <code>@</code> symbol.</li>
<li>One or more characters which are alphanumeric, or <code>.</code>, <code>-</code>, or <code>_</code>. At least<br>
one of the characters here must be a period (<code>.</code>).  The last character must<br>
not be one of <code>-</code> or <code>_</code>.  If the last character is a period (<code>.</code>), it will<br>
be excluded from the autolink.</li>
</ul>
<p>The scheme <code>mailto:</code> will automatically be added to the generated link:</p>
<pre data-role="codeBlock" data-info="example autolink" class="language-example"><code>foo@bar.baz
.
&lt;p&gt;&lt;a href=&quot;mailto:foo@bar.baz&quot;&gt;foo@bar.baz&lt;/a&gt;&lt;/p&gt;
</code></pre><p><code>+</code> can occur before the <code>@</code>, but not after.</p>
<pre data-role="codeBlock" data-info="example autolink" class="language-example"><code>hello@mail+xyz.example isn&apos;t valid, but hello+xyz@mail.example is.
.
&lt;p&gt;hello@mail+xyz.example isn&apos;t valid, but &lt;a href=&quot;mailto:hello+xyz@mail.example&quot;&gt;hello+xyz@mail.example&lt;/a&gt; is.&lt;/p&gt;
</code></pre><p><code>.</code>, <code>-</code>, and <code>_</code> can occur on both sides of the <code>@</code>, but only <code>.</code> may occur at<br>
the end of the email address, in which case it will not be considered part of<br>
the address:</p>
<pre data-role="codeBlock" data-info="example autolink" class="language-example"><code>a.b-c_d@a.b

a.b-c_d@a.b.

a.b-c_d@a.b-

a.b-c_d@a.b_
.
&lt;p&gt;&lt;a href=&quot;mailto:a.b-c_d@a.b&quot;&gt;a.b-c_d@a.b&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;mailto:a.b-c_d@a.b&quot;&gt;a.b-c_d@a.b&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;a.b-c_d@a.b-&lt;/p&gt;
&lt;p&gt;a.b-c_d@a.b_&lt;/p&gt;
</code></pre></div>
<h2 class="mume-header" id="raw-html">Raw HTML</h2>

<p>Text between <code>&lt;</code> and <code>&gt;</code> that looks like an HTML tag is parsed as a<br>
raw HTML tag and will be rendered in HTML without escaping.<br>
Tag and attribute names are not limited to current HTML tags,<br>
so custom tags (and even, say, DocBook tags) may be used.</p>
<p>Here is the grammar for tags:</p>
<p>A <a href="@">tag name</a> consists of an ASCII letter<br>
followed by zero or more ASCII letters, digits, or<br>
hyphens (<code>-</code>).</p>
<p>An <a href="@">attribute</a> consists of [whitespace],<br>
an [attribute name], and an optional<br>
[attribute value specification].</p>
<p>An <a href="@">attribute name</a><br>
consists of an ASCII letter, <code>_</code>, or <code>:</code>, followed by zero or more ASCII<br>
letters, digits, <code>_</code>, <code>.</code>, <code>:</code>, or <code>-</code>.  (Note:  This is the XML<br>
specification restricted to ASCII.  HTML5 is laxer.)</p>
<p>An <a href="@">attribute value specification</a><br>
consists of optional [whitespace],<br>
a <code>=</code> character, optional [whitespace], and an [attribute<br>
value].</p>
<p>An <a href="@">attribute value</a><br>
consists of an [unquoted attribute value],<br>
a [single-quoted attribute value], or a [double-quoted attribute value].</p>
<p>An <a href="@">unquoted attribute value</a><br>
is a nonempty string of characters not<br>
including [whitespace], <code>&quot;</code>, <code>&apos;</code>, <code>=</code>, <code>&lt;</code>, <code>&gt;</code>, or <code>`</code>.</p>
<p>A <a href="@">single-quoted attribute value</a><br>
consists of <code>&apos;</code>, zero or more<br>
characters not including <code>&apos;</code>, and a final <code>&apos;</code>.</p>
<p>A <a href="@">double-quoted attribute value</a><br>
consists of <code>&quot;</code>, zero or more<br>
characters not including <code>&quot;</code>, and a final <code>&quot;</code>.</p>
<p>An <a href="@">open tag</a> consists of a <code>&lt;</code> character, a [tag name],<br>
zero or more [attributes], optional [whitespace], an optional <code>/</code><br>
character, and a <code>&gt;</code> character.</p>
<p>A <a href="@">closing tag</a> consists of the string <code>&lt;/</code>, a<br>
[tag name], optional [whitespace], and the character <code>&gt;</code>.</p>
<p>An <a href="@">HTML comment</a> consists of <code>&lt;!--</code> + <em>text</em> + <code>--&gt;</code>,<br>
where <em>text</em> does not start with <code>&gt;</code> or <code>-&gt;</code>, does not end with <code>-</code>,<br>
and does not contain <code>--</code>.  (See the<br>
<a href="http://www.w3.org/TR/html5/syntax.html#comments">HTML5 spec</a>.)</p>
<p>A <a href="@">processing instruction</a><br>
consists of the string <code>&lt;?</code>, a string<br>
of characters not including the string <code>?&gt;</code>, and the string<br>
<code>?&gt;</code>.</p>
<p>A <a href="@">declaration</a> consists of the<br>
string <code>&lt;!</code>, a name consisting of one or more uppercase ASCII letters,<br>
[whitespace], a string of characters not including the<br>
character <code>&gt;</code>, and the character <code>&gt;</code>.</p>
<p>A <a href="@">CDATA section</a> consists of<br>
the string <code>&lt;![CDATA[</code>, a string of characters not including the string<br>
<code>]]&gt;</code>, and the string <code>]]&gt;</code>.</p>
<p>An <a href="@">HTML tag</a> consists of an [open tag], a [closing tag],<br>
an [HTML comment], a [processing instruction], a [declaration],<br>
or a [CDATA section].</p>
<p>Here are some simple open tags:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>&lt;a&gt;&lt;bab&gt;&lt;c2c&gt;
.
&lt;p&gt;&lt;a&gt;&lt;bab&gt;&lt;c2c&gt;&lt;/p&gt;
</code></pre><p>Empty elements:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>&lt;a/&gt;&lt;b2/&gt;
.
&lt;p&gt;&lt;a/&gt;&lt;b2/&gt;&lt;/p&gt;
</code></pre><p>[Whitespace] is allowed:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>&lt;a  /&gt;&lt;b2
data=&quot;foo&quot; &gt;
.
&lt;p&gt;&lt;a  /&gt;&lt;b2
data=&quot;foo&quot; &gt;&lt;/p&gt;
</code></pre><p>With attributes:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>&lt;a foo=&quot;bar&quot; bam = &apos;baz &lt;em&gt;&quot;&lt;/em&gt;&apos;
_boolean zoop:33=zoop:33 /&gt;
.
&lt;p&gt;&lt;a foo=&quot;bar&quot; bam = &apos;baz &lt;em&gt;&quot;&lt;/em&gt;&apos;
_boolean zoop:33=zoop:33 /&gt;&lt;/p&gt;
</code></pre><p>Custom tag names can be used:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>Foo &lt;responsive-image src=&quot;foo.jpg&quot; /&gt;
.
&lt;p&gt;Foo &lt;responsive-image src=&quot;foo.jpg&quot; /&gt;&lt;/p&gt;
</code></pre><p>Illegal tag names, not parsed as HTML:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>&lt;33&gt; &lt;__&gt;
.
&lt;p&gt;&amp;lt;33&amp;gt; &amp;lt;__&amp;gt;&lt;/p&gt;
</code></pre><p>Illegal attribute names:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>&lt;a h*#ref=&quot;hi&quot;&gt;
.
&lt;p&gt;&amp;lt;a h*#ref=&amp;quot;hi&amp;quot;&amp;gt;&lt;/p&gt;
</code></pre><p>Illegal attribute values:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>&lt;a href=&quot;hi&apos;&gt; &lt;a href=hi&apos;&gt;
.
&lt;p&gt;&amp;lt;a href=&amp;quot;hi&apos;&amp;gt; &amp;lt;a href=hi&apos;&amp;gt;&lt;/p&gt;
</code></pre><p>Illegal [whitespace]:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>&lt; a&gt;&lt;
foo&gt;&lt;bar/ &gt;
&lt;foo bar=baz
bim!bop /&gt;
.
&lt;p&gt;&amp;lt; a&amp;gt;&amp;lt;
foo&amp;gt;&amp;lt;bar/ &amp;gt;
&amp;lt;foo bar=baz
bim!bop /&amp;gt;&lt;/p&gt;
</code></pre><p>Missing [whitespace]:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>&lt;a href=&apos;bar&apos;title=title&gt;
.
&lt;p&gt;&amp;lt;a href=&apos;bar&apos;title=title&amp;gt;&lt;/p&gt;
</code></pre><p>Closing tags:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>&lt;/a&gt;&lt;/foo &gt;
.
&lt;p&gt;&lt;/a&gt;&lt;/foo &gt;&lt;/p&gt;
</code></pre><p>Illegal attributes in closing tag:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>&lt;/a href=&quot;foo&quot;&gt;
.
&lt;p&gt;&amp;lt;/a href=&amp;quot;foo&amp;quot;&amp;gt;&lt;/p&gt;
</code></pre><p>Comments:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>foo &lt;!-- this is a
comment - with hyphen --&gt;
.
&lt;p&gt;foo &lt;!-- this is a
comment - with hyphen --&gt;&lt;/p&gt;
</code></pre><pre data-role="codeBlock" data-info="example" class="language-example"><code>foo &lt;!-- not a comment -- two hyphens --&gt;
.
&lt;p&gt;foo &amp;lt;!-- not a comment -- two hyphens --&amp;gt;&lt;/p&gt;
</code></pre><p>Not comments:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>foo &lt;!--&gt; foo --&gt;

foo &lt;!-- foo---&gt;
.
&lt;p&gt;foo &amp;lt;!--&amp;gt; foo --&amp;gt;&lt;/p&gt;
&lt;p&gt;foo &amp;lt;!-- foo---&amp;gt;&lt;/p&gt;
</code></pre><p>Processing instructions:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>foo &lt;?php echo $a; ?&gt;
.
&lt;p&gt;foo &lt;?php echo $a; ?&gt;&lt;/p&gt;
</code></pre><p>Declarations:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>foo &lt;!ELEMENT br EMPTY&gt;
.
&lt;p&gt;foo &lt;!ELEMENT br EMPTY&gt;&lt;/p&gt;
</code></pre><p>CDATA sections:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>foo &lt;![CDATA[&gt;&amp;&lt;]]&gt;
.
&lt;p&gt;foo &lt;![CDATA[&gt;&amp;&lt;]]&gt;&lt;/p&gt;
</code></pre><p>Entity and numeric character references are preserved in HTML<br>
attributes:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>foo &lt;a href=&quot;&amp;ouml;&quot;&gt;
.
&lt;p&gt;foo &lt;a href=&quot;&amp;ouml;&quot;&gt;&lt;/p&gt;
</code></pre><p>Backslash escapes do not work in HTML attributes:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>foo &lt;a href=&quot;\*&quot;&gt;
.
&lt;p&gt;foo &lt;a href=&quot;\*&quot;&gt;&lt;/p&gt;
</code></pre><pre data-role="codeBlock" data-info="example" class="language-example"><code>&lt;a href=&quot;\&quot;&quot;&gt;
.
&lt;p&gt;&amp;lt;a href=&amp;quot;&amp;quot;&amp;quot;&amp;gt;&lt;/p&gt;
</code></pre><div class="extension">
<h2>Disallowed Raw HTML (extension)</h2>
<p>GFM enables the <code>tagfilter</code> extension, where the following HTML tags will be<br>
filtered when rendering HTML output:</p>
<ul>
<li><code>&lt;title&gt;</code></li>
<li><code>&lt;textarea&gt;</code></li>
<li><code>&lt;style&gt;</code></li>
<li><code>&lt;xmp&gt;</code></li>
<li><code>&lt;iframe&gt;</code></li>
<li><code>&lt;noembed&gt;</code></li>
<li><code>&lt;noframes&gt;</code></li>
<li><code>&lt;script&gt;</code></li>
<li><code>&lt;plaintext&gt;</code></li>
</ul>
<p>Filtering is done by replacing the leading <code>&lt;</code> with the entity <code>&amp;lt;</code>.  These<br>
tags are chosen in particular as they change how HTML is interpreted in a way<br>
unique to them (i.e. nested HTML is interpreted differently), and this is<br>
usually undesireable in the context of other rendered Markdown content.</p>
<p>All other HTML tags are left untouched.</p>
<pre data-role="codeBlock" data-info="example tagfilter" class="language-example"><code>&lt;strong&gt; &lt;title&gt; &lt;style&gt; &lt;em&gt;

&lt;blockquote&gt;
  &lt;xmp&gt; is disallowed.  &lt;XMP&gt; is also disallowed.
&lt;/blockquote&gt;
.
&lt;p&gt;&lt;strong&gt; &amp;lt;title&gt; &amp;lt;style&gt; &lt;em&gt;&lt;/p&gt;
&lt;blockquote&gt;
  &amp;lt;xmp&gt; is disallowed.  &amp;lt;XMP&gt; is also disallowed.
&lt;/blockquote&gt;
</code></pre></div>
<h2 class="mume-header" id="hard-line-breaks">Hard line breaks</h2>

<p>A line break (not in a code span or HTML tag) that is preceded<br>
by two or more spaces and does not occur at the end of a block<br>
is parsed as a <a href="@">hard line break</a> (rendered<br>
in HTML as a <code>&lt;br /&gt;</code> tag):</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>foo  
baz
.
&lt;p&gt;foo&lt;br /&gt;
baz&lt;/p&gt;
</code></pre><p>For a more visible alternative, a backslash before the<br>
[line ending] may be used instead of two spaces:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>foo\
baz
.
&lt;p&gt;foo&lt;br /&gt;
baz&lt;/p&gt;
</code></pre><p>More than two spaces can be used:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>foo       
baz
.
&lt;p&gt;foo&lt;br /&gt;
baz&lt;/p&gt;
</code></pre><p>Leading spaces at the beginning of the next line are ignored:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>foo  
     bar
.
&lt;p&gt;foo&lt;br /&gt;
bar&lt;/p&gt;
</code></pre><pre data-role="codeBlock" data-info="example" class="language-example"><code>foo\
     bar
.
&lt;p&gt;foo&lt;br /&gt;
bar&lt;/p&gt;
</code></pre><p>Line breaks can occur inside emphasis, links, and other constructs<br>
that allow inline content:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>*foo  
bar*
.
&lt;p&gt;&lt;em&gt;foo&lt;br /&gt;
bar&lt;/em&gt;&lt;/p&gt;
</code></pre><pre data-role="codeBlock" data-info="example" class="language-example"><code>*foo\
bar*
.
&lt;p&gt;&lt;em&gt;foo&lt;br /&gt;
bar&lt;/em&gt;&lt;/p&gt;
</code></pre><p>Line breaks do not occur inside code spans</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>`code 
span`
.
&lt;p&gt;&lt;code&gt;code  span&lt;/code&gt;&lt;/p&gt;
</code></pre><pre data-role="codeBlock" data-info="example" class="language-example"><code>`code\
span`
.
&lt;p&gt;&lt;code&gt;code\ span&lt;/code&gt;&lt;/p&gt;
</code></pre><p>or HTML tags:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>&lt;a href=&quot;foo  
bar&quot;&gt;
.
&lt;p&gt;&lt;a href=&quot;foo  
bar&quot;&gt;&lt;/p&gt;
</code></pre><pre data-role="codeBlock" data-info="example" class="language-example"><code>&lt;a href=&quot;foo\
bar&quot;&gt;
.
&lt;p&gt;&lt;a href=&quot;foo\
bar&quot;&gt;&lt;/p&gt;
</code></pre><p>Hard line breaks are for separating inline content within a block.<br>
Neither syntax for hard line breaks works at the end of a paragraph or<br>
other block element:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>foo\
.
&lt;p&gt;foo\&lt;/p&gt;
</code></pre><pre data-role="codeBlock" data-info="example" class="language-example"><code>foo  
.
&lt;p&gt;foo&lt;/p&gt;
</code></pre><pre data-role="codeBlock" data-info="example" class="language-example"><code>### foo\
.
&lt;h3&gt;foo\&lt;/h3&gt;
</code></pre><pre data-role="codeBlock" data-info="example" class="language-example"><code>### foo  
.
&lt;h3&gt;foo&lt;/h3&gt;
</code></pre><h2 class="mume-header" id="soft-line-breaks">Soft line breaks</h2>

<p>A regular line break (not in a code span or HTML tag) that is not<br>
preceded by two or more spaces or a backslash is parsed as a<br>
<a href="@">softbreak</a>.  (A softbreak may be rendered in HTML either as a<br>
[line ending] or as a space. The result will be the same in<br>
browsers. In the examples here, a [line ending] will be used.)</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>foo
baz
.
&lt;p&gt;foo
baz&lt;/p&gt;
</code></pre><p>Spaces at the end of the line and beginning of the next line are<br>
removed:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>foo 
 baz
.
&lt;p&gt;foo
baz&lt;/p&gt;
</code></pre><p>A conforming parser may render a soft line break in HTML either as a<br>
line break or as a space.</p>
<p>A renderer may also provide an option to render soft line breaks<br>
as hard line breaks.</p>
<h2 class="mume-header" id="textual-content">Textual content</h2>

<p>Any characters not given an interpretation by the above rules will<br>
be parsed as plain textual content.</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>hello $.;&apos;there
.
&lt;p&gt;hello $.;&apos;there&lt;/p&gt;
</code></pre><pre data-role="codeBlock" data-info="example" class="language-example"><code>Foo &#x3C7;&#x3C1;&#x1FC6;&#x3BD;
.
&lt;p&gt;Foo &#x3C7;&#x3C1;&#x1FC6;&#x3BD;&lt;/p&gt;
</code></pre><p>Internal spaces are preserved verbatim:</p>
<pre data-role="codeBlock" data-info="example" class="language-example"><code>Multiple     spaces
.
&lt;p&gt;Multiple     spaces&lt;/p&gt;
</code></pre><h1 class="mume-header" id="appendix-a-parsing-strategy">Appendix: A parsing strategy</h1>

<p>In this appendix we describe some features of the parsing strategy<br>
used in the CommonMark reference implementations.</p>
<h2 class="mume-header" id="overview">Overview</h2>

<p>Parsing has two phases:</p>
<ol>
<li>
<p>In the first phase, lines of input are consumed and the block<br>
structure of the document---its division into paragraphs, block quotes,<br>
list items, and so on---is constructed.  Text is assigned to these<br>
blocks but not parsed. Link reference definitions are parsed and a<br>
map of links is constructed.</p>
</li>
<li>
<p>In the second phase, the raw text contents of paragraphs and headings<br>
are parsed into sequences of Markdown inline elements (strings,<br>
code spans, links, emphasis, and so on), using the map of link<br>
references constructed in phase 1.</p>
</li>
</ol>
<p>At each point in processing, the document is represented as a tree of<br>
<strong>blocks</strong>.  The root of the tree is a <code>document</code> block.  The <code>document</code><br>
may have any number of other blocks as <strong>children</strong>.  These children<br>
may, in turn, have other blocks as children.  The last child of a block<br>
is normally considered <strong>open</strong>, meaning that subsequent lines of input<br>
can alter its contents.  (Blocks that are not open are <strong>closed</strong>.)<br>
Here, for example, is a possible document tree, with the open blocks<br>
marked by arrows:</p>
<pre data-role="codeBlock" data-info="tree" class="language-tree"><code>-&gt; document
  -&gt; block_quote
       paragraph
         &quot;Lorem ipsum dolor\nsit amet.&quot;
    -&gt; list (type=bullet tight=true bullet_char=-)
         list_item
           paragraph
             &quot;Qui *quodsi iracundia*&quot;
      -&gt; list_item
        -&gt; paragraph
             &quot;aliquando id&quot;
</code></pre><h2 class="mume-header" id="phase-1-block-structure">Phase 1: block structure</h2>

<p>Each line that is processed has an effect on this tree.  The line is<br>
analyzed and, depending on its contents, the document may be altered<br>
in one or more of the following ways:</p>
<ol>
<li>One or more open blocks may be closed.</li>
<li>One or more new blocks may be created as children of the<br>
last open block.</li>
<li>Text may be added to the last (deepest) open block remaining<br>
on the tree.</li>
</ol>
<p>Once a line has been incorporated into the tree in this way,<br>
it can be discarded, so input can be read in a stream.</p>
<p>For each line, we follow this procedure:</p>
<ol>
<li>
<p>First we iterate through the open blocks, starting with the<br>
root document, and descending through last children down to the last<br>
open block.  Each block imposes a condition that the line must satisfy<br>
if the block is to remain open.  For example, a block quote requires a<br>
<code>&gt;</code> character.  A paragraph requires a non-blank line.<br>
In this phase we may match all or just some of the open<br>
blocks.  But we cannot close unmatched blocks yet, because we may have a<br>
[lazy continuation line].</p>
</li>
<li>
<p>Next, after consuming the continuation markers for existing<br>
blocks, we look for new block starts (e.g. <code>&gt;</code> for a block quote).<br>
If we encounter a new block start, we close any blocks unmatched<br>
in step 1 before creating the new block as a child of the last<br>
matched block.</p>
</li>
<li>
<p>Finally, we look at the remainder of the line (after block<br>
markers like <code>&gt;</code>, list markers, and indentation have been consumed).<br>
This is text that can be incorporated into the last open<br>
block (a paragraph, code block, heading, or raw HTML).</p>
</li>
</ol>
<p>Setext headings are formed when we see a line of a paragraph<br>
that is a [setext heading underline].</p>
<p>Reference link definitions are detected when a paragraph is closed;<br>
the accumulated text lines are parsed to see if they begin with<br>
one or more reference link definitions.  Any remainder becomes a<br>
normal paragraph.</p>
<p>We can see how this works by considering how the tree above is<br>
generated by four lines of Markdown:</p>
<pre data-role="codeBlock" data-info="markdown" class="language-markdown"><span class="token blockquote punctuation">&gt;</span> Lorem ipsum dolor
sit amet.
<span class="token blockquote punctuation">&gt;</span> <span class="token list punctuation">-</span> Qui <span class="token italic"><span class="token punctuation">*</span><span class="token content">quodsi iracundia</span><span class="token punctuation">*</span></span>
<span class="token blockquote punctuation">&gt;</span> <span class="token list punctuation">-</span> aliquando id
</pre><p>At the outset, our document model is just</p>
<pre data-role="codeBlock" data-info="tree" class="language-tree"><code>-&gt; document
</code></pre><p>The first line of our text,</p>
<pre data-role="codeBlock" data-info="markdown" class="language-markdown"><span class="token blockquote punctuation">&gt;</span> Lorem ipsum dolor
</pre><p>causes a <code>block_quote</code> block to be created as a child of our<br>
open <code>document</code> block, and a <code>paragraph</code> block as a child of<br>
the <code>block_quote</code>.  Then the text is added to the last open<br>
block, the <code>paragraph</code>:</p>
<pre data-role="codeBlock" data-info="tree" class="language-tree"><code>-&gt; document
  -&gt; block_quote
    -&gt; paragraph
         &quot;Lorem ipsum dolor&quot;
</code></pre><p>The next line,</p>
<pre data-role="codeBlock" data-info="markdown" class="language-markdown">sit amet.
</pre><p>is a &quot;lazy continuation&quot; of the open <code>paragraph</code>, so it gets added<br>
to the paragraph&apos;s text:</p>
<pre data-role="codeBlock" data-info="tree" class="language-tree"><code>-&gt; document
  -&gt; block_quote
    -&gt; paragraph
         &quot;Lorem ipsum dolor\nsit amet.&quot;
</code></pre><p>The third line,</p>
<pre data-role="codeBlock" data-info="markdown" class="language-markdown"><span class="token blockquote punctuation">&gt;</span> <span class="token list punctuation">-</span> Qui <span class="token italic"><span class="token punctuation">*</span><span class="token content">quodsi iracundia</span><span class="token punctuation">*</span></span>
</pre><p>causes the <code>paragraph</code> block to be closed, and a new <code>list</code> block<br>
opened as a child of the <code>block_quote</code>.  A <code>list_item</code> is also<br>
added as a child of the <code>list</code>, and a <code>paragraph</code> as a child of<br>
the <code>list_item</code>.  The text is then added to the new <code>paragraph</code>:</p>
<pre data-role="codeBlock" data-info="tree" class="language-tree"><code>-&gt; document
  -&gt; block_quote
       paragraph
         &quot;Lorem ipsum dolor\nsit amet.&quot;
    -&gt; list (type=bullet tight=true bullet_char=-)
      -&gt; list_item
        -&gt; paragraph
             &quot;Qui *quodsi iracundia*&quot;
</code></pre><p>The fourth line,</p>
<pre data-role="codeBlock" data-info="markdown" class="language-markdown"><span class="token blockquote punctuation">&gt;</span> <span class="token list punctuation">-</span> aliquando id
</pre><p>causes the <code>list_item</code> (and its child the <code>paragraph</code>) to be closed,<br>
and a new <code>list_item</code> opened up as child of the <code>list</code>.  A <code>paragraph</code><br>
is added as a child of the new <code>list_item</code>, to contain the text.<br>
We thus obtain the final tree:</p>
<pre data-role="codeBlock" data-info="tree" class="language-tree"><code>-&gt; document
  -&gt; block_quote
       paragraph
         &quot;Lorem ipsum dolor\nsit amet.&quot;
    -&gt; list (type=bullet tight=true bullet_char=-)
         list_item
           paragraph
             &quot;Qui *quodsi iracundia*&quot;
      -&gt; list_item
        -&gt; paragraph
             &quot;aliquando id&quot;
</code></pre><h2 class="mume-header" id="phase-2-inline-structure">Phase 2: inline structure</h2>

<p>Once all of the input has been parsed, all open blocks are closed.</p>
<p>We then &quot;walk the tree,&quot; visiting every node, and parse raw<br>
string contents of paragraphs and headings as inlines.  At this<br>
point we have seen all the link reference definitions, so we can<br>
resolve reference links as we go.</p>
<pre data-role="codeBlock" data-info="tree" class="language-tree"><code>document
  block_quote
    paragraph
      str &quot;Lorem ipsum dolor&quot;
      softbreak
      str &quot;sit amet.&quot;
    list (type=bullet tight=true bullet_char=-)
      list_item
        paragraph
          str &quot;Qui &quot;
          emph
            str &quot;quodsi iracundia&quot;
      list_item
        paragraph
          str &quot;aliquando id&quot;
</code></pre><p>Notice how the [line ending] in the first paragraph has<br>
been parsed as a <code>softbreak</code>, and the asterisks in the first list item<br>
have become an <code>emph</code>.</p>
<h3 class="mume-header" id="an-algorithm-for-parsing-nested-emphasis-and-links">An algorithm for parsing nested emphasis and links</h3>

<p>By far the trickiest part of inline parsing is handling emphasis,<br>
strong emphasis, links, and images.  This is done using the following<br>
algorithm.</p>
<p>When we&apos;re parsing inlines and we hit either</p>
<ul>
<li>a run of <code>*</code> or <code>_</code> characters, or</li>
<li>a <code>[</code> or <code>![</code></li>
</ul>
<p>we insert a text node with these symbols as its literal content, and we<br>
add a pointer to this text node to the <a href="@">delimiter stack</a>.</p>
<p>The [delimiter stack] is a doubly linked list.  Each<br>
element contains a pointer to a text node, plus information about</p>
<ul>
<li>the type of delimiter (<code>[</code>, <code>![</code>, <code>*</code>, <code>_</code>)</li>
<li>the number of delimiters,</li>
<li>whether the delimiter is &quot;active&quot; (all are active to start), and</li>
<li>whether the delimiter is a potential opener, a potential closer,<br>
or both (which depends on what sort of characters precede<br>
and follow the delimiters).</li>
</ul>
<p>When we hit a <code>]</code> character, we call the <em>look for link or image</em><br>
procedure (see below).</p>
<p>When we hit the end of the input, we call the <em>process emphasis</em><br>
procedure (see below), with <code>stack_bottom</code> = NULL.</p>
<h4 class="mume-header" id="look-for-link-or-image"><em>look for link or image</em></h4>

<p>Starting at the top of the delimiter stack, we look backwards<br>
through the stack for an opening <code>[</code> or <code>![</code> delimiter.</p>
<ul>
<li>
<p>If we don&apos;t find one, we return a literal text node <code>]</code>.</p>
</li>
<li>
<p>If we do find one, but it&apos;s not <em>active</em>, we remove the inactive<br>
delimiter from the stack, and return a literal text node <code>]</code>.</p>
</li>
<li>
<p>If we find one and it&apos;s active, then we parse ahead to see if<br>
we have an inline link/image, reference link/image, compact reference<br>
link/image, or shortcut reference link/image.</p>
<ul>
<li>
<p>If we don&apos;t, then we remove the opening delimiter from the<br>
delimiter stack and return a literal text node <code>]</code>.</p>
</li>
<li>
<p>If we do, then</p>
<ul>
<li>
<p>We return a link or image node whose children are the inlines<br>
after the text node pointed to by the opening delimiter.</p>
</li>
<li>
<p>We run <em>process emphasis</em> on these inlines, with the <code>[</code> opener<br>
as <code>stack_bottom</code>.</p>
</li>
<li>
<p>We remove the opening delimiter.</p>
</li>
<li>
<p>If we have a link (and not an image), we also set all<br>
<code>[</code> delimiters before the opening delimiter to <em>inactive</em>.  (This<br>
will prevent us from getting links within links.)</p>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<h4 class="mume-header" id="process-emphasis"><em>process emphasis</em></h4>

<p>Parameter <code>stack_bottom</code> sets a lower bound to how far we<br>
descend in the [delimiter stack].  If it is NULL, we can<br>
go all the way to the bottom.  Otherwise, we stop before<br>
visiting <code>stack_bottom</code>.</p>
<p>Let <code>current_position</code> point to the element on the [delimiter stack]<br>
just above <code>stack_bottom</code> (or the first element if <code>stack_bottom</code><br>
is NULL).</p>
<p>We keep track of the <code>openers_bottom</code> for each delimiter<br>
type (<code>*</code>, <code>_</code>).  Initialize this to <code>stack_bottom</code>.</p>
<p>Then we repeat the following until we run out of potential<br>
closers:</p>
<ul>
<li>
<p>Move <code>current_position</code> forward in the delimiter stack (if needed)<br>
until we find the first potential closer with delimiter <code>*</code> or <code>_</code>.<br>
(This will be the potential closer closest<br>
to the beginning of the input -- the first one in parse order.)</p>
</li>
<li>
<p>Now, look back in the stack (staying above <code>stack_bottom</code> and<br>
the <code>openers_bottom</code> for this delimiter type) for the<br>
first matching potential opener (&quot;matching&quot; means same delimiter).</p>
</li>
<li>
<p>If one is found:</p>
<ul>
<li>
<p>Figure out whether we have emphasis or strong emphasis:<br>
if both closer and opener spans have length &gt;= 2, we have<br>
strong, otherwise regular.</p>
</li>
<li>
<p>Insert an emph or strong emph node accordingly, after<br>
the text node corresponding to the opener.</p>
</li>
<li>
<p>Remove any delimiters between the opener and closer from<br>
the delimiter stack.</p>
</li>
<li>
<p>Remove 1 (for regular emph) or 2 (for strong emph) delimiters<br>
from the opening and closing text nodes.  If they become empty<br>
as a result, remove them and remove the corresponding element<br>
of the delimiter stack.  If the closing node is removed, reset<br>
<code>current_position</code> to the next element in the stack.</p>
</li>
</ul>
</li>
<li>
<p>If none in found:</p>
<ul>
<li>
<p>Set <code>openers_bottom</code> to the element before <code>current_position</code>.<br>
(We know that there are no openers for this kind of closer up to and<br>
including this point, so this puts a lower bound on future searches.)</p>
</li>
<li>
<p>If the closer at <code>current_position</code> is not a potential opener,<br>
remove it from the delimiter stack (since we know it can&apos;t<br>
be a closer either).</p>
</li>
<li>
<p>Advance <code>current_position</code> to the next element in the stack.</p>
</li>
</ul>
</li>
</ul>
<p>After we&apos;re done, we remove all delimiters above <code>stack_bottom</code> from the<br>
delimiter stack.</p>

      </div>
      
      
    
    
    
    
    
    
    
    
  
    </body></html>